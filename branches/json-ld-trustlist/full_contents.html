<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Full Contents - WHO SMART Trust v1.1.6</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link rel="stylesheet" href="fhir.css"/>
    <link rel="stylesheet" href="assets/css/fa-all.css" type="text/css"/>
      <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap-fhir.css"/>

      <!-- Project extras -->
    <link rel="stylesheet" href="assets/css/project.css"/>
    <link rel="stylesheet" href="assets/css/pygments-manni.css"/>
    <link rel="stylesheet" href="assets/css/jquery-ui.css"/>
  	<link rel="stylesheet" href="assets/css/prism.css"/>
      <!-- Placeholder for child template CSS declarations -->
    <link rel="stylesheet" href="assets/css/who.css"/>
    <link rel="stylesheet" href="assets/css/lforms.min.css"/>


    <script src="fhir-table-scripts.js" type="text/javascript"> </script>

      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- [if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif] -->

      <!-- Favicons -->
    <link sizes="144x144" rel="fhir-logo" href="assets/ico/icon-fhir-144.png"/>
    <link sizes="114x114" rel="fhir-logo" href="assets/ico/icon-fhir-114.png"/>
    <link sizes="72x72" rel="fhir-logo" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"6"}
    h3,h4,h5,h6{--heading-prefix:"6"}</style>
    <div id="segment-header" class="segment">    <!-- segment-header -->

      <div id="segment-navbar" class="segment">    <!-- segment-navbar -->
        <div id="stripe"> </div>
        <div class="container">    <!-- container -->
            <!-- HEADER CONTENT -->
  
          <nav class="navbar navbar-inverse">
              <!-- status-bar -->
            <div class="container">
              <button data-target=".navbar-inverse-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
                <span class="icon-bar"> </span>
                <span class="icon-bar"> </span>
                <span class="icon-bar"> </span>
              </button>
              <a href="http://hl7.org/fhir/R5/index.html" class="navbar-brand hidden">FHIR</a>
              <div class="nav-collapse collapse navbar-inverse-collapse">
                  <!-- menu.xml -->

<ul class="nav navbar-nav">
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Home
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="index.html">Summary</a>
      </li>
      <li>
        <a href="dependencies.html">Dependencies</a>
      </li>
      <li>
        <a href="ethical_principles.html">Ethical Considerations and Data Protection Principles</a>
      </li>
      <li>
        <a href="faq.html">Frequently Asked Questions</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Business Requirements
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="concepts.html">Concepts</a>
      </li>
      <li>
        <a href="concepts_certificate_governance.html">Certificate Governance</a>
      </li>
      <li>
        <a href="concepts_onboarding.html">Onboarding Process</a>
      </li>
      <li>
        <a href="use_cases.html">Use Cases</a>
      </li>
      <li>
        <a href="decision_support.html">Decision Support Logic</a>
      </li>
      <li>
        <a href="functional.html">Functional Requirements</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Data Models and Exchange
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="actors.html">System Actors</a>
      </li>
      <li>
        <a href="transactions.html">Transactions</a>
      </li>
      <li>
        <a href="workflows.html">Workflows</a>
      </li>
      <li>
        <a href="trust_domains.html">Trust Domains</a>
      </li>
      <li>
        <a href="trust_network_gateway_architecture.html">Trust Network Gateway Architecture</a>
      </li>
      <li>
        <a href="concepts_did.html">DID Trustlist Specification</a>
      </li>
      <li>
        <a href="hcert_spec.html">HCERT Specification</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Deployment
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="concepts_onboarding_checklist.html">Onboarding Checklist</a>
      </li>
      <li>
        <a href="security_privacy.html">Security and Privacy Considerations</a>
      </li>
      <li>
        <a href="testing.html">Testing</a>
      </li>
      <li>
        <a href="reference_implementation.html">Reference Implementations</a>
      </li>
      <li>
        <a href="downloads.html">Downloads</a>
      </li>
      <li>
        <a href="changes.html">Changes</a>
      </li>
      <li>
        <a href="endpoints.html">Endpoints</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Indices
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="artifacts.html">Artifact Index</a>
      </li>
      <li>
        <a href="references.html">References</a>
      </li>
      <li>
        <a href="maps.html">Mappings</a>
      </li>
      <li>
        <a href="license.html">License</a>
      </li>
    </ul>
  </li>
</ul>
              </div>    <!-- /.nav-collapse -->

              <div data-placeholder-label="Language Selector and Search" style="display: flex; justify-content: flex-end; align-items: center;" class="sf_colsIn col-md-8  navbar-right-container" data-sf-element="LanguageSelectorSearch">
                  <!-- This div will be pushed to the right -->
                <div style="margin-left: auto; background-color: #00477d; color: white;" class="language-selector">
                  <i class="fa fa-language fa-lg"></i>
                  <label for="language-selector"> </label>
                  <select onChange="openLink(value)" name="language-selector" id="language-selector">
                    <option disabled="null" selected="null">Select language</option>
                    <option value="en" class="selected">English</option>
                  </select>
                  <i class="fas fa-angle-down"></i>
                </div>
                  <!-- Search Content -->
              </div>
            </div>    <!-- /.container -->
          </nav>    <!-- /.navbar -->
          <!-- /HEADER CONTENT -->
        </div>    <!-- /container -->
      </div>    <!-- /segment-navbar -->
      

      <div style=" justify-content: space-between; align-items: left;" class="container">

          <!-- Placeholder for child template header declarations -->
<div id="project-nav">
    <a no-external="true" id="who-logo" href="index.html">
        
    </a>
</div>

 <div id="family-nav">
  <a no-external="true" id="fhir-logo" href="http://hl7.org/fhir">  </a>
</div> 


        <div id="ig-status" class="ig-status-draft">
          <p><span style="font-size:12pt;font-weight:bold">WHO SMART Trust</span>
            <br/>
            <span style="display:inline-block;">1.1.6 - CI Build



  <img src="assets/images/001.svg" alt="International flag" title="International" height="16"/>


            </span>
          </p>
        </div>
      </div>   <!-- /container -->
    </div>    <!-- /segment-header -->


      <!-- status-bar -->

    <div id="segment-breadcrumb" class="segment">    <!-- segment-breadcrumb -->
      <div class="container">    <!-- container -->
        <ul class="breadcrumb">
          <li><a href="toc.html"><b>Table of Contents</b></a></li><li><b>Full Contents</b></li>

        </ul>
      </div>    <!-- /container -->
    </div>    <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">    <!-- segment-content -->
      <div class="container">    <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
    <!-- ReleaseHeader --><p id="publish-box">WHO SMART Trust, published by WHO. This guide is not an authorized publication; it is the continuous build for version 1.1.6 built by the FHIR (HL7&reg; FHIR&reg; Standard) CI Build. This version is based on the current content of <a href="https://github.com/WorldHealthOrganization/smart-trust/tree/json-ld-trustlist">https://github.com/WorldHealthOrganization/smart-trust/tree/json-ld-trustlist</a> and changes regularly. See the <a href="http://smart.who.int/trust/history.html">Directory of published versions</a></p>  <!-- EndReleaseHeader -->
  <h2>Full Contents</h2>
  












    <p>  <!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#home" id="markdown-toc-home">Home</a>    <ul>
      <li><a href="#summary" id="markdown-toc-summary">Summary</a></li>
      <li><a href="#key-ethical-considerations" id="markdown-toc-key-ethical-considerations">Key ethical considerations</a></li>
      <li><a href="#ethical-considerations-related-to-further-potential-uses-of-digital-personal-health-records-for-public-health-security-measures" id="markdown-toc-ethical-considerations-related-to-further-potential-uses-of-digital-personal-health-records-for-public-health-security-measures">Ethical considerations related to further potential uses of digital personal health records for public health security measures</a></li>
      <li><a href="#recommendations" id="markdown-toc-recommendations">Recommendations</a></li>
      <li><a href="#data-protection-principles-for-a-digital-solution" id="markdown-toc-data-protection-principles-for-a-digital-solution">Data protection principles for a Digital Solution</a></li>
      <li><a href="#digital-personal-health-record-design-criteria" id="markdown-toc-digital-personal-health-record-design-criteria">Digital personal health record design criteria</a></li>
      <li><a href="#references" id="markdown-toc-references">References</a></li>
      <li><a href="#faqs" id="markdown-toc-faqs">FAQs</a></li>
    </ul>
  </li>
  <li><a href="#business-requirements" id="markdown-toc-business-requirements">Business Requirements</a>    <ul>
      <li><a href="#concepts--glossary" id="markdown-toc-concepts--glossary">Concepts  Glossary</a></li>
      <li><a href="#certificate-governance" id="markdown-toc-certificate-governance">Certificate Governance</a></li>
      <li><a href="#onboarding-process-1" id="markdown-toc-onboarding-process-1">Onboarding Process</a></li>
      <li><a href="#federated-pkd-aggregation" id="markdown-toc-federated-pkd-aggregation">Federated PKD Aggregation</a></li>
      <li><a href="#federated-verification" id="markdown-toc-federated-verification">Federated Verification</a></li>
      <li><a href="#dynamic-business-rule-validation" id="markdown-toc-dynamic-business-rule-validation">Dynamic Business Rule Validation​</a></li>
      <li><a href="#background" id="markdown-toc-background">Background</a></li>
      <li><a href="#cql-authoring" id="markdown-toc-cql-authoring">CQL Authoring</a></li>
      <li><a href="#cql-execution" id="markdown-toc-cql-execution">CQL Execution</a></li>
      <li><a href="#cql-primer" id="markdown-toc-cql-primer">CQL Primer</a></li>
      <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li>
    </ul>
  </li>
  <li><a href="#data-models-and-exchange" id="markdown-toc-data-models-and-exchange">Data Models and Exchange</a>    <ul>
      <li><a href="#actors" id="markdown-toc-actors">Actors</a></li>
      <li><a href="#mirror_keys" id="markdown-toc-mirror_keys">Mirror Local PKD</a></li>
      <li><a href="#sign_claim" id="markdown-toc-sign_claim">Sign Health Certificate (HCERT)  Claim</a></li>
      <li><a href="#get_keys_did" id="markdown-toc-get_keys_did">Retrieve Verification Keys - DID</a></li>
      <li><a href="#get_keys_api" id="markdown-toc-get_keys_api">Retreive Verification Keys - API</a></li>
      <li><a href="#get_rules_api" id="markdown-toc-get_rules_api">Request Business Rule Updates - API</a></li>
      <li><a href="#get_rules_fhir" id="markdown-toc-get_rules_fhir">Request Business Rule Updates - API</a></li>
      <li><a href="#execute_rule" id="markdown-toc-execute_rule">Execute Business</a></li>
      <li><a href="#get_valuesets_api" id="markdown-toc-get_valuesets_api">Request Value Sets - API</a></li>
      <li><a href="#get_valuesets_api" id="markdown-toc-get_valuesets_api">Request Value Sets - FHIR</a></li>
      <li><a href="#execute_rule" id="markdown-toc-execute_rule">Execute Business</a></li>
      <li><a href="#federated-pkd-aggregation-1" id="markdown-toc-federated-pkd-aggregation-1">Federated PKD Aggregation</a></li>
      <li><a href="#federated-verification-1" id="markdown-toc-federated-verification-1">Federated Verification</a></li>
      <li><a href="#dynamic-business-rule-validation-1" id="markdown-toc-dynamic-business-rule-validation-1">Dynamic Business Rule Validation​</a></li>
      <li><a href="#trust-domains" id="markdown-toc-trust-domains">Trust Domains</a></li>
      <li><a href="#did-specifications" id="markdown-toc-did-specifications">DID Specifications</a></li>
      <li><a href="#electronic-health-certificate-specification" id="markdown-toc-electronic-health-certificate-specification">Electronic Health Certificate Specification</a></li>
      <li><a href="#appendix-a---trust-management" id="markdown-toc-appendix-a---trust-management">Appendix A - Trust Management</a></li>
    </ul>
  </li>
  <li><a href="#deployment-1" id="markdown-toc-deployment-1">Deployment</a>    <ul>
      <li><a href="#onboarding-checklist" id="markdown-toc-onboarding-checklist">Onboarding Checklist</a></li>
      <li><a href="#security-and-privacy-considerations" id="markdown-toc-security-and-privacy-considerations">Security and Privacy Considerations</a></li>
      <li><a href="#testing" id="markdown-toc-testing">Testing</a></li>
      <li><a href="#trust-registry-network" id="markdown-toc-trust-registry-network">Trust Registry Network</a></li>
      <li><a href="#trust-network-gateway" id="markdown-toc-trust-network-gateway">Trust Network Gateway</a></li>
      <li><a href="#downloads" id="markdown-toc-downloads">Downloads</a></li>
      <li><a href="#changes" id="markdown-toc-changes">Changes</a></li>
      <li><a href="#endpoints-1" id="markdown-toc-endpoints-1">Endpoints</a></li>
    </ul>
  </li>
  <li><a href="#indices" id="markdown-toc-indices">Indices</a>    <ul>
      <li><a href="#trust-network-specifications" id="markdown-toc-trust-network-specifications">Trust Network Specifications</a></li>
      <li><a href="#structuremaps" id="markdown-toc-structuremaps">StructureMaps</a></li>
      <li><a href="#license" id="markdown-toc-license">License</a></li>
    </ul>
  </li>
</ul>

</div>

<h2 id="home">Home</h2>

<h3 id="summary">Summary</h3>

<p><a name="scope">  </a></p>

<p><a name="Overview"> </a></p>

<p>
      This guide describes the specifications and on-boarding procedures for WHO's Global Digital Health Certification Network (GDHCN).  The GDHCN is a mechanism to support verification of health documents and certifications that are exchanged between participants of the GDHCN.  These health certifications may include COVID-19 certificates, routine immunization cards, and home-based records consistent with International Patient Summary standards. This mechanism provides means of harmonizing global health protocol standards and establishing a system for recognition of digital certificates for continuity of care and at point of entry.  The GDHCN is designed to leverage existing investments by jurisdictions that were made under the COVID-19 response and provide the digital health infrastructure needed for resiliency in future epidemic and pandemic responses.
    </p>

<p>
      The GDHCN is a digital reflection of the trust WHO already has with Member States. The GDHCN is a digital trust network is based on proven <a href="concepts.html"> concepts</a> which are used to describe the specifications and mechanisms for establishing trust, which allow eligible participants to establish new <a href="concepts.html#trust-domain">trust domains</a> for exchange of verifiable digital health records. Eligible participants of the trust network may apply to join by following an <a href="concepts_onboarding.html">on-boarding process</a>.   The GDHCN is operated under the <a href="GDHCN_Administrative_and_Operational_Framework.pdf">GDHCN Administrative and Operational Framework</a>.
    </p>

<p><strong>Trust Network</strong></p>
<p><img src="trust_network.png" alt="Trust Network" style="width:70%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<h4 id="background--purpose">Background &amp; Purpose</h4>
<p><a name="Background"> </a></p>

<p>
      In response to COVID-19, Governments and organizations across the world have developed and adopted standards and technologies to create, present, and verify digital vaccination and test credentials. However, a global technical framework to enable convenient use and interoperability of these credentials between systems – while also allowing domestic autonomy over their use – does not exist yet and is critically needed.      
    </p>

<p>
      The WHO Global Digital Health Certification Network is a collection of components that are used to verify interoperable digital health documents or certificates.  This system of comprised of three main features:
    </p>

<ul>
      <li>A collection of well defined digital health documents that are issued and verified by members of the GDHCN </li>
      <li>A Public Key Infrastructure (PKI) that is used for the publishing and distribution of public keys used for verification of digital signatures of the digital health documents.
      </li>

      <li>A Knowledge Library used to maintain metadata including terminology codings, product codes and business rules that are used to provide semantic interoperability of these digital health documents</li>

    </ul>

<p>In addition to verifying and validating COVID-19 certificates, a global digital health trust network such as the GDHCN can:</p>

<ul class="null">
        <li>Establish trust of digitally signed clinical algorithms published by WHO through the SMART Guidelines work.</li>
        <li>Allow for a global product catalogue of trusted medical products and devices.</li>
        <li>Ensure information about a patient can be accessed and trusted regardless of one is in the world.</li>
        <li>Support health systems resiliency to address future outbreaks in a world.</li>
        <li>Empower individuals to manage their own health and well-being.</li>
    </ul>

<p>The interoperable exchange of health information in a trusted environment is a complex task with an increasingly large number of stakeholders (e.g. public health agencies, accredited labs, border control organizations, institutions authorized to verify) that need to ensure that data is transferred safely and securely, that the health content is interoperable, and that information is understandable and actionable. This guide details how to utilize a global technical framework to allow interoperability of health credentials between
systems, while preserving domestic autonomy over their use. </p>

<p>Achieving global interoperability of health certificates does not require that all jurisdictions use the same standard. Interoperability can also be achieved when there are pre-arranged mechanisms in place so that certificates issued by one jurisdiction are accepted in another. A number of services and technical artifacts have been developed to address particular criteria for establishing interoperability and a system of trust including:</p>

<ul class="null">
        <li>Data models, transformations and vocabulary definitions that allow exchange of health data between various standards formats, preserving a jurisdiction's autonomy regarding domestic processes while allowing re-issuance and mutual recognition of credentials between jurisdictions</li>
        <li>Standard specifications for exchanging public keys between various networks for verifying digital signatures on health credentials</li>
        <li>A global trust registry and federated public key infrastructure solution that provides technical interoperability and technical governance between regional trust networks</li>
        <li>Workflows for creating, sharing and executing business rules that evaluate public health policies against health data for cross-border or port of entry requirements</li>
        <li>Open source tools and technical guidance to reduce the burden of implementing the technical infrastructure to participate in the federated trust network, including open source trust network infrastructure for jurisdictions to implement their own regional trust networks</li>
    </ul>

<h4 id="audience">Audience</h4>
<p><a name="Audience"> </a></p>

<p>This guide describes expected workflows for potential actors in a trust ecosystem, namely:</p>

<ul class="null">
        <li>Issuers that provide verifiable health credentials to individuals,</li>
        <li>Verifiers that consume verifiable health credentials provided by individuals, and</li>
        <li>Trust Networks that establish trust relationships and policies between issuers and verifiers.</li>
    </ul>

<p>The audience for this guide includes decision makers, analysts and technical assets at potential individual issuers,
existing trust networks or potential verifiers who may participate in the federated trust network. Stakeholders include Member States, regional networks, and standards development organizations.</p>

<h4 id="participants">Participants</h4>

<p><a name="participants"> </a></p>

<div style="display:block">
  ![Latest Status](./Participant_Onboarding_Status.jpg){:width="850em"}
</div>

<p><br/></p>

<h4 id="available-trust-domains">Available Trust Domains</h4>

<p><a name="l869">​</a>The codes for the GDHCN Trust Domains are contained in the <a href="ValueSet-WHO.TRUST.DOMAIN.html">GDHCN Trust Domain Value Set</a>.
  </p>
<p><a name="l875">​</a><a href="ValueSet-WHO.TRUST.DOMAIN.html">GDHCN Trust Domain Value Set</a></p>

<h4 id="ethical-considerations-and-data-protection-principles">Ethical Considerations and Data Protection Principles</h4>

<p>As with any digital solution, there are ethical considerations, such as potential impacts on equity and on equitable access, and data protection principles that need to inform the design of the technical specifications, as well as provide guidance on how resulting solutions can be ethically implemented. The following <a href="ethical_principles.html">page</a> discusses some key ethical considerations and data protection principles that Member States are encouraged to – and, where they have legal obligations, must – include in their respective deployments of digital solutions. These ethical considerations and data protection principles have also informed the design criteria for WHO’s SMART Guidelines and for the utilization of the WHO’s Global Digital Health Certification Network. </p>

<p><a name="feedback"> </a></p>

<h4 id="feedback">Feedback</h4>

<p>
    Feedback specific to this Implementation Guide can provided through:
  </p>

<ul>
    <li>Frequently asked questions can be viewed <a href="faq.html">here</a></li>
    <li>Clicking on one of the Feedbacks link to the right of any section header</li>
    <li>Sending an email to <a href="mailto:gdhcn-support@who.int?subject = IG Feedback">gdhcn-support@who.int</a></li>
    <li>Creating an issue on GitHub <a href="https://github.com/WorldHealthOrganization/trust">trust repository</a></li>
  </ul>

<h4 id="community">Community</h4>

<p><a name="Community"></a></p>

<p>Sign up on <a href="https://chat.fhir.org/">chat.fhir.org</a> community and follow the stream who-smart-guidelines for questions, queries and chats related to WHO SMART Guidelines</p>
<p><a href="https://chat.fhir.org/">chat.fhir.org</a></p>
<p>WHO also hosts weekly calls on authoring and implementing WHO SMART Guidelines where participation is welcome. Please send an email at <a href="mailto:gdhcn-support@who.int?subject = SMART Trust FHIR IG">gdhcn-support@who.int</a> in order to get invited.</p>
<p><a href="mailto:gdhcn-support@who.int?subject = SMART Trust FHIR IG">gdhcn-support@who.int</a></p>

<h4 id="disclaimer">Disclaimer</h4>

<p><a name="disclaimer"> </a></p>

<p>    The specification herewith documented is for the WHO Gloa demo working specification, and may not be used for any implementation purposes. 
    This draft is provided without warranty of completeness or consistency, and the official publication supersedes this draft.
    No liability can be inferred from the use or misuse of this specification, or its consequences.
  </p>

<h3 id="key-ethical-considerations">Key ethical considerations</h3>

<p>Ethics should be an integral part of the design and deployment of a digital solution. However, policy decisions are often complex and difficult. Many different considerations will need to be made and weighed against each other. Often, the evidence is uncertain and there are many different competing ethical perspectives and positions. Evidence alone will not provide the right answer, nor will a simple set of ethical rules. Public health action requires careful judgement and acceptance of responsibility for the outcomes. A number of different ethical considerations should be taken into account, including both objectives and processes.</p>

<h4 id="objectives">Objectives</h4>

<p>A good starting point is to identify how the use of a digital solution can contribute to important general duties of any government through public health. Three key objectives of public health action are:</p>

<ol>
<li>to protect and promote the welfare of individuals, communities and the population as a whole;</li>
<li>to ensure equal treatment for all individuals and prevent or mitigate, as far as possible, avoidable and unfair health inequalities (i.e. health inequities) within the boundaries of the state; and</li>
<li>to create and maintain trust in public health activities as part of the health-care system.</li>
</ol>

<p>
    The creation and use of a digital solution can contribute to each of these objectives. For example, in relation to objective 1, a digital solution can promote welfare through  the provision of digital health records enabling continuity of care by ensuring that individuals have access to their health data across facilities. Promotion of this objective also contributes to confidence in the health infrastructure of the government, benefitting the whole population. Such an outcome is an important common good – that is, a good for all that cannot be created by each individual alone. Such goods require the coordinated actions of, and support from, governments. In addition, other benefits will follow from the use of a digital solution, because of improved health and subsequent increased opportunities for individuals and communities to make their own choices and pursue their own economic and social goals. 
    
    In relation to objective 2, equal treatment requires respecting and protecting all persons equally and acting to ensure, as far as possible, that there is no discrimination against anyone. An example of how to work towards this objective is to ensure that appropriate personal data protection safeguards are implemented. Individual health data is private information, and protections need to be in place to ensure that no individual is forced to disclose or publicly display their personal health record (PHR) to access any public area or activity
<a href="ethical_principles.html#references">(1)</a>. Such a practice and/or the lack of a PHR itself may result in the stigmatization of individuals without a PHR and may exacerbate the risk of harms. 
    
    Another example of working towards objective 2 is to think about ways to try and achieve equity through the distribution of health resources. While a digital solution may offer a more reliable, accurate and trusted mechanism to record an personal health history, they risk exacerbating health inequities, for the following reasons. 
</p>

<p>→ A PHR may increase digital exclusion if its application and use and requires that individuals have access to a digital infrastructure or if that digital infrastructure is too burdensome for all Member States to deploy.</p>

<p>→ Individuals with geographical, financial or disability barriers may also be excluded from obtaining and using a PHR, depending on the administration process, cost and design. Ensuring an equitable and inclusive approach to the implementation of a digital solution will mean that those with greater barriers to obtaining and using a PHR are supported to a greater extent than others.</p>

<p>In relation to objective 3, trust is vital to ensuring the benefits of a digital solution for individuals, communities and the whole population. For example, the provision of robust data protection measures and the use of procedural considerations, outlined in <a href="ethical_principles.html#data-protection-principles-for-a-digital-solution">section 1.3.4</a>, may contribute to the maintenance of trust in public health systems. This in turn contributes to the delivery of objective 1. Another example might be that a digital solution should only be used for its intended purpose, as inappropriate uses may result in legitimate ones being undermined.</p>

<h4 id="processes">Processes</h4>

<p>The pursuit of the objectives above can create ethical problems. One way to mitigate this risk is by ensuring that various processes uphold important procedural values. These values, in turn, also contribute to the pursuit of the objectives above. Such values include:</p>

<p><strong>→ TRANSPARENCY:</strong> providing clear, accurate and publicly accessible information about the basis for the policy and the process by which it is made, from the onset – i.e. notifying the public that such a process is underway. Such a process disciplines decision-making and ensures accountability by providing a sound basis for an eventual decision that reasonable members of the public may agree with.</p>

<p><strong>→ INCLUSIVENESS IN DECISION-MAKING:</strong> providing opportunities for all relevant stakeholders to participate in policy formulation and design, in particular those affected, and advocates for these individuals and groups.</p>

<p><strong>→ ACCOUNTABILITY:</strong> providing a clear framework for who is responsible for what, and how responsibilities will be regulated and enforced.</p>

<p><strong>→ RESPONSIVENESS:</strong> providing mechanisms and opportunities to review and revise decisions and policies based on evolving scientific evidence and other relevant data. This may include public consultation or engagement with a wide range of experts, industries and other stakeholders so that the policies are responsive to real and perceived ethical issues and concerns. Particularly important stakeholders are those who are likely to be disadvantaged or face distinct or heightened risks with the creation of a PHR, such as individuals who are unable or unwilling to create a PHR, i.e. individuals with insecure or invalid citizenship or residency status, and individuals who may face other barriers in obtaining or using a PHR <a href="ethical_principles.html#references">(2)</a>.</p>

<h3 id="ethical-considerations-related-to-further-potential-uses-of-digital-personal-health-records-for-public-health-security-measures">Ethical considerations related to further potential uses of digital personal health records for public health security measures</h3>

<p>A number of further possible uses for digital PHRs raise ethical issues. In the context of a public health emergency, a digital PHR might play a role in achieving various public health purposes such as determining vaccination coverage in a given population, which may help to determine when to lift or relax public health and social measures (PHSMs) at a population level. A digital PHR might also be used to facilitate individualized exemption from, or, reduction of PHSMs (e.g. reduced quarantine time post exposure) or individual access to an activity based on proof of vaccination (if such uses are held to be ethical), which we can term a “health pass” function. The potential deployment or utilization of a digital PHR for these purposes, particularly as a health pass, engenders a number of potential ethical problems for individuals and communities, and human rights challenges (<a href="ethical_principles.html#references">3</a>,<a href="ethical_principles.html#references">4</a>).</p>

<p>First, use of a digital PHR as a health pass raises a distinct set of risks because of current scientific uncertainties emergent diseases.  For example, during the COVID-19 Public Health Emergency of International Concern (PHEIC), COVID-19 vaccines have demonstrated efficacy and effectiveness in preventing severe disease and death, the extent to which each vaccine prevents transmission of SARS-CoV-2 to susceptible individuals were not fully assessed. How long each vaccine confers protection against severe disease and against infection, and how well each protects against current and future variants of SARS-CoV-2 were not fully known. In this context of scientific uncertainty, use of a digital PHR as a health pass based solely on individual vaccination status may increase the risk of disease spread. This is particularly the case if individuals with a digital PHR are completely exempted from PHSMs or if it is hard to enforce individuals’ compliance with required</p>

<p>PHSMs during an activity (e.g. mask wearing and physical distancing during a concert) to which they are allowed access based on their digital PHR.</p>

<p>Second, some potential behavioural responses to a digital PHR in its role as a health pass could undermine individual and public health. These include the following.</p>

<p>→ Where the benefits of a health pass are significant, it may result in digital PHR fraud. For example, fraudulent vaccination records may increase public health risks if a non-vaccinated person is potentially in contact with vulnerable people.</p>

<p>→ Individuals may be less willing to disclose their medical history and (potential) contraindications to a public health intervention (e.g. vaccine), in order to obtain a corresponding digital PHR, which increases the risk of adverse events.</p>

<p>→ The creation of a digital PHR following vaccination for each individual may incentivize more people to participate in a public health measure (e.g. receive a vaccine) to access the benefits of a digital PHR. However, it may also increase hesitancy to participate in the public health measure because of privacy and other concerns that the vaccination record could be linked to personal data and be used for functions other than those originally intended (e.g. surveillance of individual health status), or be used by unintended third parties (e.g. immigration, commercial entities, researchers) <a href="ethical_principles.html#references">(5)</a>.</p>

<p>Third, a digital PHR in its use as a health pass risks introducing unfair disadvantages and injustices. For example, during the COVID-19 PHEIC, the initially limited supply of COVID-19 vaccine within some countries had been distributed to prioritize those at greatest risk of infection (such as health-care workers) or severe outcomes (such as the elderly).  There is a danger that those who are willing to be vaccinated but have not yet been offered a vaccine, or those who are unable to be vaccinated for medical reasons, would be unfairly disadvantaged if a digital PHR incorporated health pass functions. Consideration should be given to whether individuals could use other proofs of health status to allow them similar access to the same services while mitigating the risk of disease spread. For example, during the COVID-19 PHEIC, these other proofs may have included a negative COVID-19 test or proof of post-infection-acquired immunity based on tests that are reliable and accurate (which have been called immunity certificates), although this also raises considerable scientific and ethical concerns <a href="ethical_principles.html#references">(6)</a>.</p>

<h3 id="recommendations">Recommendations</h3>

<p>The design, development and implementation of a digital solution raises many ethical issues. The following series of recommendations can be reviewed when considering such an implementation.</p>

<ol><li><b>THE SCOPE OF USE OF A DIGITAL SOLUTION SHOULD BE CLEARLY DEFINED.</b>

<p>
    Each Member State that introduces a digital solution should be clear about which uses are proposed and that it should not be used for other purposes. 
    
    To prevent any potential misuse, any digital solution implementation should set out clear and specific policies, and laws if needed, on the limits to the solutions’ legitimate uses . Use of a digital solution to restrict the right to freedom to movement and other human rights is only justified when it supports the pursuit of a legitimate aim during a public health emergency and is provided for by law, proportionate, of limited duration, based on scientific evidence, and not imposed in an arbitrary, unreasonable or discriminatory manner.
</p></li> 

<li><b>POTENTIAL BENEFITS, RISKS AND COSTS SHOULD BE ASSESSED BEFORE INTRODUCTION OF A DIGITAL SOLUTION.</b>

<p>The creation or development of a digital solution should be based on an assessment of the benefits and costs of its uses, and the advantages and disadvantages of the proposed infrastructure, in comparison with other potential or existing ways to record, validate and verify vaccination records. Benefit and cost assessment – as a function of stewardship of scarce public health resources – should take short-, medium- and long-term views. A short-term view would consider the utility and opportunity cost of investing in a digital infrastructure over other measures for responding to emergencies and meeting other public health needs during a public health crisis. Consideration should be given to whether the digital infrastructure could hinder the public health response because of the potential inefficiencies it may introduce for processing registrations and/or trainings etc . A long-term view would consider the potential advantages of a digital solution for strengthening the health system, such as enhancing the health information system and its interoperability across jurisdictions. In addition, the ethical issues and risks raised by a digital solution, and the impact of trade-offs between the benefits and burdens accrued to individuals, families, businesses and other relevant stakeholders should be assessed prior to implementation. Community engagement, particularly with representatives of groups who are likely to face increased disadvantages or risks, should also be conducted. </p></li>

<li><b>OBTAINING AND USING A DIGITAL SOLUTION SHOULD BE AS INCLUSIVE AND FAIR AS POSSIBLE. </b>
<p>
    Digital solutions should be as inclusive as possible and should not create disadvantage. To achieve this, it may be necessary to provide alternative, cost-effective  solutions, including paper-based alternatives, for individuals and groups with existing disadvantages, such as those with digital skill or disability barriers, those living in areas with poorer digital connectivity, and undocumented or irregular migrants. No one should be excluded through a requirement for individual payment to obtain and use a digital solution.
</p></li> 

<li><b>ALL NECESSARY MEASURES SHOULD BE PUT IN PLACE TO PROTECT PARTICIPANTS FOR CONTINUITY OF CARE.</b>
<p>
    A digital solution will include potentially sensitive data relating to the health of individuals, and this data should therefore be protected by appropriate medical confidentiality and privacy safeguards. Access to or use of the data for continuity of care should be based on the appropriate consent standard (e.g. implied or explicit) in a given health-care system and should be sufficient for the receiving health-care provider or team to continue providing good medical care. These ethical standards will also apply to international transfer of  data for continuity of care (such as when a patient accesses medical services abroad). 
    
    For adults without decisional capacity, use of their personal health records for decisions relating to their health care may be based on their advance decisions or, in the absence of an advance decision, be made in the adult’s best interest by a health-care proxy or an authorized surrogate. Minors with sufficient intelligence and maturity should be able to allow the use of their health record data for continuity of care, where consent is required. 
</p></li>

<li><b>ALL COMMUNICATION SHOULD BE CLEAR AND TRANSPARENT.</b> 

<p>
    Implementation details of a digital solution relevant to users should be communicated in a transparent manner, which may contribute to the promotion of public trust and acceptance of the solution. This communication includes how the solution would work to benefit individuals and public health, the policies and mechanisms in place to limit access to and use of the solution by third parties, whether personal health data are linked to other types of data and the purposes of any data linkage. 
    
    If, in the future, the uses of the solution are extended into other scientific or public health purposes (e.g. programme monitoring or research), data subjects and other members of the public should be informed of the nature and occurrences of these activities in advance, the ethics oversight or governance structure in place (including for surveillance activities
 <a href="ethical_principles.html#references">(7)</a>), and options for controlling or limiting personal health data for these uses. personal health data are sensitive and should, in general, be anonymized (or pseudonymized, or de-identified) for scientific or public health purposes, to minimize risks to the data subjects. Where personal health data need to be retained in an identifiable form for these purposes, consideration should be given to whether consent is required or should be waived based on satisfaction of appropriate ethical criteria (e.g. minimal risk, impracticability of obtaining consent, no adverse effects on the rights and welfare of the data subjects, and serving a public health good). 
</p></li>

<li><b>THE DIGITAL SOLUTION SHOULD BE CONSTANTLY MONITORED FOR IMPACT AND ADJUSTED AS NECESSARY.</b>
<p>Post implementation, it is important to monitor the effects of digital solution in terms of positive and negative outcomes (e.g. impact on equity) and to consider potential interventions to mitigate negative outcomes. Such monitoring should also review uses that do not fit neatly into legitimate and illegitimate use categories set by policies, to consider whether these uses should be continued, modified or stopped. </p></li>
</ol>

<h3 id="data-protection-principles-for-a-digital-solution">Data protection principles for a Digital Solution</h3>

<p>This section presents prerequisite fundamental data protection principles for the digital solution . The principles are designed to provide guidance to the national authorities tasked with creating or overseeing the development of the digital solution. The objectives are to encourage Member States to adopt or adapt their national laws and regulations, as necessary, respect personal data protection principles, and ensure respect for the human rights and fundamental freedoms of individuals, in particular the right to privacy, in order to build trust in the implementation of the digital solution.</p>

<p>The data protection principles are as follows.</p>
<ol>
<li><b>LAWFUL BASIS, LEGITIMATE USE AND FAIR PROCESSING</b>
<p>
    The personal data collected in the interest of the application of the digital solution should be processed in a fair and non-discriminatory manner, based on the consent of the data subject, the necessity to protect the vital interests of the data subject or of another data subject, or explicitly justified by legitimate public health objectives. 
    
    The processing of personal data in the interest of the application of the digital solution should have a lawful basis; it should comply with applicable laws, including broader human rights standards and data privacy and data protection laws, as well as respecting the highest standards of confidentiality, and moral and ethical conduct. 
    
    Personal data collected for the application of the digital solution should only be accessed, analysed or otherwise used while respecting the legitimate interests of the data subjects concerned. Specifically, to ensure that data use is fair, data should not be used in a way that violates human rights or in any other ways that are likely to cause unjustified or adverse effects on any individual(s) or group(s) of individuals. 
    
    Any retention of personal data processed in the interest of the application of the digital solution should have a legitimate and fair basis. Before any data are retained, the potential risks, harms and benefits should be considered. Personal data should be permanently deleted after the time needed to fulfil their purpose, unless their extended retention is justified for specified purposes. 
</p></li>

<li><b>TRANSPARENCY</b> 

<p>The processing of personal data in the interest of the application of the digital solution should be carried out to be transparent to the data subjects. Data subjects should be provided with easily accessible, concise, comprehensible and reader-friendly information in clear and unambiguous language regarding: the purpose of the data processing; the type of data processed; how data will be retained, stored and shared, or made otherwise accessible; who will be the recipients of the data and how long the data will be retained. Information should also be provided to data subjects on applicable data retention schedules, and on how to exercise their data subject rights. A list of entities authorized to process personal data in the interest of the application of the digital solution should be made public. </p></li>

  

<li><b>PURPOSE LIMITATION AND SPECIFICATION</b>
<p>
    As the personal data collected in the interest of the digital solution may only be used for the scope and purpose identified, and they should not be processed in ways that are incompatible with identified purposes. The use of  data for any other purpose, including the sale and use of personal data for commercial purposes, should be prohibited, except with the explicit, unambiguous and freely given prior consent of the data subject. 
    
    The purposes for which personal data are processed in the interest of the application of the digital solution should be specified no later than at the time of data collection. The subsequent use of the personal data should be limited to the fulfillment of those specified purposes. 
    
    When a health worker or verifier of the digital solution is carrying out their mandated activities ; transferring personal data processed in the interest of the application of the digital solution to a third party or allowing access by a third party should only be permitted if the principles underlying the lawful basis, as referred to above, are met; and the third party affords appropriate protection that is equal to or higher than those protections provided by the data controller, for the personal data. 
    
    Personal data processed in the interest of the application of the digital solution should be relevant to the purposes for which they are to be used and, to the extent necessary for those purposes, be accurate, complete, and kept up to date.
</p> </li>

<li>
    <b>PROPORTIONALITY, NECESSITY AND DATA MINIMIZATION</b>    
    <p>The processing of personal data should be relevant (have a rational link to specified purposes), adequate (sufficient to properly fulfil the specified purposes) and limited to what is required to fulfil the specified purposes. The processing of personal data should not be excessive for the 
        
        purposes for which those personal data are collected. Data collected and retained on the digital solution should be as limited as possible, respecting proportionality and necessity. Data access, analysis or other use should be kept to the minimum necessary to fulfil their purpose. The amount of data, including their granularity, should be limited to the minimum necessary. Selective disclosure mechanisms should be used to support proportionate data access. 
        
        Data use should be monitored to ensure that it does not exceed the legitimate use. Personal data retained in the interest of the application of the digital solution should only be retained and stored for the time that is necessary for specified purposes. Personal data accessed at the point of verification of the digital solution should not be retained and stored in a repository, database or otherwise.</p> 
</li>

<li>
    <b>CONFIDENTIALITY AND SECURITY </b>
    <p>Personal data processed in the interest of the application of the digital solution should be kept confidential and not disclosed to unauthorized parties; personal data should only be accessible to the data subject or to other explicitly authorized parties. 
    
    With regard to the nature and sensitivity of the personal data processed in the interest of the application of the digital solution, appropriate organizational, physical and 
    technical security measures should be implemented for both electronic and paper-based data in order to protect the security and integrity of personal data. This protection includes measures to protect against personal-data breach, and measures to ensure the continued availability of that personal data for the purposes for which it is processed; this applies regardless of whether the data are stored on devices, applications, servers or networks, or if they are sent through services involved in collection, transmission, processing, retention or storage. 

    Taking into account the available technology and cost of implementation, robust technical and organizational safeguards and procedures (e.g. efficient monitoring of data access, data breach notification procedures) should be implemented to ensure proper data management throughout the data life-cycle. Such measures are to prevent any accidental loss, destruction, damage, unauthorized use, falsification, tampering, fraud, forgery, unauthorized disclosure or breach of personal data. 

    In case of a security breach leading to the accidental or unlawful destruction, loss, alteration, unauthorized disclosure of or access to personal data transmitted, stored or otherwise processed, users of the digital solution,n that hold health records (Data Holders) should be notified in an appropriate and timely manner.  Data Holders should be notified of: any data breach; the nature of the data breach, which may affect their rights as data subjects; and recommendations to mitigate potential adverse effects.
</p>
</li>

<li>
    <b>DATA SUBJECT RIGHTS, COMPLAINT AND LEGAL REDRESS</b> 
    <p>Data Holders, if they have provided sufficient evidence of being the Data Holder, should be able to exercise data subject rights. These data subject rights include the right of access, correction, deletion, objection and restriction of personal data, subject to conditions regulated by national law, decree, regulation or other official act or order. Data subjects have the right to seek redress by a complaint procedure if they suffer harm or loss as a result of misused  data or incorrect or incomplete data. Data subjects should be provided with easily accessible, concise, comprehensible and reader-friendly information about how they might exercise their data subject rights and how to seek legal redress, including how they can exercise any rights in the case of alleged fraud.</p> 
</li>

<li>
    <b>INDEPENDENT OVERSIGHT AND ACCOUNTABILITY </b>
    <p>An independent public authority should be responsible for monitoring whether any data controller and data processor involved in the processing of personal data in the interest of the digital solution adhere to the principles, and may recommend revoking the authorization to collect or otherwise process  data. Such a public authority should have access to all information necessary to fulfil its task. Adequate policies and mechanisms should be in place to ensure adherence to these principles. </p>
</li>
</ol>

<h3 id="digital-personal-health-record-design-criteria">Digital personal health record design criteria</h3>

<p>Due to the ethical considerations and data protection principles outlined above, the following design criteria were considered when formulating the requirements for implementing a digital solution.</p>

<ol>
    <li>Implementation of the digital solution should not increase health inequities or increase the digital divide.</li> 
    <li>Every individual in the jurisdiction should have the right to obtain and hold records on a digital solution.  The records held by the digital solution need to be in a format that can be accessible to all, for example, in paper and digital formats. Any solution should also work in online and offline environments across multiple platforms – paper and digital.</li> 
    <li>Individuals should not be treated differently or given different levels of trust due to the representation format of the data they are using (e.g. there should be no discrimination based on whether someone is presenting a health record on a smartphone or a paper card).</li> 
    <li>Any solution should not be at an additional cost to the person. The interoperability specifications used in digital solutions should be based on open standards to ensure equitable access to a range of non-proprietary digital tools.</li> 
    <li>The infrastructure that the digital solution solution is built on should ensure that individuals and Member States are not locked into a commitment with only one vendor.</li>    
    <li>Any solution should be as environmentally friendly as possible. The most environmentally sustainable options should be pursued to reduce any additional undue harm to the environment.</li> 
    <li>Any solution should be designed to augment and work within the context of existing health information systems, as appropriate.</li> 
    <li>Any solution should not share or store more data than is needed to successfully execute its tasks. Minimization of health content for purposes not related to health care, and privacy-protecting features, should be built into the system and be respected accordingly.</li>
    <li>Anti-fraud mechanisms should be built into any approach.</li>
</ol>

<p>Digital technology should not be the only mechanism available for verification. There should always be possible ways to revert to a paper-only manual verification of records. It is important to note that despite the technological design criteria outlined here, it will be essential for Member States to ensure that the legal and policy frameworks are in place to support responsible use of the digital solution as defined by the Member State.</p>

<h3 id="references">References</h3>
<ol>
    <li>Requiring proof of Covid-19 vaccination (vaccine “passports”/“certificates”): Key ethical, legal, and social issues.
    Policy brief. In: Swiss National COVID-19 Science Task Force [website]. Zurich: ETH Board; 19 February 2021 (https://
    sciencetaskforce.ch/en/policy-brief/requiring-proof-of-covid-19-vaccination-vaccine-passports-certificates-key-ethicallegal-
    and-social-issues, accessed 27 June 2021).</li>
    <li>
        What place should COVID-19 vaccine passports have in society? Ada Lovelace Institute; 17 February 2021 (https://
    www.adalovelaceinstitute.org/wp-content/uploads/2021/02/COVID-19-vaccine-passports-rapid-expert-deliberation.pdf,
    accessed 27 June 2021).
    </li>
    <li>Committee on Bioethics. Statement on human rights considerations relevant to “vaccine pass” and similar documents.
        Strasbourg: Council of Europe; 4 May 2021 (https://rm.coe.int/dh-bio-2021-7-final-statement-vaccines-e/1680a259dd,
        accessed 27 June 2021).
    </li>
    <li>COVID-19 Vaccination certificates and lifting public health and social measures: ethical considerations. Geneva: World
        Health Organization; forthcoming.
    </li>
    <li>Twelve criteria for the development and use of COVID-19 vaccine passports. Pre-print paper. London: The Royal Society
        The Royal Society SET-C (Science in Emergencies Tasking – COVID); 14 February 2021 (https://royalsociety.org/-/media/
        policy/projects/set-c/set-c-vaccine-passports.pdf, accessed 27 June 2021).
    </li>
    <li>Voo TC, Reis AA, Thomé B, Ho CW, Tam CC, Kelly-Cirino C, et al. Immunity certification for COVID-19: ethical
        considerations. Bulletin of the World Health Organization. 2021;99(2):155–61. doi:10.2471/BLT.20.280701.
    </li>
    <li>Guidelines on ethical issues in public health surveillance. Geneva: World Health Organization, 2017 (https://www.who.int/
        publications/i/item/who-guidelines-on-ethical-issues-in-public-health-surveillance, accessed 27 June 2021).
    </li>
</ol>

<h3 id="faqs">FAQs</h3>

<h4 id="participation-and-roles">Participation and Roles</h4>

<h5 id="who-can-serve-as-the-application-form-representative-for-gdhcn-participation">Who can serve as the Application Form Representative for GDHCN participation?</h5>
<p>A designated public health authority from a WHO Member State, with decision-making authority regarding participation in the GDHCN, should be the representative.</p>

<h5 id="what-is-the-role-of-the-business-owner-contact">What is the role of the Business Owner Contact?</h5>
<p>A senior official with decision-making powers, involved in strategic decisions but not daily operations.</p>

<h5 id="who-should-be-the-technical-contact">Who should be the Technical Contact?</h5>
<p>An individual responsible for addressing technical inquiries and issues during the project's lifecycle.</p>

<h5 id="what-does-the-legal-contact-do">What does the Legal Contact do?</h5>
<p>Manages legal aspects, including regulatory compliance and contractual matters related to GDHCN participation.</p>

<h4 id="financial-information">Financial Information</h4>

<h5 id="are-there-any-fees-associated-with-participating-in-the-gdhcn">Are there any fees associated with participating in the GDHCN?</h5>
<p>Participation in the GDHCN is currently free, supported by existing WHO funding.</p>

<h4 id="technical-requirements-and-infrastructure">Technical Requirements and Infrastructure</h4>

<h5 id="how-will-the-transition-to-whos-product-catalog-management-tool-affect-vaccine-codes">How will the transition to WHO's product catalog management tool affect vaccine codes?</h5>
<p>The tool aims to manage vaccine codes effectively, addressing the complexities of medical terminology coding.</p>

<h5 id="can-we-continue-participation-in-the-uat-environment-without-moving-to-production">Can we continue participation in the UAT environment without moving to production?</h5>
<p>Yes, continuing in the UAT environment is possible and does not hinder future transition to the production environment.</p>

<h5 id="how-does-gdhcn-support-open-source-collaboration">How does GDHCN support open-source collaboration?</h5>
<p>Through platforms like GitHub, enabling community contributions to enhance technical specifications and documentation.</p>

<h5 id="how-is-gdhcn-integrating-existing-eu-dcc-technical-specifications">How is GDHCN integrating existing EU DCC technical specifications?</h5>
<p>By incorporating EU DCC specifications like APIs for key access, business rules, and value sets, ensuring compatibility.</p>

<h5 id="what-are-the-plans-for-future-developments-and-maintenance-of-the-gdhcn-infrastructure">What are the plans for future developments and maintenance of the GDHCN infrastructure?</h5>
<p>Future developments will be guided by WHO, focusing on compatibility with existing systems and ensuring security and backward compatibility.</p>

<h4 id="transition-and-onboarding">Transition and Onboarding</h4>

<h5 id="how-is-the-transition-of-technical-assets-from-eu-dcc-to-gdhcn-managed">How is the transition of technical assets from EU DCC to GDHCN managed?</h5>
<p>This includes moving APIs and sets into GDHCN specifications, with WHO ensuring a smooth integration.</p>

<h5 id="what-is-the-onboarding-process-for-new-applications-not-previously-connected-to-eu-dcc">What is the onboarding process for new applications not previously connected to EU DCC?</h5>
<p>It involves verifying technical connections and compatibility with existing systems, especially regarding TLS certificates.</p>

<h4 id="security-and-compliance">Security and Compliance</h4>

<h5 id="how-is-the-key-material-and-exchange-process-managed-within-gdhcn">How is the key material and exchange process managed within GDHCN?</h5>
<p>With detailed definitions for key materials, ensuring clarity and visibility in the key exchange process, closely resembling EU DCC definitions.</p>

<h5 id="how-are-security-related-incidents-managed-during-the-transition-to-who-governance">How are security-related incidents managed during the transition to WHO governance?</h5>
<p>The focus is on addressing security incidents, with no changes to the repository unless necessary for security reasons.</p>

<h4 id="certificate-management">Certificate Management</h4>

<h5 id="what-is-the-current-policy-on-tls-certificate-renewal-for-national-backends">What is the current policy on TLS certificate renewal for national backends?</h5>
<p>The policy is under review, with discussions on alternatives to the three-month renewal policy, including longer expiry times or self-signed certificates.</p>

<h5 id="can-who-host-networks-use-self-signed-tls-certificates">Can WHO host networks use self-signed TLS certificates?</h5>
<p>The possibility of WHO using self-signed certificates with extended expiry times is under discussion.</p>

<h5 id="what-is-the-process-for-proposing-alternatives-to-the-current-tls-certificate-policy">What is the process for proposing alternatives to the current TLS certificate policy?</h5>
<p>Proposals for alternatives, like extended expiry times, are being considered to alleviate concerns with short renewal policies.</p>

<p>###!## How does WHO ensure trust without relying solely on the TLS certificate?
Trusting the CA rather than the certificate itself may provide a solution to frequent renewals.</p>

<h2 id="business-requirements">Business Requirements</h2>

<p>This digital health trust network is a network of stakeholders that securely exchange and uses health information based on trust, security, and privacy principles, and is designed to ensure that health information is handled in a secure, private, and compliant manner.  Through the GDHCN, WHO serves as the custodian of a digital health trust network.</p>

<p>It has been broken up into the following sections:</p>

<ul>
 <li><a href="concepts.html">Key Concepts</a></li>
 <li><a href="functional.html">Functional Requirements</a></li>   
 <li><a name="l1399">​</a><a href="usecases.html">Use Cases</a></li>
 <li><a name="l1403">​</a><a href="personas.html">Personas</a></li>
 <li><a name="l1407">​</a><a href="dictionary.html">Data Dictionary</a></li>
</ul>

<p>In addition to the key concepts used throughout this document, which are defined below, additional documentation may be found on:</p>
<ul>
  <li><a href="GDHCN_Administrative_and_Operational_Framework.pdf">GDHCN Administrative and Operational Framework</a></li>
  <li><a href="concepts.html">Glossary</a></li>
  <li><a href="concepts_certificate_governance.html">Certificate Governance</a></li>
  <li><a href="concepts_onboarding.html">Onboarding Process</a></li>
</ul>

<p>The <i>GDHCN Administrative and Operational Framework</i> should be considered the authoritative source of definitions and concepts in case of any discrepancies.</p>

<h3 id="concepts--glossary">Concepts  Glossary</h3>

<h4 id="gdhcn-trust-network">GDHCN Trust Network</h4>
<p>The GDHCN Trust Network is a Trust Network comprised of the GDHCN Secretariat and GDHCN Participants. The GDHCN Trust Network operationalizes Trust Domains through a Trust Network Gateway by enabling bilateral verification and utilization of Verifiable Digital Health Certificates and the utilization of Trusted Services by GDHCN Participants.</p>

<h4 id="gdhcn-secretariat">GDHCN Secretariat</h4>
<p>The WHO Secretariat serves as the operational and management leadership of the GDHCN, and in this role, the GDHCN Secretariat.</p>

<h4 id="gdhcn-participant">GDHCN Participant</h4>
<p>A GDHCN Participant is participant of the Trust Network that adheres to the Terms of Participation and manages the necessary technical infrastructure and governance processes. GDHCN Participants are responsible for making bilateral determinations related to the utilization of Trusted Services.</p>

<h4 id="eligible-gdhcn-participant">Eligible GDHCN Participant</h4>
<p>An Eligible GDHCN Participant is one of the following:</p>
<ul>
  <li>a WHO Member State or Associate Member, or sub-national unit thereof;</li>
  <li>a State Party recognized by the International Health Regulations, or sub-national unit thereof;</li>
  <li>the United Nations (UN) and other intergovernmental organizations in effective relations with WHO;</li>
  <li>a fund, programme, specialized agency, or related organization within the UN system; or</li>
  <li>an organization officially delegated by one of the organizations mentioned above that can abide by the GDHCN Terms of Participation and fulfils one or more of the following health service functions:
    <ul>
      <li>Public Health Agency;</li>
      <li>Health Professions Education Accreditation Agency;</li>
      <li>Health Services Licensing Agency; or</li>
      <li>Public Health Security Agency. 
Once accepted to the GDHCN, after the successful conclusion of the Onboarding Process, will be referred to as <strong>GDHCN Participant</strong>.  An Eligible GDHCN Participant that has initiated the Onboarding Process will be referred to as an <strong>Eligible GDHCN Applicant</strong>.</li>
    </ul>
  </li>
</ul>

<h4 id="terms-of-participation-top">Terms of Participation (TOP)</h4>
<p>Participation in the GDHCN is subject to the Onboarding Process set forth by the GDHCN Secretariat in its sole and absolute discretion, and in accordance with WHO rules, regulations, policies and practices, as may be amended from time to time.
The requirements for the GDHCN Terms of Participation are comprised of the following components:</p>
<ul>
  <li><strong><em>TOP0</em></strong> Sharing of necessary credentials to establish an mTLS (mutual transport layer security) connection between a GDHCN Participant’s backend system(s) and the Trust Network Gateway;</li>
  <li><strong><em>TOP1</em></strong> Compliance, during initial Onboarding Process and during routine validation periods, with technical specifications required for a PKI;</li>
  <li><strong><em>TOP2</em></strong> Compliance, during initial Onboarding Process and during routine validation periods, with technical specifications for Verifiable Digital Health Certificates and APIs of Trusted Services for each applicable Trust Domain;</li>
  <li><strong><em>TOP3</em></strong> Compliance with policy and regulatory standards that GDHCN Participants pertaining to Trusted Services that a GDHCN Trust Participants operates or utilizes for each applicable Trust Domain; and</li>
  <li><strong><em>TOP4</em></strong> Provision of supporting documentation (e.g. mandate, legal framework) demonstrating that it is an Eligible GDHCN Participant, as may be requested by WHO, at its sole discretion, from time to time.</li>
</ul>

<h4 id="business-owner-representative">Business Owner Representative</h4>
<p>The individual identified by a GDHCN Participant as having the primary business and programmatic responsibility for the GDHCN Participant for the implementation of the use cases covered by a Trust Domain.</p>

<h4 id="key-master-representative">Key Master Representative</h4>
<p>The individual identified by a GDHCN Participant as having the primary responsibility for the management of the Public Key Infrastructure, including the generation of any needed public-private key pairs, and the configuration and management of the connections between the GDHCN Participant’s Public Key Infrastructure and the GDHCN Trust Network Gateway.</p>

<h4 id="legal-representative">Legal Representative</h4>
<p>The individual designated by a GDHCN Participant as having the primary responsibility for reviewing the requirements related to a Trust Domain on behalf of this GDHCN Participant. This person should be someone that the GDHCN Secretariat can consult in relation to any legal or policy issues that may arise, such as changes to this document or changes to one of its Annexes that defines a Trust Domain.</p>

<h4 id="technical-representative">Technical Representative</h4>
<p>The individual designated by a GDHCN Participant as having the primary overall responsibility for the security, technical matters and systems infrastructure of this GDHCN Participant for the applicable Trust Domain including ensuring compliance with technical specifications.</p>

<h4 id="letter-of-application">Letter of Application</h4>
<p>A formal application sent via a verifiable and secure channel from an Eligible GDHCN Participant to the GDHCN Secretariat to join the GDHCN Trust Network and participate within a particular Trust Domain.</p>

<h4 id="onboarding-process">Onboarding Process</h4>
<p>The processes required for an Eligible GDHCN Participant to join the GDHCN Trust Network. At the successful conclusion of the Onboarding Process, the Eligible GDHCN Participant shall be considered a GDHCN Participant. Sometimes simply referred to as “Onboarding”.</p>

<h4 id="health-professions-education-accreditation-agency">Health Professions Education Accreditation Agency</h4>
<p>An organization or organizational unit that is responsible for establishing and/or implementing procedures for accreditation of health professions education institutions.  See https://apps.who.int/iris/rest/bitstreams/1473223/retrieve and https://applications.emro.who.int/docs/em_rc50_r9_en.pdf?ua=1</p>

<h4 id="health-services-licensing-agency">Health Services Licensing Agency</h4>
<p>An organization or organizational unit that is responsible for establishing and/or implementing procedures for licensure, and the licensing of organizations or individuals to provide clinical, health system or public health services within their jurisdiction. Licensing comprises processes through which duly authorized governmental authorities, such as recognized professional organizations, grant permission to an individual or healthcare organization to operate or engage in a medical occupation or profession. See: https://apps.who.int/iris/rest/bitstreams/1473223/retrieve and https://cdn.who.int/media/docs/default-source/documents/health-systems-strengthening-glossary.pdf.</p>

<h4 id="public-health-agency">Public Health Agency</h4>
<p>An organization, or organizational unit, that is responsible for establishing procedures for and/or implementation of activities related to the protection, promotion, and improvement of public health within a specific jurisdiction or domain. May also be referred to as a Ministry of Health, Department of Health, or Public Health Authority.</p>

<h4 id="public-health-security-agency">Public Health Security Agency</h4>
<p>An organization, or organizational unit, that is responsible for establishing procedures for and/or implementing required activities, both proactive and reactive, for minimizing the danger and impact of acute public health events that endanger people’s health across geographical regions and international boundaries.  See: https://www.who.int/health-topics/health-security.</p>

<h4 id="public-key-infrastructure-pki">Public Key Infrastructure (PKI)</h4>
<p>The Public Key Infrastructure (PKI) is the trust model based on public key certificates and certificate authorities.  It is the means for publishing and distributing Trust Lists comprising the public keys that can be used to digitally verify the issuer of a Verifiable Digital Health Certificates.</p>

<h4 id="signing-certificate-authority-sca">Signing Certificate Authority (SCA)</h4>
<p>Each GDHCN Participant maintains one or more Signing Certificate Authority (SCA), certificates of which are relatively long lived. The SCA issues public key certificates for the national, short lived, Document Signers.  The SCA acts as a trust anchor such that relying GDHCN Participants can use the SCA certificate to validate the authenticity and integrity of the regularly changing DSC certificates.</p>

<h4 id="holder">Holder</h4>
<p>A Holder is an individual that has Verifiable Digtial Health Certificate in their possesion, received from an Issuer.  The Holder may choose to share the Verifiable Digital Health Certificate with a Receiver.</p>

<h4 id="receiver">Receiver</h4>
<p>A Reciever is a system authorized by a Trust Network Participant to receive from a Holder a Veritifable verify, and utilize the content within.</p>

<h4 id="issuer">Issuer</h4>
<p>An Issuer a system authorized by a Trust Network Participant to generate Verifiable Digital Health Certificates which are provided to a Holder.   An Issuer is responsible for generating the content that is digitally signed within the Verifiable Digital Health Certificate.   In order to sign this content, an Issuer should either itself be a Document Signer or utilize a Document Signer service, as authorized by the jurisdicitonal policy.</p>

<h4 id="document-signer">Document Signer</h4>
<p>A Document Signer utilizes the private key of a private-public key pair to digitally sign Verifiable Digital Health Certificates.  A single private key is expected to sign a large quantity of Verifiable Digital Health Certificates. The corresponding public key is referred to as a Document Signer Certificate (DSC).</p>

<h4 id="document-signer-certificates-dscs">Document Signer Certificates (DSCs)</h4>
<p>Document Signer Certificates are the public key certificates associated to Document Signers which are issued or recognized by the GDHCN Participant.</p>

<h4 id="encryption-key-certificate-governance">Encryption Key Certificate Governance</h4>
<p>The process and technical specifications regarding the management and use of encryption keys for Verifiable Digital Health Certificates, Public Key Infrastructure, and for securing connections with Trusted Services and the Trust Network Gateway.</p>

<h4 id="trust-domain">Trust Domain</h4>
<p>A Trust Domain consists of:</p>
<ul>
  <li>Defined use cases and business processes related to the utilization of Verifiable Digital Health Certificates;</li>
  <li>the open, interoperable technical specifications that identify or define the applicable Trusted Services and Verifiable Digital Health Certificates; and</li>
  <li>a set of policy and regulatory standards describing expected behavior of GDHCN Participants in relation to operation of the Trusted Services and utilization of Verifiable Digital Health Certificates (e.g. data minimization, privacy, scope of use).</li>
</ul>

<h4 id="trust-lists">Trust Lists</h4>
<p>Universal verifier applications that support different credential standards are complicated by wide variability in format of the credential payloads, signatures, key formats, and key distribution methods. Public keys formats include x509 certificates, JSON Web Key Sets (JWKS), and DID documents. Signing key distribution methods include API gateways, hosted by issuer at a pre-defined URL, embedded in certificates, and by block-chain based resolution. Establishing root of trust by trust anchor or distributing trust list has been accomplished by API gateway, hosted URL, private dissemination and other bilateral sharing agreements.</p>

<p>While some variability is expected in an approach that preserves sovereignty, there are opportunities for alignment in key format and distribution for the sake of fostering interoperability. With that goal, we provide a unifying trust list format to assemble and share public key infrastructure for all credential specifications used by existing trust networks. Importantly, this format does not enforce a particular policy framework for participants of the trust network.</p>

<p>The GDHCN currently supports two means for key distribution of keys using trust lists</p>
<ul>
  <li><a href="openapi/index.html">EU DCC API</a> <strong>required</strong></li>
  <li><a href="concepts_did.html">Decentralized Identifier (DID)</a> optional</li>
</ul>

<h4 id="trust-network">Trust Network</h4>
<p>A Trust Network is a means to authenticate the encryption public keys used by participants within a network to perform encryption services, verify digital signatures, establish secure connections between systems, and otherwise make use of encryption public keys.</p>
<p><strong>Trust Network</strong></p>
<p><img src="trust_network.png" alt="Trust Network" style="width:70%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<h4 id="trust-network-gateway-tng">Trust Network Gateway (TNG)</h4>
<p>The Trust Network Gateway (TNG) is the open-source software and its IT operational infrastructure, utilizing open standards, for a Public Key Infrastructure and metadata management services which is used to operationalize one or more Trust Domains.  The Trust Network Gateway can be interacted with using the <a href="openapi">API</a> once a mTLS connection has been established.</p>

<h5 id="trust-network-gateway---trust-anchor--tngta">Trust Network Gateway - Trust Anchor  (TNG<sub>TA</sub>)</h5>
<p>The Trust Anchor public key certificate of the TNG. The corresponding private key is used to sign the list of all SCA certificates offline.</p>

<h5 id="trust-network-gateway---transport-layer-security--tngtls">Trust Network Gateway - Transport Layer Security  (TNG<sub>TLS</sub>)</h5>
<p>The TLS server public key certificate of the TNG.</p>

<h4 id="trust-network-participant-tnp">Trust Network Participant (TNP)</h4>
<p>Trust Network Participant (TNP) is an acronym used to label certificates, infrastructure, or technical artifacts made available by GDHCN Participants under the GDHCN Trust Network.</p>

<h5 id="gdhcn-participant-backend-system">GDHCN Participant Backend System</h5>
<p>A GDHCN Participant's Backend System for managing the local part of information. The implementation of GDHCN Participant's Backend System is not in the scope of this document. A national backend can be also understood as a trusted party on-boarded in the Trust Network Gateway (can be a script, a proxy or a web server as well).</p>

<h5 id="trust-network-participant---data-exchange-certificate-authority--tnpdeca">Trust Network Participant - Data Exchange Certificate Authority  (TNP<sub>DECA)</sub></h5>
<p>The DSCA public key certificate of a GDHCN Participants (could be more than one).</p>

<p>The DECA public key certificate of a GDHCN Participants (could be more than one).
The DECA is a certificate which acts a trust anchor in the verification of the certificate chain for the DESCs issued by a Trust Network Participant"</p>

<h5 id="trust-network-participant---document-signing-certificate-authority--tnpdsca">Trust Network Participant - Document Signing Certificate Authority  (TNP<sub>DSCA)</sub></h5>
<p>The DSCA public key certificate of a GDHCN Participants (could be more than one).
The DSCA is a certificate which acts a trust anchor in the verification of the certificate chain for the DSCs issued by a Trust Network Participant"</p>
<h5 id="trust-network-participant---transport-layer-security-tnptls">Trust Network Participant - Transport Layer Security (TNP<sub>TLS</sub>)</h5>
<p>The TLS client authentication public key certificate of a GDHCN Participant's Backend System.</p>

<h5 id="trust-network-participant---transport-layer-security-tnpup">Trust Network Participant - Transport Layer Security (TNP<sub>UP</sub>)</h5>
<p>The public key certificate that a GDHCN Participant uses to sign data packages that are uploaded to the TNG.</p>

<h5 id="trust-network-participant-verifier">Trust Network Participant Verifier</h5>
<p>A system utilized by a GDHCN Participant to verify the digital signature of a Verifiable Digital Health Certificate.</p>

<h4 id="trusted-service">Trusted Service</h4>
<p>A service (digital or otherwise) related to the issuance, management, verification, exchange, or other relevant processes, of Verifiable Digital Health Certificates which is defined using open, interoperable digital health standards.</p>

<h4 id="verifiable-digital-health-certificate">Verifiable Digital Health Certificate</h4>
<p>Verifiable Digital Health Certificate: A digital representation of a data set comprising a certificate or document, designed for a set of specific clinical or public health use cases which is defined using open, interoperable digital health standards; that contains within, or is associated to, a digital signature which can be verified by the public key of a public-private encryption key pair, and which is issued by a GDHCN Participant.</p>

<p><a name="l1807">​</a>The specific Verifiable Digital Health Certificates are defined in the <a href="content_profiles.html">Content Profiles</a></p>

<h3 id="certificate-governance">Certificate Governance</h3>

<p>This document describes the Public Key Certificate Governance utilized by the WHO GDHCN. See the <a href="concepts.html">concepts</a> document for further information.</p>

<p><strong>Note:</strong> In the embedded image the following relabels apply:</p>
<ul>
  <li>DCCG -&gt; TNG</li>
  <li>CSCA -&gt; SCA</li>
  <li>DCC -&gt; GDHCN</li>
  <li>NB -&gt; TNP</li>
</ul>

<h4 id="context">Context</h4>
<p>The core functionality is the secure and trusted exchange of signature keys for GDHCN Trust Network Gateway (TNG) which acts as a central repository for the public keys. GDHCN Participants are empowered to publish the public keys that they use to sign Verifiable Digital Health Certificate. Relying GDHCN Participants can use the TNG to fetch up-to-date public key material on a timely basis.</p>

<p>The trust model of the GDHCN framework is a Public Key Infrastructures (PKI). Each GDHCN Participant maintains one or more Signing Certificate Authority (SCA), certificates of which are relatively long lived. The SCA issues public key certificates for the short lived, Document Signers (i.e. signers for digital health certificates), which are called Document Signer Certificates (DSCs). The SCA acts as a trust anchor such that relying GDHCN Participants can use the SCA certificate to validate the authenticity and integrity of the regularly changing DSC certificates. Once validated, the GDHCN Participant can provide these certificates (or just the public keys contained therein) to their validation applications.</p>

<p>Besides SCAs and DSCs, the TNG <em>also</em> relies on PKI to authenticate transactions, sign data, as the basis for authentication and as a means to ensure integrity of the communication channels between the GDHCN Participant and the TNG.&lt;</p>

<p>The following picture presents a high-level overview of the system.</p>

<p><strong>Overview</strong></p>
<p><img src="Overview.PNG" alt="Overview" style="width:70%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<h4 id="scope-of-document">Scope of Document</h4>
<p>Digital signatures can be used to achieve data integrity and authenticity. Public Key Infrastructures establish trust by binding public keys to verified identities (or issuers). This is necessary to allow other participants to verify the data origin and the identity of the communication partner and decide about trust. In the TNG, multiple public key certificates are used for authenticity. This document defines which public key certificates are used and how they should be designed in order to allow broad interoperability between the different GDHCN Participants. This document is based on [1] and [2]. It provides more details on the necessary public key certificates and it gives guidance on certificate templates and validity periods for countries that want to operate their own SCA. 
Since DSCs shall be verifiable for a defined time-frame (starting from the issuing, expire after a given time), it is necessary to define a verification model for all signatures applied on the public key certificates and the digital health certificate. 
Legal and administrative procedures are not in the scope of this document, they must be defined separately.</p>

<h4 id="terminology">Terminology</h4>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 (<a href="https://tools.ietf.org/html/rfc2119">RFC2119</a>, <a href="https://tools.ietf.org/html/rfc8174">RFC8174</a>) when, and only when, they appear in all capitals, as shown here.</p>

<p>These <a href="concepts.html">concepts</a> and the following table contains abbreviations and terminology used throughout this document.</p>

<table>
  <thead>
    <tr>
      <th>Term</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Certificate</td>
      <td>Or public key certificate. An X.509 v3 certificate that contains the public key of an entity</td>
    </tr>
    <tr>
      <td>EC-DSA</td>
      <td>Elliptic Curve Digital Signature Algorithm. A cryptographic signature algorithm based on elliptic curves</td>
    </tr>
    <tr>
      <td>mTLS</td>
      <td>Mutual TLS. The Transport Layer Security Protocol with mutual authentication</td>
    </tr>
    <tr>
      <td>RSA</td>
      <td>Asymmetric cryptographic algorithm based on integer factorization used for digital signatures or asymmetric encryption</td>
    </tr>
  </tbody>
</table>

<h4 id="tng-communication-flows-and-security-services">TNG communication flows and security services</h4>
<p>This section gives an overview of the communication flows and security services in the TNG system. It also defines which keys and certificates are used to protect the communication, the uploaded information, the digital health certificates, and a signed trust list that contains all on-boarded SCA certificates. The following figure gives a high-level overview of the TNG communication flow and security services. The following sub-sections will explain the design in more detail.</p>

<p><strong>Trust Model</strong></p>
<p><img src="TrustModel.PNG" alt="Trust Model" style="width:70%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<h5 id="general">General</h5>
<p>The TNG works as a data hub that allows the exchange of signed data packages for GDHCN Participants. In the current phase, the signed data packages contain the DSC that are used by the GDHCN Participants. This allows other GDHCN Participant Backends to fetch them and distribute the information to their validation apps. Even if the DSCs are already signed by the SCA, this approach allows to extend the system later to allow Backends the upload of different, potentially unsigned, content (like validation rules).</p>

<p>Uploaded data packages are provided by the TNG “as is”, meaning that the TNG does not add or delete DSCs from the packages it receives. The Backend systems of the GDHCN Participants shall be enabled to verify the end-to-end integrity and authenticity of the uploaded data (see Section "Integrity and authenticity of uploaded data").</p>

<p>In addition to this -  GDHCN Participant Backend systems and the TNG will use mutual TLS authentication to establish a secure connection (see Section "Authentication and connection establishment"). So this is in <em>addition</em> to the signatures in the data exchanged.</p>

<h5 id="authentication-and-connection-establishment">Authentication and connection establishment</h5>
<p>The TNG uses Transport Layer Security (TLS) with mutual authentication to establish an authenticated encrypted channel between the GDHCN Participant's Backend and the Trust Network Gateway environment and utitlize its <a href="openapi">API</a>. Therefore, the TNG holds a TLS server certificate, abbreviated TNG<sub>TLS</sub> - and the GDHCN Participant's Backends hold a TLS client certificate – abbreviated TNP<sub>TLS</sub>. Certificate templates are provided in Section "Certificate Templates".</p>

<p>Every GDHCN Participant's Backend can provide their own TLS certificate. This certificate will be whitelisted explicitly and thus may be issued by a publicly trusted certificate authority (e.g. a certificate authority that follows the baseline requirements of the CA Browser forum), by a jurisdictional certificate authority or it can be self-signed. Every GDHCN Participant is responsible for their jurisdictional data and the protection of the private key used to establish the connection to the TNG. Clearly, the “bring your own certificate” approach requires a well-defined registration and identification process as well as revocation and renewal procedures that are described in Section "Registration of GDHCN Participant Backends".</p>

<p>The TNG uses a whitelist where the TLS certificates of GDHCN Participant Backends are added after their successful registration. Only GDHCN Participant Backends that authenticate themselves with a private key that corresponds to a certificate from the whitelist can establish a secure connection to the TNG.</p>

<p>The TNG will also use a TLS certificate that allows the GDHCN Participant Backends to verify that they are indeed establishing a connection to the “real” TNG and not some malevolent entity posing as TNG. The TNG<sub>TLS</sub> certificate will be issued from a publicly trusted CA (included in all major browsers). It is the responsibility of the GDHCN Participants to verify that their connection to the TNG is secure (for example by checking the fingerprint of the TNG<sub>TLS</sub> certificate of the server connected to against the one provided post registration).</p>

<h5 id="signing-certificate-authorities-and-validation-model">Signing Certificate Authorities and Validation Model</h5>
<p>All GDHCN Participants that take part in the GDHCN framework MUST use an SCA to issue the DSCs. GDHCN Participants MAY have more than one SCA, e.g. in case of delegation authorities.
Each GDHCN Participant can either use existing certificate authorities or they can set up a dedicated (possibly self-signed) certificate authority for the SCA system.
The GDHCN Participants MUST present their SCA certificate(s) to the GDHCN Secretariat during the official <a href="concepts_onboarding.html">on-boarding procedure</a>. After successful registration of the GDHCN Participant (see section "Registration of GDHCN Participant Backends" for more details), the GDHCN Secretariat will update a signed trust list that contains all SCA certificates that are active. The GDHCN Secretariat will use a dedicated asymmetric key pair to sign the trust list and the certificates in an offline environment. The private key will not be stored on the online TNG system, such that a compromise of the online system does not enable an attacker to compromise the trust list. The corresponding trust anchor certificate TNG<sub>TA</sub> will be provided to the GDHCN Participants during the onboarding process. GDHCN Participants can retrieve the trust list from the TNG for their verification procedures.</p>

<p>The SCA is defined as the certificate authority that issues DSCs, hence GDHCN Participants that use a multi-tier CA hierarchy (e.g. Root CA -&gt; SCA -&gt; DSCs) MUST provide the subordinate certificate authority that issues the DSCs.  So in that case - if a GDHCN Participant uses an existing certificate authority - the GDHCN system will <em>ignore</em> anything above the SCA – and whitelist only the SCA as the trust anchor (even though it is a sub-ordinate CA). This is as the ICAO model [2] only allows for exactly two levels - a 'root' SCA and a single 'leaf' DSC signed by just that SCA.
In case a GDHCN Participant operates its own SCA, the GDHCN Participant is responsible for the secure operation and key management of that CA. It must be noted that the SCA acts as the trust anchor for DSCs and therefore, protecting the private key of the SCA is essential for the integrity of the Trust Network environment.</p>

<p>The verification model in the Trust Network PKI is the shell model (for example, defined in [3]), which states that all certificates in the certificate path validation must be valid at a given time (i.e. the time of signature validation). Therefore, the following restrictions apply:</p>
<ul>
  <li>The SCA SHALL NOT issue certificates that are valid longer than the CA certificate itself (see [2, Section 5]).</li>
  <li>The document signer SHALL NOT sign documents that are valid longer than the DSC itself.
GDHCN Participants that operate their own SCA MUST define validity periods for their SCA and all issued certificates, and they MUST take care of certificate renewal. Section "Certificate authorities, validity periods and renewal" contains recommendations for validity periods.</li>
</ul>

<h5 id="integrity-and-authenticity-of-uploaded-data">Integrity and authenticity of uploaded data</h5>
<p>GDHCN Participants can use the TNG to upload and download digitally signed data packages after successful mutual authentication. In the beginning, these data packages contain the DSCs of the GDHCN Participants.</p>

<p>The key pair that is used by the GDHCN Participant's Backend for the digital signature of uploaded data packages in the TNG system is called Trust Network Participant upload signature key pair and the corresponding public key certificate is abbreviated by TNP<sub>UP</sub> certificate. Each Trust Network Certificate brings its own TNP<sub>UP</sub> certificate, which can be self-signed, or issued by an existing certificate authority, such as a public certificate authority (i.e. a certificate authority that issues certificate in accordance with the CAB-Forum baseline requirements). The TNP<sub>UP</sub> certificate shall be different from any other certificates used by the GDHCN Participant (i.e. SCA, TLS client or DSCs).</p>

<p>The GDHCN Participants MUST provide the upload certificate to the GDHCN Secretariat during the initial registration procedure (see Section "Registration of GDHCN Participant Backends" for more details). Every GDHCN Participant is responsible for their jurisdiction's data and it must protect the private key that is used for signing the uploads. Other GDHCN Participants can verify the signed data packages using the upload certificates that are provided by the TNG.</p>

<p>The TNG verifies the authenticity and integrity of the uploaded data with the TNP<sub>UP</sub> certificate before it is provided to other GDHCN Participants.</p>

<h5 id="requirements-on-the-technical-tng-architecture">Requirements on the technical TNG architecture</h5>
<p>The requirements on the technical TNG architecture can be summarized as follows:</p>
<ul>
  <li>The TNG uses mutual TLS authentication to establish an authenticated encrypted connection with the GDHCN Participant Backends. Therefore, the TNG maintains a whitelist of registered TNP<sub>TLS</sub> client certificates.</li>
  <li>The TNG uses two digital certificates (TNG<sub>TLS</sub> and TNG<sub>TA</sub>) with two distinct key pairs. The private key of the TNG<sub>TA</sub> key pair is maintained offline (not on the online components of the TNG).</li>
  <li>The TNG maintains a trust list of the TNP<sub>SCA</sub> certificates that is signed with the TNG<sub>TA</sub> private key.</li>
  <li>The ciphers used MUST meet the requirements from Section "Cryptographic requirements".</li>
</ul>

<h4 id="certificate-life-cycle-management">Certificate Life-cycle Management</h4>

<h5 id="registration-of-gdhcn-participant-backends">Registration of GDHCN Participant Backends</h5>
<p>GDHCN Participants MUST register with the GDHCN Secretariat to take part in the TNG system. This section describes the technical and operational procedure that MUST be followed to register a GDHCN Participant Backend. Legal and administrative procedures are not in the scope of this document, they must be defined separately.</p>

<p>The GDHCN Secretariat and the GDHCN Participant MUST exchange information on technical contact persons for the on-boarding process. It is assumed that the technical contact persons are legitimated by their GDHCN Participants and identification/authentication is performed through other channels.</p>

<p>The GDHCN Participant MUST provide three digital certificates during the registration and identification process:</p>
<ul>
  <li>The Trust Network Participant's TLS certificate TNP<sub>TLS</sub></li>
  <li>The Trust Network Participant's upload certificate TNP<sub>UP</sub></li>
  <li>The Trust Network Participant's SCA certificate(s) TNP<sub>SCA</sub></li>
</ul>

<p>All provided certificate MUST adhere to the requirements defined in Section "Certificate templates". The GDHCN Secretariat will verify that the provided certificate adheres to the requirements of Section "Certificate templates". <br/><br/>
After the identification and registration, the GDHCN Secretariat</p>
<ul>
  <li>adds the TNP<sub>SCA</sub> certificate(s) to the trust list signed with the private key that corresponds to the TNG<sub>TA</sub> public key</li>
  <li>adds the TNP<sub>TLS</sub> certificate to the whitelist of the TNG TLS endpoint</li>
  <li>adds the TNP<sub>UP</sub> certificate to the TNG system</li>
  <li>provides the TNG<sub>TA</sub> and TNG<sub>TLS</sub> public key certificate to the GDHCN Participant</li>
</ul>

<h5 id="certificate-authorities-validity-periods-and-renewal">Certificate authorities, validity periods and renewal</h5>
<p>In case a GDHCN Participant wants to operate its own SCA, the SCA certificates will most probably be self-signed certificates. They act as the trust anchor of the Network Participant state and therefore the GDHCN Participant must strongly protect the private key corresponding to the SCA certificate’s public key. It is recommended that the GDHCN Participants use an offline system for their SCAs, i.e. a computer system that is not connected to any network. Multi-person control should be used to access the system (e.g. following the four eyes principle). After signing DSCs, operational controls should be applied and the system that holds the private SCA key should be stored safely with strong access controls. Hardware Security Modules or Smart Cards can be used to further protect the SCA private key.</p>

<h6 id="validity-periods">Validity periods</h6>
<p>Digital certificates contain a validity period that enforces certificate renewal. Renewal is necessary to use fresh cryptographic keys and to adapt the key sizes when improvements in computation or new attacks threaten the security of the cryptographic algorithm that is used.  The shell model applies (see Section "Signing Certificate Authorities and Validation Model").
The following validity periods are recommended based on the assumption of the one-year maximum validity for Verifiable Digital Health Certificates :</p>

<ul>
  <li>SCA: 4 years</li>
  <li>DSC: 2 years</li>
  <li>Upload: 1-2 years</li>
  <li>TLS Client authentication: 1-2 years</li>
</ul>

<p>For a timely renewal, the following usage period for the private keys are recommended:</p>
<ul>
  <li>SCA: 1 year</li>
  <li>DSC: 6 months</li>
</ul>

<p>GDHCN Participants MUST create new upload certificates and TLS certificates timely, e.g. one month, before expiration in order to allow smooth operation. SCA and DSC SHOULD be renewed at least one month before the private key usage ends (considering the necessary operational procedures). GDHCN Participants MUST provide updated SCA, upload and TLS certificates to the GDHCN Secretariat.</p>

<p>Expired certificates SHALL be removed from the whitelist and trust list.</p>

<p>GDHCN Participants and the GDHCN Secretariat MUST keep track of the validity of their own certificates. There is no central entity that keeps record of the certificate validity and informs the participants.</p>

<p>The following picture shows the private key usage periods and certificate lifetimes for the recommended times in case that GDHCN Participants want to operate their own SCA (assuming one-year maximum lifetime of signed documents).</p>

<p><strong>Validity Times</strong></p>
<p><img src="ValidityTimes.PNG" alt="Validity Times" style="width:70%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<p>GDHCN Participants might define different validity periods for their public key certificates.</p>

<h5 id="revocation-of-certificates">Revocation of certificates</h5>
<p>In general, public key certificates can be revoked by their issuing CA using certificate revocation lists or Online Certificate Status Responder. SCAs for the Trust Network system SHOULD provide certificate revocation lists (CRLs). Even if these CRLs are currently not used by other GDHCN Participants (see [2, Section 5.1]), they SHOULD be integrated for future applications. In case an SCA decides not to provide CRLs, the DSC certificates of this SCA must be renewed when CRLs become mandatory.</p>

<p>A SCA SHOULD NOT use the Online Certificate Status Protocol (OCSP) for their DSCs, due to privacy concerns. GDHCN Participant Verifiers SHOULD NOT use OCSP for verification of the DSCs and SHOULD use CRLs.  It is RECOMMENDED that the GDHCN Participants' Backend performs necessary validation of DSC certificates downloaded from the Trust Network Gateway and only forward a set of trusted and validated DSC to GDHCN Participant Verifiers. GDHCN Participant Verifiers SHOULD NOT perform any revocation checking on DSC in their verification process. One reason for this is to protect the privacy of the holders of Verifiable Digital Health Certificates by avoiding any chance that the use of any particular DSC can be monitored by its associated OCSP responder.</p>

<p>GDHCN Participants can remove their DSCs from the TNG on their own using valid upload and TLS certificates. It must be noted that removing a DSC certificate will mean that all health certificates issued with this DSC will become invalid when GDHCN Participants fetch the updated DSC lists. Clearly, the protection of private key material corresponding to DSCs is crucial.</p>

<p>GDHCN Participants MUST inform the GDHCN Secretariat when they must revoke upload or TLS certificates, for example due to compromise of the GDHCN Participant Backend. The GDHCN Secretariat can then remove the trust for the affected certificate, e.g. by removing it from the TLS whitelist. The GDHCN Secretariat can remove the upload certificates from the TNG database. Packages signed with the private key corresponding to this upload certificate will become invalid when GDHCN Participants remove the trust of the revoked upload certificate.</p>

<p>In case that an SCA must be revoked, GDHCN Participants SHALL inform the GDHCN Secretariat as well as other GDHCN Participants that they have trust relationships with.  The GDHCN Secretariat will issue a new trust list where the affected certificate is no longer contained. All DSCs issued by this SCA will become invalid when GDHCN Participants update their GDHCN Participant Backend trust store.</p>

<p>In case the TNG<sub>TLS</sub> certificate or the TNG<sub>TA</sub> certificate must be revoked, the GDHCN Secretariat and the GDHCN Participants must work together to establish a new trusted TLS connection and trust list.</p>

<h5 id="certificates-for-staging-environments">Certificates for Staging Environments</h5>
<p>The GDHCN Participants and the GDHCN Secretariat will use non-production environments (development, acceptance, testing, etc.) to test the system before they move to production or when new features are released. It is mandatory that public key certificates and the related key material are not reused between the production and the non-production environments. Hence, GDHCN Participants MUST use different public key certificates and private keys for the production and all the non-production environments. This applies to the TNP<sub>TLS</sub>, TNP<sub>UP</sub> certificates of the GDHCN Participants and all DSCs. The TNG<sub>TA</sub> certificates will be different for  production and non-production environments.</p>

<p>There are multiple reasons why certificates should not be reused across different environments. One reason is that the corresponding private keys must be copied from one system to the other and typically non-production environments do not enjoy the same level of protection as production environments. This puts the security of the private keys at risk. In the scope of the Trust Network system there is an additional risk that DSCs issued for testing purpose are published on the production TNG and these DSCs could be used to issue valid health certificates.</p>

<h4 id="certificate-templates">Certificate Templates</h4>
<p><a name="l2285">​</a>The following sections contain cryptographic requirements and guidance as well as requirements on certificate templates. For the TNG certificates, this section defines the certificate templates. Please also refer to the certificate generation examples in the <a href="concepts_CertificatePreperation.html">certificate preparation guide</a>.</p>

<h5 id="cryptographic-requirements">Cryptographic requirements</h5>
<p>Cryptographic algorithms and TLS cipher suites shall be chosen based on the current recommendation from the German Federal Office for Information Security (BSI) or SOG-IS. These recommendations and the recommendations of other institutions and standardization organization are quite similar. The recommendations can be found in the technical guidelines TR 02102-1 and TR 02102-2 (<a href="https://www.bsi.bund.de/EN/Service-Navi/Publications/TechnicalGuidelines/tr02102/tr02102_node.html">source</a>) or SOG-IS Agreed Cryptographic Mechanisms (<a href="https://www.sogis.eu/uk/supporting_doc_en.html">source</a>).</p>
<h6 id="requirements-on-the-dsc">Requirements on the DSC</h6>
<p>The requirements from [2, Section 3.3.2] apply. Hence, it is strongly RECOMMENDED that Document Signers use the Elliptic Curve Digital Signature Algorithm (ECDSA) with NIST-p-256 (as defined in appendix D of FIPS PUB 186-4). Other elliptic curves are not supported.
Due to the space restrictions of the digital health certificate, GDHCN Participants SHOULD NOT use RSA-PSS, even if it is allowed as a fallback algorithm. In case GDHCN Participants use RSA-PSS, they SHOULD use a modulus size of 2048 or max. 3072 bit.
SHA-256 SHALL be used as cryptographic hash function (see ISO/IEC 10118-3:2004).</p>
<h6 id="requirements-on-tls-upload-and-sca">Requirements on TLS, Upload and SCA</h6>
<p>For digital certificates and cryptographic signatures in the TNG context, the major requirements on cryptographic algorithms and key length are summarized in the following table (as of 2021):</p>

<table>
  <thead>
    <tr>
      <th>Signature Algorithm</th>
      <th>Key size</th>
      <th>Hash function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>EC-DSA</td>
      <td>Min. 250 Bit</td>
      <td>SHA-2 with an output length  ≥ 256 Bit</td>
    </tr>
    <tr>
      <td>RSA-PSS (recommended padding)<br/> RSA-PKCS#1 v1.5 (legacy padding)</td>
      <td>Min. 3000 Bit RSA Modulus (N) with a public exponent e &gt; 2^16</td>
      <td>SHA-2 with an output length  ≥ 256 Bit</td>
    </tr>
    <tr>
      <td>DSA</td>
      <td>Min. 3000 Bit prime p, 250 Bit key q</td>
      <td>SHA-2 with an output length  ≥ 256 Bit</td>
    </tr>
  </tbody>
</table>

<p>The recommended elliptic curve for EC-DSA is again NIST-p-256 due to its widespread implementation.</p>

<h6 id="sca-certificate-tnpsca">SCA certificate (TNP<sub>SCA</sub>)</h6>
<p>The following table gives guidance on the TNP<sub>SCA</sub> certificate template in case that a GDHCN Participant decides to operate its own SCA for the DCC system. <strong>Bold</strong> entries are required (MUST be included in the certificate), <em>italic</em> entries are recommended (SHOULD be included). For absent fields, no recommendations are defined.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn= &lt;non-empty and unique common name&gt;</strong>, <em>o=&lt;Provider&gt;</em> ,<strong>c=&lt;GDHCN Participant&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>certificate signing</strong>, <em>CRL signing</em> (at minimum)</td>
    </tr>
    <tr>
      <td><strong>Basic Constraints</strong></td>
      <td><strong>CA = true, path length constraints = 0</strong></td>
    </tr>
  </tbody>
</table>

<p>In accordance to [2, Section 5], the subject name MUST be non-empty and unique within the GDHCN Participant's jurisdiction. The country code (c) MUST match the jurisdiction that will use this SCA. The certificate MUST contain a unique subject key identifier (SKI) according to RFC 5280.</p>

<h5 id="document-signer-dsc">Document Signer (DSC)</h5>

<p>The following table provides guidance on the DSC certificate template in accordance to [2, Section 5]. <strong>Bold</strong> entries are required (MUST be included in the certificate), <em>italic</em> entries are recommended (SHOULD be included). For absent fields, no recommendations are defined.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Serial Number</strong></td>
      <td><strong>unique serial number</strong></td>
    </tr>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn=&lt;non-empty and unique common name&gt;</strong> , <em>o=&lt;Provider&gt;</em> ,<strong>c=&lt;GDHCN Participant that uses this DCS&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>digital signature</strong> (at minimum)</td>
    </tr>
  </tbody>
</table>

<p>The DSC MUST be signed with the private key corresponding to an SCA certificate that is used by the GDHCN Participant.</p>

<p>The following extension are to be used in accordance to [2, Section 5]:</p>
<ul>
  <li>The certificate MUST contain a Authority Key Identifier (AKI) matching the Subject Key Identifier (SKI) of the issuing SCA certificate</li>
  <li>The certificate SHOULD contain a unique Subject Key Identifier (in accordance to RFC 5280)</li>
</ul>

<p>In addition, the certificate SHOULD contain the CRL distribution point extension pointing to the certificate revocation list (CRL) that is provided by the SCA that issued the DSC.</p>

<p>The following extensions are to be used as defined in [2, Appendix A4]. Countries MAY also include an extendedKeyUsage entry with <em>zero</em> or more (i.e. up to 3) entries from:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.1 for Test Issuers</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.2 for Vaccination Issuers</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.3 for Recovery Issuers</td>
    </tr>
  </tbody>
</table>

<p>These values are defined as non-critical, therefore all applications should handle new and/or unknown OIDs gracefully.</p>

<h5 id="upload-certificates-tnpup">Upload Certificates (TNP<sub>UP</sub>)</h5>
<p>The following table provides guidance for the GDHCN Participant Backend upload certificate. <strong>Bold</strong> entries are required (MUST be included in the certificate), <em>italic</em> entries are recommended (SHOULD be included). For absent fields, no recommendations are defined.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn= &lt;non-empty and unique common name&gt;</strong>, <em>o=&lt;Provider&gt;</em> ,<strong>c=&lt;GDHCN Participant that uses this upload certificate&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>digital signature</strong> (at minimum)</td>
    </tr>
  </tbody>
</table>

<h5 id="gdhcn-participant-tls-client-authentication-tnptls">GDHCN Participant TLS Client Authentication (TNP<sub>TLS</sub>)</h5>
<p>The following table provides guidance for the GDHCN Participant Backend TLS client authentication certificate. <strong>Bold</strong> entries are required (MUST be included in the certificate), <em>italic</em> entries are recommended (SHOULD be included). For absent fields, no recommendations are defined.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn=&lt;non-empty and unique common name&gt;</strong>, <em>o=&lt;Provider&gt;</em>, <strong>c= &lt;GDHCN Participant that uses this TLS&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>digital signature</strong> (at minimum)</td>
    </tr>
    <tr>
      <td><strong>Extended Key Usage</strong></td>
      <td><strong>client authentication (1.3.6.1.5.5.7.3.2)</strong></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>The certificate MAY also contain the extended key usage <em>server authentication (1.3.6.1.5.5.7.3.1)</em> but is not required.</li>
</ul>

<p>Beware that self-signed certificates should also contain the key usage <em>Certificate signing</em> (<code class="language-plaintext highlighter-rouge">keyCertSign</code>), so that OpenSSL can verify the (self) signature of the certificate.</p>

<h5 id="trust-list-signature-certificate-tngta">Trust list signature certificate (TNG<sub>TA</sub>)</h5>
<p>The following table defines the TNG Trust Anchor certificate.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn= Digital COVID Certificate Gateway, o=&lt;Provider&gt; , c=&lt;GDHCN Participant&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>digital signature</strong> (at minimum)</td>
    </tr>
  </tbody>
</table>

<h5 id="tng-tls-server-certificates-tngtls">TNG TLS Server certificates (TNG<sub>TLS</sub>)</h5>
<p>The following table defines the TNG TLS certificate.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Subject</strong></td>
      <td><strong>cn=&lt;FQDN or IP address of the TNG&gt;</strong>, <strong>o=&lt;Provider&gt;</strong> ,<strong>c= &lt;GDHCN Participant&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>SubjectAltName</strong></td>
      <td><strong>dnsName: &lt;TNG DNS name&gt; or iPAddress: &lt;TNG IP address&gt;</strong></td>
    </tr>
    <tr>
      <td><strong>Key Usage</strong></td>
      <td><strong>digital signature</strong> (at minimum)</td>
    </tr>
    <tr>
      <td><strong>Extended Key Usage</strong></td>
      <td><strong>server authentication (1.3.6.1.5.5.7.3.1)</strong></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>The certificate MAY also contain the extended key usage <em>client authentication (1.3.6.1.5.5.7.3.2)</em> but is not required.</li>
</ul>

<p>The TLS certificate of the TNG will be issued by a publicly trusted certificate authority (included in all major browsers and operating systems, following the CAB Forum baseline requirements).</p>

<h4 id="references-1">REFERENCES</h4>
<p>[1] Interoperability of health certificates – Trust Framework – v. 1.0 – 12.03.2021 – eHealth Network – available at https://ec.europa.eu/health/sites/health/files/ehealth/docs/trust-framework_interoperability_certificates_en.pdf - last accessed 27.04.2021<br/>
[2] Technical Specifications for Digital COVID Certificates Volume 1 V1.0.5  - eHealth Network – available at  https://ec.europa.eu/health/sites/health/files/ehealth/docs/digital-green-certificates_v1_en.pdf - last accessed 27.04.2021<br/>
[3] ETSI EN 319 102-1: Electronic Signatures and Infrastructures (ESI); Procedures for Creation and Validation of AdES Digital Signatures; Part 1: Creation and Validation – version 1.1.1, 2016 – available at https://www.etsi.org/deliver/etsi_en/319100_319199/31910201/01.01.01_60/en_31910201v010101p.pdf – last accessed 23.04.2021</p>

<h3 id="onboarding-process-1">Onboarding Process</h3>

<p>The following describes the on-boarding processes for the Global Digital Health Certification Network (GDHCN).</p>

<p>The GDHCN Secretariat manages the Onboarding Process and Letters of Applications of eligible GDHCN Participants to connect as a trusted party to the trust network. Prepared onboarding records will be handed over to the GDHCN Secretariat with the request to process the technical on-boarding of the trusted party. An organizational and technical successful application results in a confirmation and the GDHCN Participant can connect to the trust network as a trusted party.</p>

<div style="display:block">
	<img src="OnboardingOverview.drawio.png" style="float:none; margin: 0px 0px 0px 0px;"/>
</div>

<p>Please review the:</p>
<ul>
  <li><a href="concepts.html">Concepts</a> underpinning the description of these on-boarding processes including the general description of the Terms of Participation;</li>
  <li><a name="l2928">​</a><a href="concepts_onboarding_initialproces_full.html">Onboarding Overview</a> describing the overview of the onboarding process;</li>
  <li><a href="concepts_certificate_governance.html">Certificate Governance</a> describing the governance of public key certificates;</li>
</ul>

<p>An eligible GDHCN Participant should complete the <a href="concepts_onboarding_checklist.html">Onboarding Checklist</a> which contains guiding videos through the onboarding process.</p>

<p>After positively assessing the Letter of Application and assessing the Technical Evaluation Form, WHO will:</p>
<ul>
  <li>provide the necessary technical specifications and configuration information to connect to their back-end systems to the WHO GDHCN Trust Network Gateway (TNG)</li>
  <li>invite the GDHCN Participant to register their production certificates and promote them to the production environment.</li>
</ul>

<p>The <a href="GDHCN_Administrative_and_Operational_Framework.pdf">GDHCN Administrative and Operational Framework</a> should be considered the authoritative source of definitions and concepts in case of any discrepncies.</p>

<h4 id="overview-of-the-onboarding-process">Overview of the Onboarding Process</h4>

<p>The full GDHCN onboarding process is divided it into three main stages as per the following figure:</p>

<div style="display:block">
	<img src="OnboardingProcessStepsSimple.png" alt="Onboarding Stages" style="width:600px; float:none; margin: 0px 0px 0px 0px;"/>
</div>
<p>Figure 1: Onboarding Stages</p>

<h5 id="prepare-key-material-submission">Prepare Key Material Submission</h5>

<p>To establish a connection with the Trust Network Gateway (TNG) and become a participant of the GDHCN, the participant is required to prepare their own key materials for us to onboard onto the gateway. This process necessitates technical expertise for the preparation of X.509 certificates, which are to be stored in a GitHub repository owned by the participant for submission.</p>

<p>In order to start the onboarding participants need to Prepare Key Material Submission.</p>

<p>Please follow the steps described in the: <a href="https://github.com/WorldHealthOrganization/tng-participant-template">tng-participant-template</a>
and <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/README.md">README.md</a>.</p>

<p>For more information, you can check the following resources:</p>

<p>A <a href="https://smart.who.int/trust/OnboardingProcessInteractionParticipantAndWHO.png">Diagram</a> that gives and overview about the steps in order to start the Full Onboarding.</p>

<p>The <a href="https://smart.who.int/trust/blob/docs/OnboardingProcess_Documents/input/pagecontent/concepts_onboarding_process_full.md">document</a> contain a detailed description of the tasks to be carried out by the participant.
 Note: Please note that the participant’s work begins at step 8 and ends at step 14.</p>

<p>Once we have received your submission and successfully onboarded the material, we will contact you to start the next phase of testing.</p>

<h5 id="perform-acceptance-testing">Perform Acceptance Testing</h5>

<p>After we contacted the participant about successful onboarding, a connectivity test should be the first action of the process. When connectivity is successfully established the participant should execute their acceptance tests. These acceptance tests must be performed on dedicated test environment called User Acceptance Testing (UAT) which already connects other trust network participants, that applied for onboarding.</p>

<p>The <a href="openapi">Trust Network Gateway API</a> can be used for interaction keeping the full functionality of the EU DCC Gateway. In addition, various HL7 FHIR services are being added.</p>

<p>The participant needs to [communicate the results] of their tests to us, a quality check about the communicated results will be carried out, so that we can check for any issues or approve their readiness for production rollout.</p>

<h5 id="go-live-on-production-environment">Go Live on Production Environment</h5>

<p>Once the acceptance stage has been successfully completed and approved, the process to Go Live on Production Environment can commence. This involves submitting the key material targeted for the production environment (as outlined in stage 1), followed by onboarding to the production environment. The participant will be notified once the Go Live on Production Environment has been successful.</p>

<h4 id="onboarding-application-requirements">Onboarding Application Requirements</h4>

<p>Eligible GDHCN Participants are invited to submit a signed with:</p>
<ul>
  <li>the necessary information to connect to the production environment</li>
  <li>attestation to comply with the Terms of Participation.</li>
</ul>

<p>The application of the GDHCN Participant must contain at least:</p>

<ul>
  <li>One or more TNP<sub>SCA</sub>s, one TNP<sub>TLS</sub> and one TNP<sub>UP</sub> ;</li>
  <li>A statement about the acceptance of keys and processes of other jurisdictions which are present in the gateway lists; and</li>
  <li>Contact Persons - Technical, Legal, Business Owner.</li>
</ul>

<h4 id="letters-of-application">Letters of Application</h4>

<h5 id="letters-of-application---ddcc">Letters of Application - DDCC</h5>

<p>DDCC: The Trust Domain for the Digital Documentation of COVID-19 Certificates</p>
<ul>
  <li><a href="Letter_of_Application_Transitive_Trust.docx">Letter of Application for DDCC using the Transitive Trust</a></li>
  <li><a href="Letter_of_Application_DDCC.docx">Letter of Application for DDCC by the Full Onboarding Process</a></li>
  <li><a href="Letter_of_Application_DDCC-Arabic.docx">Letter of Application for DDCC by the Full Onboarding Process - Arabic Version</a></li>
  <li><a href="Letter_of_Application_DDCC_Chinese.docx">Letter of Application for DDCC by the Full Onboarding Process - Chinese Version</a></li>
  <li><a href="Letter_of_Application_DDCC_French.docx">Letter of Application for DDCC by the Full Onboarding Process - French Version</a></li>
  <li><a href="Letter_of_Application_DDCC_Russian.docx">Letter of Application for DDCC by the Full Onboarding Process - Russian Version</a></li>
  <li><a href="Letter_of_Application_DDCC-Spanish.docx">Letter of Application for DDCC by the Full Onboarding Process - Spanish Version</a></li>
</ul>

<h5 id="letters-of-application---ph4h">Letters of Application - PH4H</h5>
<h5 id="letters-of-application---ips-pilgrimage">Letters of Application - IPS Pilgrimage</h5>

<h4 id="secretariat-tasks">Secretariat Tasks</h4>
<p>The secretariat must handle the following tasks to establish the on-boarding process:</p>

<ul>
  <li>The organizational identity and contact will be established in an offline process by WHO through it's Member State country offices with appropriate contacts at ministries of health or appropriate public health agency.</li>
  <li>providing a Secure Channel for the GDHCN Participant to deliver secure and trustworthy applications SCA and/or DID information;</li>
  <li>creation and Securing a Key Pair (Trust Anchor)  to sign/confirm on-boarding requests for the gateway;</li>
  <li>delivering the Public Key of the Trust Anchor to the Gateway Operations; and</li>
  <li>transmitting On-boarding Requests to the Gateway Operations.</li>
</ul>

<h4 id="details-of-the-onboarding-process">Details of the Onboarding Process</h4>

<p>This document describes the standard onboarding process (so called Future Onboarding Process - FOP).</p>

<p><strong>Note:</strong> In the embedded image the following relabels apply:</p>

<ul>
  <li>
    <p>DCCG -&gt; TNG</p>
  </li>
  <li>
    <p>CSCA -&gt; SCA</p>
  </li>
  <li>
    <p>DCC -&gt; VDHC (Verifiable Digital Health Certificate)</p>
  </li>
  <li>
    <p>NB -&gt; TNP</p>
  </li>
</ul>

<p>It is highly recommended:</p>

<ul>
  <li>
    <p><strong>To use certificates issued from a public CA which follows the CAB Forum Rules</strong></p>
  </li>
  <li>
    <p><strong>Not to reuse any certificates across the different staging environments</strong></p>
  </li>
</ul>

<p>In the following description the required steps are divided into three sections:</p>

<p><strong>[1]</strong> - <strong>[29]</strong> - Application and Verification<br/>
<strong>[30]</strong> - <strong>[59]</strong> Setup<br/>
<strong>[60]</strong> - <strong>[End]</strong> Participant Onboarding</p>

<p><img src="OnboardingProcess_Full.png" style="float:none; margin: 0px 0px 0px 0px;"/></p>

<h5 id="application-and-verification">Application and Verification</h5>

<p><strong>[1]</strong> The eligible Trust Network Participant (TNP) has to submit its Statement of Interest [link to the form. [Document 5] ] to gdhcn-support@who.int .</p>

<p><strong>[2 – 3]</strong> WHO validates all provided data and verify that such a data follows WHO compliance with Trusted Network Terms of Participation (TOP 0 – 3) https://smart.who.int/trust/concepts.html as well as: Participant´s eligibility criteria, governmental entity/health agency, contact details of approvers and individuals. [See Elegibility Criteria]. [Document 16]</p>

<p>&lt; see chapter 9.5 in TOP details &gt; [Document 6]</p>

<p><strong>[4 - 5]</strong> In case no compliance with WHO governance rules is given, the application is rejected. The rejection is communicated to the TNP by email.</p>

<p><strong>[6]</strong> TNP needs to modify the data they shared with WHO and re-apply it.</p>

<p><strong>[7]</strong> If the WHO’s technical team gives a positive opinion, the eligible Trust Network Participant will be invited to start the onboarding process. The following information is included:</p>

<ol>
  <li>The necessary technical specifications and configuration information to connect the local backend systems to the WHO TNG
    <ol>
      <li>The request to provide the necessary information to be onboarded to the different environments (UAT, PROD, DEV (optional))</li>
      <li>The request to comply with the Trust Network Terms of Participation</li>
    </ol>
  </li>
</ol>

<p><strong>[8]</strong> The TNP receives the confirmation and necessary technical information to connect to the TNG and register the certificates.</p>

<p>For a successful connection to the Trust Network Gateway there are the following steps [9] – [11] to prepare:</p>

<p><strong>[9]</strong> Create certificates per environment. Details can be found here: https://smart.who.int/trust/concepts_CertificatePreperation.html</p>

<p>1) Certificates must be prepared for all environments (self-signed allowed) following the requirements in Certificate Governance - Authentication: TNPTLS - Upload: TNPUP - SCA(s): TNPSCA</p>

<p><strong>Note</strong> The participant must provide the CA certificate as well as the TLS certificate.</p>

<p>If the participant uses a self-signed TLS certificate, the TLS certificate can simply be copied and renamed to CA.crt.</p>

<p>In all other cases, the participant provides the appropriate CA certificate.</p>

<p>2) Prepare public keys in PEM format in your private GitHub repository (see [11]) dedicated to the used environment keys.</p>

<p>3) The prepared public keys must be tagged by the generated GPG keys:</p>

<ol>
  <li>Tag the version of your latest information by using git tag + signing commands either from terminal or developer IDE. Please note that an update in GitHub web desktop itself is not working, because the platform will use an intermediate key.</li>
  <li>The bot user clones the latest tag of your private repo and verifies the signature of the tag against the onboarded GPG keys</li>
  <li>After verification of the provisioned material, the content will be taken over for the participant</li>
</ol>

<p><strong>[10]</strong> Create the GPG keys per environment and per each user needed.</p>

<p>Follow the instructions to create a key: https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key</p>

<p>Use Algorithm RSA or EC with minimum key length of 4096 bit (RSA) or 256 bit (EC).</p>

<p><strong>[11]</strong> The TNP creates the private GitHub repositories per environment</p>

<ol>
  <li>Create a private git repository on GitHub.</li>
  <li>Prepare the following information to be provided in the onboarding request:
    <ul>
      <li>Environment repository URL’s (all private to hide uploader's identity) (DEV (optional), UAT, PROD)</li>
      <li>Invite the WHO bot user to the private repository (with read rights). The bot user is: <a href="https://github.com/tng-bot">tng-bot</a> for PROD and <a href="https://github.com/tng-bot-dev">tng-bot-dev</a> for DEV (optional) and UAT environments.</li>
    </ul>
  </li>
</ol>

<p><strong>[12]</strong> Upon GitHub repository creation and invitation to GitHub bot user to WHO is sent, validity for accepting this invitation is 7 days by default. If no action is taken it loses validity.</p>

<p><strong>[13]</strong> Invitation for GitHub bot user must be accepted by WHO within 7 days since invitation was emitted.</p>

<p><strong>[14]</strong> TNP is ready for onboarding according to WHO requirements and governance and has collected the following information in the Letter of Application [Document 16]:</p>

<ul>
  <li>
    <p>the URL of the private GitHub repositories for each environment (UAT, PROD, DEV (optional))</p>
  </li>
  <li>
    <p>the GPG keys per used environment and authorized/responsible person</p>
  </li>
  <li>
    <p>3-digit ISO Participant code</p>
  </li>
  <li>
    <p>The contact details (including email address) of the people authorized to provide the certificates of the TNPThe TNP exchanges the Letter of Application to WHO.</p>
  </li>
</ul>

<p><strong>[15]</strong> The Letter of Application is received and processed by WHO. The TNP .</p>

<p><strong>[16 - 17]</strong> The verification and confirmation of the named people that are allowed to provide the key material for the TNP takes place through either of different channels:</p>

<ol>
  <li>Through a Face to Face meeting</li>
  <li>
    <p>Through Diplomat Channel signed confirmation</p>

    <p>.</p>
  </li>
</ol>

<p>When the Letter of Application is received, identification of individuals take place with passport, finger printing or similar.</p>

<p><strong>[18]</strong> WHO acknowledges the Letter of Application and proceeds to validate the provided data. At this stage verification of rules compliance takes place. Verification is in detailed according to process and individuals involved in the request.</p>

<p><strong>[19]</strong> In case the compliance rules verification failed, WHO need to inform the TNP by email.</p>

<p><strong>[20]</strong> The TNP receive an email with information indicating that validations failed. Corrective activities have to be taken.</p>

<p><strong>[21]</strong> WHO is checking for each provided GPG key, if the given email address is included in the GPG key.</p>

<p><strong>[22]</strong> Validate that GPG key matches cryptographic/governance criteria</p>

<ul>
  <li>
    <p>Key length (min. 3072 bit for RSA and min. 256 bit for ECDSA)</p>
  </li>
  <li>
    <p>mail address in GPG key must match with the provided mail address in the Letter of Application</p>
  </li>
</ul>

<p><strong>[23]</strong> WHO is collecting the required information to be provided to the operations team (OPS):</p>

<ul>
  <li>
    <p>GPG keys of all confirmed people and for all requested environments (UAT, PROD and optional DEV)</p>
  </li>
  <li>
    <p>the URL's of the applicant private GitHub repositories</p>
  </li>
  <li>
    <p>3-digit ISO participant code of the TNP</p>
  </li>
  <li>
    <p>the confirmation that the invitation for the GitHub bot users has been accepted</p>
  </li>
</ul>

<h5 id="setup">Setup</h5>

<p><strong>[30]</strong> The collected onboarding information is sent to the operations (OPS) team. The onboarding (OB) team is informed as well.</p>

<p><strong>[31 - 35]</strong> The onboarding data is taken over to the configuration files by the OPS team to automate the GitHub processes. As a result, a Pull Request (PR) is created. Dependent on the environment, the subsequent steps differ.</p>

<p><strong>[38]</strong> For UAT (and optional DEV), an auto signing process signs the keys.</p>

<p><strong>[36 -37]</strong> For PROD environment, the PR is verified by WHO. After successful verification, the air-gapped signing process is performed to sign the keys. Follow to <strong>[47]</strong></p>

<p><strong>[39]</strong> The service provider checks the PR as well.</p>

<p><strong>[40 - 41]</strong> In case the verification failed, WHO is informed about the outcome.</p>

<p><strong>[42]</strong> Correction.</p>

<p><strong>[43]</strong> In case the verification was successful the whitelisting of the certificates is initiated.</p>

<p><strong>[44 - 46]</strong> and the participant will be informed that the preparation has been completed successfully.</p>

<p><strong>[47]</strong> TSI Verification of Pull Request in PROD Environment.</p>

<p><strong>[48 - 50]</strong> In case Pull Request failed, TSIS to communicate to Participant for them to Correct</p>

<h4 id="participant-onboarding">Participant Onboarding</h4>

<p><strong>[60]</strong> The participant is connecting to UAT environment and the following steps has to be performed to check the connection:</p>

<details> 

<summary> 1) check the connectivity with the following command:  </summary> 
input:

curl -v https://tng-uat.who.int/trustList --cert TLS.pem --key TLS_key.pem 

You should see an output like:

\`\`\`

[

{

"kid": "+jrpHSqdqZY=",

"timestamp": "2023-05-25T07:55:21Z",

"country": "XC",

"certificateType": "UPLOAD",

"thumbprint": "fa3ae91d...",

"signature": "MIAGCSqGSIb3D...",

"rawData": "MIIErTCCA5WgAwIBAgII..."

}

]

\`\`\`

</details>

<p>2) Test the other Trustlist Routes in the same style (e. g. with DSC/SCA/Upload/Authentication…)</p>

<p><strong>[61]</strong> In case the connection fails, some corrective actions must be performed to analyze and solve the issue(s). The operations team is supporting the TNP.</p>

<p><strong>[62]</strong> After the connection to the TNG is established the participant can start the dry run test on UAT.</p>

<p>This test includes the listed steps:</p>

<p>a) Upload one or more DSCs to the TNG</p>

<p>b) Delete at least one DSC again (revocation of a DSC)</p>

<p>c) Optional: Upload it again (if it is required for further testing)</p>

<p>d) Download the trust list from the TNG gateway <a href="openapi">(API)</a></p>

<p>e) Provide sample VDHC s to be verified by the service provider</p>

<p>f) Validate some sample VDHC 's to ensure the validation implementation is working fine</p>

<p><strong>[63]</strong> After executing all required steps, the participant must provide the test results to the onboarding team.</p>

<p><strong>[64 - 65]</strong> The onboarding team checks the results and provides feedback to the participant.</p>

<p><strong>[66]</strong> In case of any issues additional corrective actions are bespoken and solved with the participant.</p>

<p><strong>[67]</strong> If the Dry Run Test has passed successfully, the whitelisting of the certificates in the gateway (PROD environment) continues.</p>

<p><strong>[68 - 69]</strong> The Onboarding team informs the TNP to be ready to connect to TNG PROD environment.</p>

<p><strong>[70]</strong> The participant is allowed and enabled to connect to TNG PROD environment (for detailed information see [60]).</p>

<p><strong>[71]</strong> In case the connection fails, some corrective actions must be performed to analyze and solve the issue(s). The operations team is supporting the TNP.</p>

<p><strong>[72]</strong> After the connection to the TNG PROD is established the Production Readiness Test can start.</p>

<details> 
<summary> This test includes the listed steps: </summary> 

a) Create a Document Signer Certificate (DSC) and sign it by the SCA


b) Create an CMS package with the following command: 

Input:

openssl x509 -outform der -in cert.pem -out cert.der

openssl cms -sign -nodetach -in cert.der -signer signing.crt -inkey signing.key -out signed.der -outform DER -binary

openssl base64 -in signed.der -out cms.b64 -e -A

Note: cert.der is your DSC, signing.crt is the TNPUP


 c) Upload the CMS package to the gateway 

Input:

curl -v -X POST -H "Content-Type: application/cms" --cert TLS.pem --key TLS_key.pem --data @cms.b64 https://tng-uat.who.int/signerCertificate  



 d) Download the trustlist again and check if your DSC is available. &lt;


**Note**: Some versions of curl don’t attach the client certificates automatically. This can be checked via curl –version. Ensure that the used version is linked to OpenSSL. Especially under Windows (https://curl.se/windows/):  
  
OpenSSL Test Example (working)


e) Delete at least one DSC again (Revocation)

f) Upload it again in case the DSC is required

</details>

<p><strong>[73 - 74]</strong> After executing all required steps, the participant must provide the test results to the service provider by mail.</p>

<p><strong>[75]</strong> The service provider checks the results.</p>

<p><strong>[76]</strong> and in case of any issues additional corrective actions are bespoken and solved with the participant.</p>

<p><strong>[77 - 80]</strong> After passing the Production Readiness Test, the participant is allowed to use the TNG PROD environment. A confirmation email is sent to the participant and to WHO with the confirmation about the successfully passed test and the completion of the onboarding process.</p>

<h3 id="federated-pkd-aggregation">Federated PKD Aggregation</h3>

<p>Keys from Local PKDs are aggregated in a federated PKD for use by verification
applications.</p>

<p><strong>ACTORS:</strong></p>
<ul>
  <li>Local PKD – acts as a node within a trust network​</li>
  <li>Aggregating/Federated PKD – trusted aggregation of public keys and trusted services from nodes</li>
</ul>

<p><strong>TRANSACTION:</strong> Mirror Local PKD</p>

<h3 id="federated-verification">Federated Verification</h3>

<p>Verifications can cryptographically verify health credentials using keys retrieved from
the Federated PKD.</p>

<p><strong>ACTORS:</strong></p>
<ul>
  <li>Universal Verification Application –  verifies health documents using Public Key Infrastructure (PKI)​</li>
  <li>Local PKD – acts as a node within a trust network​</li>
  <li>Aggregating/Federated PKD – trusted aggregation of public keys and trusted services from nodes</li>
</ul>

<p><strong>TRANSACTION:</strong> Request PKD</p>

<h3 id="dynamic-business-rule-validation">Dynamic Business Rule Validation​</h3>

<p>Validate one or more verified COVID credential against a dynamic business rule.​</p>

<p><strong>ACTORS:</strong></p>
<ul>
  <li>Universal Verification Application – executes business rules against verified health documents​</li>
  <li>Business Rules Library – trusted service, provided by a node within a trust network, to share business rules using Clinical Quality Language (CQL) specification​</li>
</ul>

<p><strong>PRE-CONDITION:</strong> Verification Application has passed Verification Workflow​</p>

<p><strong>TRANSACTIONS:</strong> Request Business Rule Updates, Execute Business Rule​</p>

<p><strong>OUT OF SCOPE:</strong> consolidating business rules across trust network members​</p>

<h3 id="background">Background</h3>

<p>Business rules for health credentials are the instructions, guidelines, and regulations that
express health policies such as "this course of vaccines meets jurisdiction entry requirements" or
"this patient should complete their immunization schedule". These policies can support a range of
scenarios such as evaluating proof of vaccination or providing continuity of care.</p>

<p>Applying business rules in the context of trust networks for health credentials requires a
computable and standards-based approach for defining the rules and subsequently evaluating them
against credentials. For example, individuals who wish to test their vaccine credentials against
border entry requirement prior to travel must be able to evaluate the business rules for a variety
of destination jurisdictions against a variety of credential formats.</p>

<p>The WHO DDCC effort uses <a href="https://cql.hl7.org/">Clinical Quality Language (CQL)</a>, a standard for
health domain business rules, as the computable representation of business rules to apply against
health credentials in its Global Trust Network. CQL defines a human readable representation of logic
that can be evaluated against clinical knowledge, including health credentials. CQL is a domain
specific language intended to be usable by clinical domain experts to both author and read clinical
expressions and does not require software development expertise. Once CQL has been authored,
running it against clinical knowledge first requires translating the CQL into its canonical
representation, the Expression Logical Model (ELM). The resulting ELM expression of the CQL can be
run against a DDCC health credential using a CQL execution engine. The result can be packaged and
shared, meaning that the execution of CQL does not require a central server and is platform
independent. This ensures that the CQL can be run on health data without requiring personal
health data to be shared.</p>

<p>Health credentials can be specified using multiple standards. DDCC health credentials, which can be
evaluated against CQL business rules, are specified using the
<a href="https://www.hl7.org/fhir/overview.html">Fast Healthcare Interoperability Resources (FHIR)</a>
standard. FHIR is a standard that supports the electronic exchange of healthcare information. The
FHIR standard is based on common internet standards widely used across industry such as the
Hypertext Transfer Protocol (HTTP), JavaScript Object Notation (JSON), representational state
transfer (REST), and the Open Authorization (OAuth) standard.</p>

<h4 id="business-rules-in-practice">Business Rules in Practice</h4>

<p>Using CQL to apply business rules against health credentials in practice is a process that takes
place over a few steps. For example, given a scenario where a health ministry intends to
implement requirements for COVID-19 testing for entry into a country, the following steps would be
followed through the lifecycle of the rules:</p>

<ol>
  <li>
    <p><strong>Conceptualizing the rules:</strong> First, the rules themselves need to be decided at a governance
level. In this example the health ministry may decide to require a negative COVID-19 test within 72
hours to allow entry into a county</p>
  </li>
  <li>
    <p><strong>Authoring the rules:</strong> The rules can be written in CQL by clinical domain experts. For this
example, the CQL would express the 72 hour timeframe and indicate which COVID-19 tests are
acceptable.</p>
  </li>
  <li>
    <p><strong>Publishing the rules:</strong> The CQL rules can be packaged as a FHIR Library resource and published
with an online trust health service. In this example publishing the rules would allow a traveler to
retrieve the published rules to run in a universal verifier application against their SMART Health
Card before traveling to ensure that they meet the entry requirements.</p>
  </li>
  <li>
    <p><strong>Verify the health credentials:</strong> Before CQL can be run against health credentials the
credentials need to be validated to ensure that they are authentic. This validation can make use of
federated cryptography infrastructure to share authentication infrastructure across jurisdictions.</p>
  </li>
  <li>
    <p><strong>Convert the health credentials to the format supported for verification:</strong> The WHO DDCC effort
defines a FHIR-based common standard for health credentials against which CQL can be run.
Credentials in other standards can be converted to the DDCC FHIR standard using FHIR StructureMaps
and ConceptMaps defined in the DDCC Implementation Guide.</p>
  </li>
  <li>
    <p><strong>Execute CQL against the health credentials:</strong> Once the credentials have been converted, the CQL
can be run against them and a result determined. In this example the results would show whether or
not the traveler meets the travel requirements.</p>
  </li>
</ol>

<h3 id="cql-authoring">CQL Authoring</h3>

<p>CQL expresses the logic of business rules in a way that is both human readable and computable. The
logic must be written against a common standard format for representing the credentials for the
logic to be computed against health credentials in a scalable and standardized way.</p>

<h4 id="authoring-tools">Authoring Tools</h4>

<p>CQL can be authored using any text editor, however using an integrated development environment (IDE)
that specifically supports CQL can streamline the experience. The
<a href="https://code.visualstudio.com/">Visual Studio (VS) Code</a>
IDE has a
<a href="https://marketplace.visualstudio.com/items?itemName=jonnokc.clinical-quality-language">CQL extension</a>
that supports syntax highlighting when writing CQL.</p>

<h4 id="cql-structure">CQL Structure</h4>

<p>CQL artifacts are organized around the concept of a library. A CQL library can be thought of as a
container for a specific instance of business logic. A CQL file begins with a declaration of the
library name and version:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library DDCCPass version '1.0.0'
</code></pre></div></div>

<p>Each CQL library operates against one or more specific data models. In the case of CQL intended to
be run against DDCC health credentials the data model is FHIR, which can be specified with the
<code class="language-plaintext highlighter-rouge">using</code> declaration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using FHIR version '4.0.1'
</code></pre></div></div>

<p>CQL libraries can also contain terminology declarations, including codesystems and valuesets. These
declarations allow the CQL to define a local name to represent a codesystem or valueset used in the
CQL logic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>valueset "WHO Specimen Sample Origin": 'https://smart.who.int/ddcc/ValueSet-who-ddcc-sample-origin-covid-19.html'
</code></pre></div></div>

<p>The local name can then be used to reference the codesystem or valueset in the CQL:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define "ValidSampleOrigin": [Observation] O where O.method in "WHO Specimen Sample Origin"
</code></pre></div></div>

<p>The code systems and value sets referenced in DDCC health credentials can be found in the DDCC IG:</p>

<ul>
  <li><a href="https://smart.who.int/ddcc/artifacts.html#terminology-code-systems">DDCC IG Code Systems</a></li>
  <li><a href="https://smart.who.int/ddcc/artifacts.html#terminology-value-sets">DDCC IG Value Sets</a></li>
</ul>

<p>Complete information on authoring CQL, including examples, can be found in the
<a href="https://cql.hl7.org/02-authorsguide.html">CQL Authoring Guide</a>.
Additional guidelines and best practices can be found in the
<a href="https://build.fhir.org/ig/HL7/crmi-ig/branches/master/using-cql.html">CRMI IG CQL Guidelines</a>.</p>

<h4 id="cql-for-health-credentials">CQL for Health Credentials</h4>

<p>The WHO DDCC IG specifies health credentials using the FHIR standard, and the CQL for expressing
business rules against credentials operates on the FHIR resources that make up a credential. The
DDCC health credential document Bundle contains a minimal
<a href="https://smart.who.int/ddcc/StructureDefinition-DDCCPatient.html">Patient</a>
resource along with appropriate linked
<a href="https://smart.who.int/ddcc/StructureDefinition-DDCCImmunization.html">Immunization</a>
resources representing information on vaccines administered and
<a href="https://smart.who.int/ddcc/StructureDefinition-DDCCObservation.html">Observation</a>
resources representing test results.</p>

<p><img src="fhir_representation.png" style="float:none; margin: 0px 0px 0px 0px;"/></p>

<h4 id="packaging-cql-for-distribution">Packaging CQL for Distribution</h4>

<p>CQL can be packaged for distribution in a <a href="https://hl7.org/fhir/library.html">FHIR Library</a>
resource, intended for describing and sharing knowledge artifacts like CQL. The
<a href="https://build.fhir.org/ig/HL7/cqf-measures/packaging.html">CRMI IG Packaging Guidelines</a>
provide information on how CQL libraries should be packaged. Examples of CQL packaged in FHIR
Libraries can be found in the
<a href="https://smart.who.int/ddcc/artifacts.html#knowledge-artifacts-libraries">DDCC IG Knowledge Artifact Libraries</a>.</p>

<h4 id="example-cql">Example CQL</h4>

<p>The following example CQL shows a simple example of business rules applied to immunizations:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Declare the name and version of the Library of functions
library DDCCPass version '1.0.0'

// The version of FHIR we are using
using FHIR version '4.0.1'

// Execute all business rules relative to a specific Patient content
context Patient

// Define boolean valued business rule to check if there is an immunization that was completed
define "Completed Immunization": exists ("Completed Immunizations")

// Define a list of completed immunizations for which the dose number is the same as the series dose
// Immunization resources are queried from those that reference the Patient we are executing against
define "Completed Immunizations":
  [Immunization] I
    where ( I.protocolApplied.doseNumber.value = I.protocolApplied.seriesDoses.value )
</code></pre></div></div>

<h4 id="references-2">References</h4>

<p>CQL authoring resources:</p>

<ul>
  <li><a href="https://cql.hl7.org/01-introduction.html">CQL Introduction</a></li>
  <li><a href="https://cql.hl7.org/02-authorsguide.html">CQL Authoring Guide</a></li>
  <li><a href="https://build.fhir.org/ig/HL7/crmi-ig/branches/master/using-cql.html">CRMI IG CQL Guidelines</a></li>
  <li><a href="https://build.fhir.org/ig/HL7/cqf-measures/packaging.html">CRMI IG Packaging Guidelines</a></li>
</ul>

<h3 id="cql-execution">CQL Execution</h3>

<p>Once CQL has been authored and packaged into a FHIR Library for distribution the CQL can be run in a
CQL execution environment. Before being run, CQL must first be converted into its ELM representation
using the
<a href="https://github.com/cqframework/clinical_quality_language/blob/master/Src/java/cql-to-elm/OVERVIEW.md">CQL-to-ELM Translator</a>.
This conversion can be accomplished using the
<a href="https://github.com/cqframework/cql-translation-service">CQL to ELM Translation Service</a>,
which is also available as a
<a href="https://hub.docker.com/r/cqframework/cql-translation-service">docker image</a>.
The resulting ELM can then be run in a CQL Execution Engine. Available CQL Execution Engines
include:</p>

<ul>
  <li><a href="https://github.com/cqframework/cql-execution">JavaScript CQL Execution Framework</a></li>
  <li><a href="https://github.com/cqframework/cql-engine">Java CQL Evaluation Engine</a></li>
</ul>

<p>There is also a <a href="https://github.com/cqframework/clinical-reasoning">CQL Evaluator</a>, which combines
the CQL-to-ELM Translator with the Java CQL Evaluation Engine.</p>

<h4 id="terminology-1">Terminology</h4>

<p>Running CQL also requires the appropriate terminology references to be present. Running CQL in the
Java CQL Evaluation Engine requires access to a
<a href="http://hl7.org/fhir/R4/terminology-service.html">FHIR terminology server</a>.
The JavaScript CQL Execution Framework, in addition to supporting the use of terminology servers,
also allows terminology resources to be passed into the library at the time of execution.</p>

<h4 id="structure-maps-and-concept-maps">Structure Maps and Concept Maps</h4>

<p>The <a href="https://smart.who.int/ddcc/">DDCC Implementation Guide</a> defines both the
common standard representation against which the CQL can be written and the mappings for translating
various source formats into the common representation. The source formats are</p>

<ul>
  <li><a href="https://build.fhir.org/ig/HL7/fhir-shc-vaccination-ig/">SMART Health Cards: Vaccination &amp; Testing (SMART Health Cards)</a></li>
  <li><a href="https://health.ec.europa.eu/publications/technical-specifications-eu-digital-covid-certificates-volumes-1-5_en">European Union Digital COVID Certificates (EUDCC)</a></li>
  <li><a href="https://www.icao.int/Security/FAL/TRIP/PublishingImages/Pages/Publications/Guidelines%20-%20VDS%20for%20Travel-Related%20Public%20Health%20Proofs.pdf">International Civil Aviation Organization Visible Digital Seals (ICAO VDS-NC)</a></li>
  <li><a href="https://divoc.egov.org.in/">Digital Infrastructure for Verifiable Open Credentialing (DIVOC)</a></li>
</ul>

<p>The common representation that these source health credential formats need to be transformed to
before evaluating CQL business rules is the
<a href="https://smart.who.int/ddcc/content_profiles.html">World Health Organization Digital Documentation of COVID-19 Certificates (WHO DDCC)</a></p>

<p>Translating across formats requires correctly mapping both the structure of the credential and the
clinical concepts expressed within that structure.</p>

<p>Mapping the structure requires pulling data from the source format and expressing it in the
destination format. For example, the name of the credential holder has different representations in
each of the formats and needs to be correctly mapped to the destination format. Mapping the
structure of the credential is accomplished using
<a href="https://fhir-ru.github.io/structuremap.html">FHIR StructureMaps</a>.
StructureMaps define rules that describe how two different structures are related to each other and
provides the logic that defines how instances can be converted from one structure to the other in an
automated fashion.</p>

<p>In addition to mapping the overall structure, clinical concepts need to be correctly mapped. For
example, one format may use LOINC to represent the type of a medical test while another format may
use SNOMED CT. Mapping the clinical concepts from one format to another is accomplished using
<a href="https://fhir-ru.github.io/conceptmap.html">FHIR ConceptMaps</a>.
A ConceptMap defines a mapping from a set of concepts in one code system to concepts in another code
system.</p>

<p><a name="l4085">​</a>Using the StructureMaps to translate formats requires a
<a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language#UsingtheFHIRMappingLanguage-MappingEngineImplementations">mapping engine</a>.
Note that using the Java mapping engine also requires the use of a terminology server; it uses
<a href="tx.fhir.org">tx.fhir.org</a> by default.</p>

<p>References:</p>

<ul>
  <li><a href="https://smart.who.int/ddcc/artifacts.html#terminology-structure-maps">DDCC IG Structure Maps</a></li>
  <li><a href="https://smart.who.int/ddcc/artifacts.html#terminology-concept-maps">DDCC IG Concept Maps</a></li>
  <li><a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language#UsingtheFHIRMappingLanguage-MappingEngineImplementations">Mapping Engine Implementations</a></li>
</ul>

<h3 id="cql-primer">CQL Primer</h3>

<p>This document describes how to run business rules written in <a href="https://cql.hl7.org/">Clinical Quality Language (CQL)</a> against credentials to validate that provided data meets jurisdictional business requirements.</p>

<h4 id="overview">Overview</h4>

<p>The following high level steps, described in detail below, can be used to run CQL business rules against a vaccination record:</p>

<ul>
  <li>Start with a vaccination credential in a supported format and a set of business rules written in CQL</li>
  <li>Set up the <a href="https://github.com/ahdis/matchbox">Matchbox</a> FHIR Server for transforming credentials</li>
  <li>Identify the correct StructureMap for converting the vaccination credential into the DDCC CoreDataSet logical model</li>
  <li>Use Matchbox to transform the credential to a DDCC CoreDataSet logical model instance and then to the corresponding DDCC resource instance</li>
  <li>Set up the CQL Translation Service for converting CQL into the Expression Logical Model (ELM) representation</li>
  <li>Set up a <a href="https://nodejs.org/">Node.js</a> project with appropriate CQL dependencies to provide an execution environment for the ELM representation</li>
  <li>Run the business rules against the FHIR instance</li>
</ul>

<h4 id="convert-vaccination-credentials-to-ddcc-resource-instance">Convert Vaccination Credentials to DDCC Resource Instance</h4>

<p>The process starts with converting the vaccination credential to be evaluated into the DDCC FHIR model. For the examples used in this document we'll start with an example credential payload in the SHC format, which you can download:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://raw.githubusercontent.com/WorldHealthOrganization/ddcc/main/structuremap-tests/fixtures/shc/example-00-b-jws-payload-expanded.json <span class="nt">--output</span> example-00-b-jws-payload-expanded.json
</code></pre></div></div>

<p>Credentials can be converted using the appropriate StructureMaps using the <a href="https://github.com/ahdis/matchbox">Matchbox</a> FHIR Server.</p>

<h5 id="running-the-matchbox-docker-image">Running the Matchbox Docker Image</h5>

<p>The Matchbox server can be run via its docker image.  The following command starts the docker image on a local machine listening on port 8080:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:8080 <span class="nt">--restart</span> unless-stopped eu.gcr.io/fhir-ch/matchbox:v314
</code></pre></div></div>

<p><em>NOTE: At the time of writing the latest version of Matchbox does not correctly handle the required StructureMap transformations; ensure that the version of Matchbox you're testing with has been updated. The Matchbox docker image does not appear to have a correct <code class="language-plaintext highlighter-rouge">latest</code> tag, so be sure to specify the actual version number of the latest docker image.</em></p>

<p>Running Matchbox in this fashion uses an in-memory data store rather than a backing database, so will not persist state across different container instantiations.</p>

<h5 id="loading-igs-into-matchbox">Loading IGs Into Matchbox</h5>

<p>Matchbox needs the appropriate IGs to be loaded in order to perform the desired translations. The DDCC IG and the SHC IG can be loaded via the following curl commands against the Matchbox server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s1">'POST'</span> <span class="se">\</span>
  <span class="s1">'http://localhost:8080/matchbox/fhir/ImplementationGuide'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'accept: application/fhir+json'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Content-Type: application/fhir+json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{ "resourceType": "ImplementationGuide", "version": "1.0.0", "name": "fhir.who.ddcc", "url": "http://smart.who.int/ddcc/package.tgz" }'</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s1">'POST'</span> <span class="se">\</span>
  <span class="s1">'http://localhost:8080/matchbox/fhir/ImplementationGuide'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'accept: application/fhir+json'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Content-Type: application/fhir+json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{ "resourceType": "ImplementationGuide", "version": "0.6.2", "name": "hl7.fhir.uv.shc-vaccination", "packageId": "hl7.fhir.uv.shc-vaccination" }'</span>
</code></pre></div></div>

<h5 id="converting-the-vaccination-credential-into-a-ddcc-fhir-resource">Converting the Vaccination Credential Into a DDCC FHIR Resource</h5>

<p>This is a two step process. The first step is to convert the vaccination credential payload into the DDCC CoreDataSet logical model using the <a href="https://smart.who.int/ddcc/artifacts.html#terminology-structure-maps">appropriate StructureMap from the DDCC IG</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s1">'POST'</span> <span class="se">\</span>
<span class="s1">'http://localhost:8080/matchbox/fhir/StructureMap/$transform?source=http://smart.who.int/ddcc/StructureMap/CertSHCtoCoreDataSet'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'accept: application/fhir+json'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Content-Type: application/fhir+json'</span> <span class="se">\</span>
<span class="nt">-d</span> @example-00-b-jws-payload-expanded.json <span class="se">\</span>
<span class="nt">-o</span> example-00-a-DDCCCoreDataSet.json
</code></pre></div></div>

<p>This should result in a new file containing the vaccine information in the intermediary CoreDataSet format. The data in the intermediary format can then be converted to a DDCC FHIR resource instance:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s1">'POST'</span> <span class="se">\</span>
<span class="s1">'http://localhost:8080/matchbox/fhir/StructureMap/$transform?source=http://smart.who.int/ddcc/StructureMap/CoreDataSetVSToAddBundle'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'accept: application/fhir+json'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Content-Type: application/fhir+json'</span> <span class="se">\</span>
<span class="nt">-d</span> @example-00-a-DDCCCoreDataSet.json <span class="se">\</span>
<span class="nt">-o</span> example-00-a-DDCC.json
</code></pre></div></div>

<p><em>NOTE: At the time of writing these conversion steps did not work correctly, particularly the second one, and the CQL has not been tested against the final version</em></p>

<p>The record is now ready to be evaluated against the business rules.</p>

<h4 id="running-cql-against-converted-vaccination-credentials">Running CQL Against Converted Vaccination Credentials</h4>

<p>Running CQL business rules against a record requires translating the CQL to the Expression Logical Model (ELM) representation and running the ELM in a CQL execution engine. For this document we'll start with one of the <a href="https://smart.who.int/ddcc/artifacts.html#knowledge-artifacts-libraries">examples from the DDCC IG</a>:</p>

<pre><code class="language-cql">// Declare the name and version of the Library of functions
library DDCCPass version '1.0.0'

// The version of FHIR we are using
using FHIR version '4.0.1'

// Execute all business rules relative to a specific Patient content
context Patient

// Define boolean valued business rule to check if there is an immunization that was completed
define "Completed Immunization": exists ("Completed Immunizations")

// Define a list of completed immunizations for which the dose number is the same as the series dose
// Immunization resources are queried from those that reference the Patient we are executing against
define "Completed Immunizations":
  [Immunization] I
    where ( I.protocolApplied.doseNumber.value = I.protocolApplied.seriesDoses.value )
</code></pre>

<p>You can place this example in a file called <code class="language-plaintext highlighter-rouge">DDCCPass.cql</code> and modify it as desired before proceeding.</p>

<h5 id="translating-cql-to-elm">Translating CQL to ELM</h5>

<p>CQL can be translated to ELM using the CQL Translation Service docker image. The following command starts the docker image on a local machine listening on port 8081:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8081:8080 <span class="nt">--restart</span> unless-stopped cqframework/cql-translation-service:latest
</code></pre></div></div>

<p>Once the translation service is running the CQL can be translated to ELM using the following curl command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="s2">"POST"</span> <span class="se">\</span>
<span class="nt">--url</span> <span class="s2">"http://localhost:8081/cql/translator/"</span> <span class="se">\</span>
<span class="nt">--header</span> <span class="s2">"Content-Type: application/cql"</span> <span class="se">\</span>
<span class="nt">--header</span> <span class="s2">"Accept: application/elm+json"</span> <span class="se">\</span>
<span class="nt">--data-binary</span> @DDCCPass.cql <span class="se">\</span>
<span class="nt">--output</span> DDCCPassELM.json
</code></pre></div></div>

<h5 id="extracting-elm-from-a-fhir-library">Extracting ELM From a FHIR Library</h5>

<p>As an alternative to translating the CQL, if the desired CQL already exists and the ELM translation is packaged with the CQL as part of a FHIR Library then the ELM can be extracted from the Library. This document describes how to extract the ELM using a simple Node.js project. Node.js will first need to be installed if it is not already available. A new Node.js project can be set up using npm:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>ExtractELM
<span class="nb">cd </span>ExtractELM
npm init <span class="nt">--yes</span>
</code></pre></div></div>

<p>The following example JavaScript code can serve as a starting point:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This example loads a FHIR Library, extracts the ELM, and writes it to a file</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">argv</span><span class="p">,</span> <span class="nx">exit</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">process</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if </span><span class="p">(</span><span class="nx">argv</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Usage: </span><span class="p">${</span><span class="nx">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span><span class="s2"> </span><span class="p">${</span><span class="nx">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="s2"> &lt;FHIR-Library&gt; &lt;ELM-File&gt;`</span><span class="p">);</span>
  <span class="nf">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">libraryFile</span> <span class="o">=</span> <span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">elmFile</span> <span class="o">=</span> <span class="nx">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="c1">// Load the Library contents and parse the JSON</span>
<span class="kd">const</span> <span class="nx">library</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nf">readFileSync</span><span class="p">(</span><span class="nx">libraryFile</span><span class="p">),</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Find the ELM data</span>
<span class="kd">const</span> <span class="nx">elmContent</span> <span class="o">=</span> <span class="nx">library</span><span class="p">.</span><span class="nx">content</span><span class="p">?.</span><span class="nf">find</span><span class="p">(</span><span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">contentType</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">application/elm+json</span><span class="dl">'</span><span class="p">)</span>
<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">elmContent</span><span class="p">?.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">No ELM content found in Library</span><span class="dl">'</span><span class="p">);</span>
  <span class="nf">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Base64 decode the ELM</span>
<span class="kd">const</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nf">atob</span><span class="p">(</span><span class="nx">elmContent</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="c1">// Write the ELM to the desired output file</span>
<span class="nx">fs</span><span class="p">.</span><span class="nf">writeFileSync</span><span class="p">(</span><span class="nx">elmFile</span><span class="p">,</span> <span class="nx">elm</span><span class="p">);</span>
</code></pre></div></div>

<p>An example FHIR Library containing ELM can be downloaded:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://raw.githubusercontent.com/WorldHealthOrganization/ddcc/main/input/resources/Library-DDCCPass-1.0.0.json <span class="nt">--output</span> Library-DDCCPass-1.0.0.json
</code></pre></div></div>

<p>Once the FHIR Library has been downloaded the code can be run to extract the ELM from the Library:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node main.js Library-DDCCPass-1.0.0.json DDCCPassELM.json
</code></pre></div></div>

<p>Running the script should produce a file with the desired ELM translation.</p>

<h5 id="running-elm-against-converted-vaccination-credentials">Running ELM Against Converted Vaccination Credentials</h5>

<p>The ELM translation of the CQL can be run against the vaccination record using the <a href="https://github.com/cqframework/cql-execution">JavaScript CQL Execution Framework library</a> along with the <a href="https://github.com/cqframework/cql-exec-fhir">JavaScript CQL Execution FHIR Data Source</a>. This document describes how to set this up in a simple Node.js project. Node.js will first need to be installed if it is not already available. A new Node.js project with the needed CQL libraries can be set up using npm:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>CQLDemo
<span class="nb">cd </span>CQLDemo
npm init <span class="nt">--yes</span>
npm <span class="nb">install </span>cql-execution cql-exec-fhir
</code></pre></div></div>

<p>Once the project is set up the ELM from the CQL business rules can be evaluated against the vaccination credential that was converted to the DDCC resource instance. The following example JavaScript code can serve as a starting point:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This example loads an ELM file and vaccination records and evaluates</span>
<span class="c1">// the ELM against each record</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">argv</span><span class="p">,</span> <span class="nx">exit</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">process</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cql</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cql-execution</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cqlfhir</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cql-exec-fhir</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if </span><span class="p">(</span><span class="nx">argv</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Usage: </span><span class="p">${</span><span class="nx">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span><span class="s2"> </span><span class="p">${</span><span class="nx">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="s2"> &lt;ELM-file&gt; &lt;vaccination-record&gt;...`</span><span class="p">);</span>
  <span class="nf">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">elmFile</span> <span class="o">=</span> <span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">recordFiles</span> <span class="o">=</span> <span class="nx">argv</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// Load the ELM and set up the execution environment</span>
<span class="kd">const</span> <span class="nx">elm</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nf">readFileSync</span><span class="p">(</span><span class="nx">elmFile</span><span class="p">),</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">library</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cql</span><span class="p">.</span><span class="nc">Library</span><span class="p">(</span><span class="nx">elm</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">executor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cql</span><span class="p">.</span><span class="nc">Executor</span><span class="p">(</span><span class="nx">library</span><span class="p">);</span>

<span class="c1">// Load all the vaccination records</span>
<span class="kd">const</span> <span class="nx">patientSource</span> <span class="o">=</span> <span class="nx">cqlfhir</span><span class="p">.</span><span class="nx">PatientSource</span><span class="p">.</span><span class="nc">FHIRv401</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">records</span> <span class="o">=</span> <span class="nx">recordFiles</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">filename</span> <span class="o">=&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nf">readFileSync</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">)));</span>
<span class="nx">patientSource</span><span class="p">.</span><span class="nf">loadBundles</span><span class="p">(</span><span class="nx">records</span><span class="p">);</span>

<span class="c1">// Execute the business rules against the records and show the results</span>
<span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">executor</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">patientSource</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
</code></pre></div></div>

<p>This code can be run to execute the business rules against the resource using the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node main.js DDCCPassELM.json example-00-a-DDCC.json
</code></pre></div></div>

<p>Running the script should produce results that look similar to this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Results <span class="o">{</span>
  patientResults: <span class="o">{</span>
    <span class="s2">"ac1efa5f-9a92-48be-95a1-0550f18a349c"</span>: <span class="o">{</span>
      Patient: <span class="o">[</span>FHIRObject],
      <span class="s1">'Completed Immunizations'</span>: <span class="o">[</span>Array],
      <span class="s1">'Completed Immunization'</span>: <span class="nb">true</span>
    <span class="o">}</span>
  <span class="o">}</span>,
  unfilteredResults: <span class="o">{}</span>,
  localIdPatientResultsMap: <span class="o">{</span> <span class="s1">'ac1efa5f-9a92-48be-95a1-0550f18a349c'</span>: <span class="o">{</span> DDCCPass: <span class="o">{}</span> <span class="o">}</span> <span class="o">}</span>,
  patientEvaluatedRecords: <span class="o">{</span>
    <span class="s1">'ac1efa5f-9a92-48be-95a1-0550f18a349c'</span>: <span class="o">[</span> <span class="o">[</span>FHIRObject], <span class="o">[</span>FHIRObject] <span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="requirements">Requirements</h3>

<p>There are a number of requirements that must be met in the process of exchanging trusted health documents.</p>

<h4 id="health-content-interoperability">Health content​ interoperability</h4>

<p><em>Is the correct content included in the certificate/credential or health document?​</em></p>

<p>Consensus data models, controlled vocabularies and data transformations allow consumers of health documents to understand content of a health document in a computable manner. Shared formats for expressing health policies in executable business rule libraries further allow consumers to validate the content against their own public health policies. Here these artifacts are defined using healthcare data specifications aligned with <a href="https://www.hl7.org/">Health Level Seven International (HL7)</a>. HL7 is a not-for-profit, ANSI-accredited standards developing organization dedicated to providing a comprehensive framework and related standards for the exchange, integration, sharing and retrieval of electronic health information.</p>

<h4 id="trust-interoperability-and-trust-networks">Trust interoperability and trust networks​</h4>
<p><em>Is the vaccine credential, COVID certificate or other trusted health document verifiably from the purported issuer?​</em><br/>
<em>Has the certificate remained unaltered since it was issued?​</em></p>

<p>Existing health data certificate standards use various well-defined methods of providing digital signatures in health documents based on public key cryptography methods. Public key distribution within the federated registry is standardized to allow actors across networks to retrieve and process public keys, metadata, business rules, revocation data from any other actor. Universal verifier applications can use the content shared within the federated registry to extract digital signatures from health documents and verify issuer and integrity of the document content according to the specifications established by the credential standard.</p>

<p><em>Is the certificate issuer trusted by the verifier?​</em></p>

<p>The federated registry facilitates determination of trust through services for verifiers to discover issuers from within other networks and access governance policies for those networks. It provides infrastructure for technical governance of participating networks.</p>

<h4 id="identity-authentication-and-identity-binding">Identity authentication and identity binding</h4>

<p><em>Is the individual person who they purport to be?​</em><br/>
<em>Is the certificate about this person?​</em></p>

<p>Identity authentication and identity binding is out of scope for this framework and is determined by policies established at the individual verifier level.</p>

<h2 id="data-models-and-exchange">Data Models and Exchange</h2>

<h3 id="actors">Actors</h3>

<p>Actors produce, manage, or act on health information. Actors relevant to the SMARTx Trust Network are as follows.</p>

<h4 id="credential-issuers">Credential Issuers</h4>
<p>Credential Issuers generate digital vaccine certificates which may be issued to individuals. Issuers may generate 
vaccine certificates using one or more representations including DCC, VDS-NC, DIVOC, SHC, or other formats.</p>

<h4 id="credential-holders">Credential Holders</h4>
<p>Credential Holders are individuals or applications which possess a vaccine certificate.</p>

<h4 id="local-public-key-directory-pkd">Local Public Key Directory (PKD)</h4>
<p>Local PKDs provides access to public keys used to validate vaccine certificates. Many Local PKDs may exist and be associated with one or more jurisdictions or specifications. Format and access mechanisms may vary across Local PKDs.</p>

<h4 id="federated-pkd">Federated PKD</h4>
<p>The Federated PKD provides a signed master list of keys aggregated across one or more Local PKDs.</p>

<h4 id="verification-application">Verification Application</h4>
<p>Verification Applications are capable of verifying cryptographic signatures of vaccine credentials by using public keys. Public keys may be retrieved from either a Local or Federated PKD.</p>

<h4 id="business-rules-library">Business Rules Library</h4>
<p>Trusted service, provided by a node within a trust network, to share business rules using Clinical Quality Language (CQL) specification.</p>

<h3 id="mirror_keys">Mirror Local PKD</h3>
<h4 id="trigger-events">Trigger Events</h4>
<h4 id="message-semantics">Message Semantics</h4>
<h4 id="expected-actions">Expected Actions</h4>

<p>Steps include:</p>
<ul>
  <li>Local PKD onboarding (one-time). Onboarding may include evaluating Local PKD format, providing the Federated PKD access, and signing of business agreements.</li>
  <li>Local PKD public keys are mirrored (periodic)</li>
  <li>Mirrored public keys are merged into a master list (periodic)</li>
  <li>Master list is digitally signed for distribution</li>
</ul>

<p>Local PKDs participating in the Federated PKD are expected to:</p>
<ul>
  <li>Have an existing public key infrastructure used for issuing trusted health documents (e.g. COVID credentials)</li>
  <li>Have permissions/policies in place that allow sharing the public keys</li>
  <li>Can share public keys in one of the following formats:
    <ul>
      <li>X.509</li>
      <li>JSON Web Keys (JWK)</li>
      <li><a href="https://www.w3.org/TR/did-1.0/">Decentralized Identifiers</a> (DID) according to the <a href="concepts_did_gdhcn.html">GDHCN specification</a> specification.</li>
    </ul>
  </li>
</ul>

<p>Federated PKDs are expected to:</p>
<ul>
  <li>Have a means for retrieving local public key directories / nodes members represented in the aggregation services</li>
  <li>Have permissions/policies in place that allow sharing the public keys from trust node members</li>
  <li>Have an existing public key infrastructure used for signing list of keys my node members</li>
  <li>Can share list of public keys in the following format:
    <ul>
      <li><a href="https://www.w3.org/TR/did-1.0/">Decentralized Identifiers</a> (DID) according to the <a href="concepts_did_gdhcn.html">GDHCN specification</a> specification.</li>
    </ul>
  </li>
</ul>

<h3 id="sign_claim">Sign Health Certificate (HCERT)  Claim</h3>
<h4 id="trigger-events-1">Trigger Events</h4>
<p>The claim payload of a <a href="hcert_spec.html">HCERT</a> has been generated and is ready to be signed by an Issuer acting on behalf of a Trust Network Participant.</p>
<h4 id="message-semantics-1">Message Semantics</h4>
<p>The output should be a valid signed <a href="hcert_spec.html">HCERT</a></p>
<h4 id="expected-actions-1">Expected Actions</h4>

<p>&lt;h4 id="put_keys_api} Publish Verification Keys - API</p>
<h4 id="trigger-events-2">Trigger Events</h4>

<p><a name="l5692">​</a>A Trust Network Partcipiant publish keys to the Trust Network Gateway for use by Verification Applications.  Keys may be coded for a variety of uses including following the <a href="concepts_certificate_governance.html">certificate governance</a> according to their <a href="ValueSet-TRUST.KEYUSAGE.html"><strong>$usage</strong></a> and trust <a href="ValueSet-TRUST.DOMAIN.html"><strong>$domain</strong></a></p>

<h4 id="message-semantics-2">Message Semantics</h4>
<p>See <a href="openapi/index.html">Swagger API</a></p>
<h4 id="expected-actions-2">Expected Actions</h4>

<h3 id="get_keys_did">Retrieve Verification Keys - DID</h3>
<h4 id="trigger-events-3">Trigger Events</h4>

<h4 id="message-semantics-3">Message Semantics</h4>
<p>Keys should be retrieved using the <a href="concepts_did_gdhcn.html">GDHCN DID</a> specification.</p>
<h4 id="expected-actions-3">Expected Actions</h4>
<p>Once a Verification Application has onboarded to the Trust Network it may retrieve verification keys.   The retrieved list of verificaiton keys may be used for the following busines processes:</p>
<ul>
  <li>Onboarding a Federated PKD by retrieving the signing key used to sign the master list (one-time).</li>
  <li>Retrieving the master list from the Federated PKD and verifying the signature (periodic).</li>
  <li>Deserializing a Verifiable QR code (e.g.  vaccine credential 2D bar-code) to determine the key id.</li>
  <li>Retrieving the public key associated with the key id from the master list, or using a cached key.</li>
  <li>Verifying
    <ul>
      <li>the cryptographic signature within the 2D barcode.</li>
      <li>the authority of the issuer to issue this type of certificate with this key.</li>
      <li>the expiration date of the keys.</li>
      <li>the expiration date from the certificate.</li>
      <li>the certificate is not part of revocation lists available.</li>
      <li>the issuing key is still present on a trust list by the issuing authority (not revoked).</li>
      <li>the issuing key is still present on the trust list of the verification authority.</li>
      <li>the name/identity on the certificate matches an ID document.</li>
      <li>the business rules of the verification jurisdiction pass for the certificate.</li>
    </ul>
  </li>
</ul>

<h3 id="get_keys_api">Retreive Verification Keys - API</h3>
<h4 id="trigger-events-4">Trigger Events</h4>

<h4 id="message-semantics-4">Message Semantics</h4>
<p>See <a href="openapi/index.html">Swagger API</a></p>
<h4 id="expected-actions-4">Expected Actions</h4>

<p>Once a Verification Application has onboarded to the Trust Network it may retrieve verification keys.   The retrieved list of verificaiton keys may be used for the following busines processes:</p>
<ul>
  <li>Onboarding a Federated PKD by retrieving the signing key used to sign the master list (one-time).</li>
  <li>Retrieving the master list from the Federated PKD and verifying the signature (periodic).</li>
  <li>Deserializing a Verifiable QR code (e.g.  vaccine credential 2D bar-code) to determine the key id.</li>
  <li>Retrieving the public key associated with the key id from the master list, or using a cached key.</li>
  <li>Verifying
    <ul>
      <li>the cryptographic signature within the 2D barcode.</li>
      <li>the authority of the issuer to issue this type of certificate with this key.</li>
      <li>the expiration date of the keys.</li>
      <li>the expiration date from the certificate.</li>
      <li>the certificate is not part of revocation lists available.</li>
      <li>the issuing key is still present on a trust list by the issuing authority (not revoked).</li>
      <li>the issuing key is still present on the trust list of the verification authority.</li>
      <li>the name/identity on the certificate matches an ID document.</li>
      <li>the business rules of the verification jurisdiction pass for the certificate.</li>
    </ul>
  </li>
</ul>

<p>Keys should be retrieved using the <a href="concepts_did_gdhcn.html">GDHCN DID</a> specification.</p>

<h3 id="get_rules_api">Request Business Rule Updates - API</h3>
<h4 id="trigger-events-5">Trigger Events</h4>
<h4 id="message-semantics-5">Message Semantics</h4>
<p>See <a href="openapi/index.html">Swagger API</a></p>

<h4 id="expected-actions-5">Expected Actions</h4>

<h3 id="get_rules_fhir">Request Business Rule Updates - API</h3>
<h4 id="trigger-events-6">Trigger Events</h4>
<h4 id="message-semantics-6">Message Semantics</h4>
<p>Shall act as a Business Rules Library:</p>
<ul>
  <li>Expresses health policies (e.g. “Needs full course of vaccine”) as executable business rule using the Clinical Quality Language (CQL) as a FHIR Library Resource</li>
  <li>Publishes business rules as FHIR Library resources with a trust health service</li>
</ul>

<p>Optionally:</p>
<ul>
  <li>Provide digital signagure of business rule as FHIR Provenance resource</li>
  <li>Provides public key to PKD</li>
</ul>

<h4 id="expected-actions-6">Expected Actions</h4>

<h3 id="execute_rule">Execute Business</h3>
<h4 id="trigger-events-7">Trigger Events</h4>
<h4 id="message-semantics-7">Message Semantics</h4>
<h4 id="expected-actions-7">Expected Actions</h4>

<p>Verification App:</p>
<ul>
  <li>Pre-Condition: Perform Federated Verification workflow on one ore more QR-code</li>
  <li>Identify one (or more) business rule(s) to be exectued according to use case</li>
</ul>

<p>Optionally:</p>
<ul>
  <li>Retrieves business rule signing public key from PKD (either Local PKD or via Aggregating/ Federated PKD)</li>
  <li>Verifies authenticity of business rule</li>
  <li>Map QR-code content into requiste FHIR resources using FHIR Structure Maps</li>
  <li>Execute CQL businns rule on FHIR resource content</li>
</ul>

<h3 id="get_valuesets_api">Request Value Sets - API</h3>
<h4 id="trigger-events-8">Trigger Events</h4>
<h4 id="message-semantics-8">Message Semantics</h4>
<p>See <a href="openapi/index.html">Swagger API</a></p>
<h4 id="expected-actions-8">Expected Actions</h4>

<h3 id="get_valuesets_api">Request Value Sets - FHIR</h3>
<h4 id="trigger-events-9">Trigger Events</h4>
<h4 id="message-semantics-9">Message Semantics</h4>
<p>See <a href="https://profiles.ihe.net/ITI/SVCM/">IHE Sharing Value Sets and Concept Maps</a> for transactions against a Terminology Service.</p>
<h4 id="expected-actions-9">Expected Actions</h4>

<h3 id="execute_rule">Execute Business</h3>

<h4 id="trigger-events-10">Trigger Events</h4>
<h4 id="message-semantics-10">Message Semantics</h4>
<h4 id="expected-actions-10">Expected Actions</h4>

<h3 id="federated-pkd-aggregation-1">Federated PKD Aggregation</h3>

<object data="aggregation.svg" type="image/svg+xml"></object>

<h3 id="federated-verification-1">Federated Verification</h3>

<object data="verification.svg" type="image/svg+xml"></object>

<h3 id="dynamic-business-rule-validation-1">Dynamic Business Rule Validation​</h3>

<object data="business_rule_validation.svg" type="image/svg+xml"></object>

<h3 id="trust-domains">Trust Domains</h3>
<p>A Trust Domain consists of:</p>
<ul>
  <li>Defined use cases and business processes related to the utilization of Verifiable Digital Health Certificates; These Verifiable Digital Health Certificates may be issued or verified through Trusted Services that are enabled by Trust Network Participants of the Digital Health Trust Network.</li>
  <li>the open, interoperable technical specifications that identify or define the applicable Trusted Services and Verifiable Digital Health Certificates; and</li>
  <li>a set of policy and regulatory standards describing expected behavior of GDHCN Participants in relation to operation of the Trusted Services and utilization of Verifiable Digital Health Certificates (e.g. data minimization, privacy, scope of use).</li>
</ul>

<p><a name="l6034">​</a>The codes for the GDHCN Trust Domains are contained in the <a href="ValueSet-WHO.TRUST.DOMAIN.html">GDHCN Trust Domain Value Set</a>.
  </p>

<h4 id="digital-documentation-of-covid-19-certificates-ddcc">Digital Documentation of COVID-19 Certificates (DDCC)</h4>

<p>The <a href="https://www.who.int/publications/i/item/WHO-2019-nCoV-Digital_certificates-vaccination-2021.1">Digital Documentation of COVID-19 Certificates (DDCC)</a> published in August 2021 and similar guidance for test results (https://www.who.int/publications/i/item/WHO-2019-nCoV-Digital_certificates_diagnostic_test_results-2022.1) published in March 2022 serve as the reference for the associated <a href="https://smart.who.int/ddcc/">FHIR Implementation Guide</a>. This Implementation Guide (IG) acts as the computable representation of the core data elements in the published guidance, mapped to standard terminologies. These data models, in the form of FHIR logical models, and terminologies, in the form of FHIR value sets, are the basis for interoperability between the various credential formats. The IG provides FHIR Structure Maps and Concept Maps to define transformations between supported credential formats and the core data set, which allows business rules to execute against a common set of data elements.</p>

<div style="display:block">
  ![DDCC QR Codes and Logical Models](./ddcc_vs_qr_lm.png){:width="850em"}
</div>

<div></div>
<p></p>

<p><br/></p>

<p>At the current time, the following content profiles are recognized through the WHO's <a href="https://worldhealthorganization.github.com/ddcc">Digital Documentation of COVID Certificates (DDCC)</a>:</p>
<ul>
  <li>European Union's <a href="https://health.ec.europa.eu/publications/technical-specifications-eu-digital-covid-certificates-volumes-1-5_en">Digital Covid Certificates (DCC)</a> <strong>(required)</strong></li>
  <li>DIVOC (optional)</li>
  <li>International Civil Aviation Organisation (ICAO) Visible Digital Seals - Non-Constrained (VDS-NC) (optional)</li>
  <li>Smart Health Cards (SHC) - Immunization (optional)</li>
</ul>

<h5 id="source-specifications">Source specifications</h5>

<p>It can be difficult to find the "source of truth" specifications for the certificate formats that are mapped to the DDCC core data sets. The <a href="references.html">references</a> contains links to the best known documentation for each of the certificate formats listed above.</p>

<h4 id="ph4h">PH4H</h4>

<p>The <a href="http://worldhealthorganization.github.iont/smart-ph4h">Pan-American Highway for Digital Health (PH4H)</a> implementation guide describes the usage of the GDHCN for the Americas region.</p>

<h4 id="ips-pilgrimage-ips-pilgrimage">IPS Pilgrimage (IPS-Pilgrimage)</h4>

<p>The  <a href="http://smart.who.int/ips-pilgrimage">IPS Pilgrimage</a> implementation guide includes a machine-readable representation of WHO guidelines for verifiable IPS during pilgrimage. It explicitly encodes computer-interoperable logic, including data models, terminologies, and logic expressions, in a computable language to support implementation of IPS during pilgrimage usage scenario.</p>

<h4 id="terminology-2">Terminology</h4>

<p>These <a href="concepts.html">concepts</a> and the following table contains abbreviations and terminology used throughout this document.</p>

<table>
  <thead>
    <tr>
      <th>Term</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DCC</td>
      <td>Digital COVID-19 Certificate.</td>
    </tr>
    <tr>
      <td>DDCC</td>
      <td>Digital Documentation COVID-19 Certificate.</td>
    </tr>
    <tr>
      <td>DCC Gateway</td>
      <td>REST web-application for exchange of document signer certificates, DCC value sets, DCC business rules and revocation lists for dcc verification purposes between the national backends of connected states.</td>
    </tr>
    <tr>
      <td>ffline SCA certificates.</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>CMS</td>
      <td>Cryptographic Message Syntax. According to <a href="https://datatracker.ietf.org/doc/html/rfc5652">RFC5652</a>. This syntax is used to digitally sign, digest, authenticate or encrypt arbitrary message content.</td>
    </tr>
    <tr>
      <td>JRC</td>
      <td>European Joint Research Centre.</td>
    </tr>
    <tr>
      <td>OG</td>
      <td>Origin Gateway.</td>
    </tr>
    <tr>
      <td><a href="https://cql.hl7.org/">CQL</a></td>
      <td>Clinical Quality Language.</td>
    </tr>
  </tbody>
</table>

<h4 id="introduction">Introduction</h4>
<p>This architectural specification provides the means to establish a federated trust network for use with health records like WHO Digital Documentation of COVID-19 Certificates (DDCC) technical specifications and implementation guidance documents. This is based on the assumption that Trust Network Participant may establish their own independent national trust networks, participate in a regional trust network, or wish to participate in a global federated trust network. Furthermore, Trust Network Participant may wish for these trust networks to be interoperable for domestic and cross-jurisdictional use cases. While specific governance and policy considerations required in the establishment of such interoperable trust networks is out of scope of this document, the intent is that the technical design within this document would support intra-jursidictional and cross-jurisdictional policies of Trust Network Participant.</p>

<p>The Trust Network Gateway (TNG) specifications in this document are designed to support the DDCC specification, which acts as bridging/umbrella specification for various health records like digital COVID certificates (e.g., EU’s DCC, SMART Health Cards, DIVOC, and ICAO). This specification builds on the <a href="https://ec.europa.eu/health/sites/default/files/ehealth/docs/digital-green-certificates_v2_en.pdf">EU Digital Covid Certificate Gateway</a> by extending it in several important ways:</p>
<ul>
  <li>allowing for federation and peer exchange of information between gateways;</li>
  <li>supporting access to metadata content (e.g. value sets/codings, business rules) with explicit adherence to the HL7 FHIR specification;</li>
  <li>providing an explicit means for revocation of digital COVID certificates; and</li>
  <li>allowing for (optional) support of online verification and validation workflows.</li>
</ul>

<p>Within the current DCC system the centralized gateway plays the key role of establishing  trust between all of the connected Trust Network Participant. The gateway operators follow a well-documented process to establish the identity and onboard the trust anchor of each Trust Network Participant. The TNG builds upon this system to enable the creation of trust gateways by other organizations which allows to form a federated network of trust gateways, supporting all of the major COVID-19 credential certificates.</p>

<h5 id="trusted-party-vs-national-backend">Trusted Party vs. National Backend</h5>
<p>The current gateway design is focused on the trust establishment between “National Backends” in terms of a system operated/owned by a national health authority. This can be a script, a fully automated solution or a manual process, which is able to connect the gateway trustfully and able to do uploads and downloads of the content. What other concrete solutions are behind is not in scope of the gateway itself. Within the DDCC scope, the term “National Backend” is worded too sharply, because there can be other parties which can be connected with their publishing system to a gateway in the trust network. Therefore the term “national backend” should be understood within this scope more as “Trusted Party” in terms of an attendee which has received access to a trusted gateway. The trusted gateway or the federator acts then as well as “Trusted Party” to other gateways.</p>

<h4 id="gateway-design-vision">Gateway Design Vision</h4>
<p>Currently EU DCC Gateway is a single centralized system which establishes trust between DCC participants and enables the sharing of business rules, value sets and revocation lists. If another region in the world establishes such a gateway, there is currently no method in the architecture to exchange these trusted data between the two gateways. In this new architecture within the DDCC context, multiple gateways can be connected to each other and share trusted data. In the long term, this architecture will allow the creation of groups and ultimately the establishment of a federation. Such an architecture may be applicable and of interest for non-authority parties e.g. airlines, which desire a read only copy of the gateway content. This can be established by onboarding the airline in a gateway specially setup for this purpose and is connected to the official gateway. To achieve this goal, the architecture must support multiple operation modes e.g. Primary-Secondary. 
The current implementation of EU DCCG is, as mentioned before, a single centralized system which serves as a hub for storing and managing the necessary information gathered from the Trusted Parties.</p>

<p><img src="CurrentView.drawio.png" alt="EU DCC Gateway Design - Central Implementation" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p>The TNG should realize this enhancement of the current implementation of DCCG with the purpose to create a network between multiple gateways for exchanging health record associated public key material, value sets and business rules between different parties (authority, non-authority, commercial). In this architecture a gateway can connect to any other gateway by manually configuring the list of connections and trust relationships. To manage the connections and their download behavior a new component federator is introduced. The federator is a microservice which acts as an automated download client between two gateways and fulfills all responsibilities of trusted data exchange.</p>

<p><img src="ArchitectureVision.drawio.png" alt="TNG Design - Federated Implementations" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p>The backbone of this data exchange is the functionality of the current connector library which connects to the gateway and provides for the consumer the most necessary functionalities. This library is enhanced by the functionality to connect multiple gateways instead of one.</p>

<h5 id="use-cases">Use Cases</h5>

<h6 id="bilateral-onboarding">Bilateral Onboarding</h6>
<p>In Bilateral Onboarding use case the <a href="https://github.com/WorldHealthOrganization/ddcc-gateway-lib">connector library</a> connects as a trusted party to multiple gateways for downloading/uploading content. This requires onboarding on both gateways.</p>

<p><img src="BilateralUsage.drawio.png" alt="TNG Use Case - Bilateral Onboarding" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="peer-to-peer-exchange">Peer to Peer Exchange</h6>
<p>In the peer-to-peer exchange use case, two or more gateways are able to exchange their data in a bi-directional manner. The source and the target gateway enable each other to download the data. All exchanged data will be appended to the existing data within the gateway. This can include the data of third-party gateways, if permitted by the data exchange agreement between two gateways.</p>

<p><img src="P2PExchange.drawio.png" alt="TNG Use Case - Peer-to-Peer" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="primary-secondary-exchange">Primary-Secondary Exchange</h6>
<p>In the primary-secondary exchange use case one or several gateways act as primary source, and another set of gateways act as secondary source . Within this mode, secondaries will download the data of the primary and append it to their own dataset or replace their dataset with the downloaded data. The primary ignores the data of the secondaries, which act just as read copies of the primary gateway. The leading national backends can connect to the primary gateway and upload the data to the one primary gateway.</p>

<p><img src="PrimarySecondaryExchange.drawio.png" alt="TNG Use Case - Primary-Secondary Exchange" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="combined-sources-exchange">Combined Sources Exchange</h6>
<p>In the combined sources exchange use case, the gateway will download data from multiple gateways and append it to its own data set. This results in a combined collection.</p>

<p><img src="CombineSourcesExchange.drawio.png" alt="TNG Use Case - Primary-Secondary" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="trust-mediator">Trust Mediator</h6>
<p>The gateway content can be used to establish trust between attendees which are just loosely coupled, for example Verifier Devices which are known by Trusted Party A, but not directly known by Trusted Party B.</p>

<p><img src="ImplicitTrustRelationShip.drawio.png" alt="TNG Use Case - Implict Trust Relation" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p>To establish the trust between attendees, a trust mediator can be generated which relies on the trustlist of the gateway. The mediator can then use this information to decide whether the trust relationship should be established or not. For instance, the interceptor can check if a signature of a JWT was created by the public key of a certificate which was signed by an onboarded SCA. When the SCA is onboarded and trusted, it proves that the signature was made by someone which has the trust of this SCA. The trust for this attendee is then also given.</p>

<p><img src="ExplicitTrustRelation.drawio.png" alt="TNG Use Case - Excplicit Trust Relation" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h4 id="architecture-overview">Architecture Overview</h4>

<p>The Trust Network Gateway purpose is to enable the secured and trusted exchange of data within a trust network.</p>

<h5 id="data-exchanged-by-tng">Data exchanged by TNG</h5>

<h6 id="metadata-exchange">Metadata Exchange</h6>
<p>TNG provides an interoperable means for exchanging key metadata in support of digital COVID-19 certificates using the HL7 FHIR standards. This includes, in particular:</p>
<ul>
  <li><strong>Value Sets</strong> which should be shared using the transactions defined in the IHE Sharing Value Sets and Concept Maps (SVCM) profile and include the following resources:
    <ul>
      <li>HL7 FHIR ValueSet resources to share codings and terminologies referenced by the various digital COVID certificate specifications (e.g. allowed vaccines or tests).   - HL7 FHIR ConceptMaps may be used to provide mappings between jurisdictionally defined coding DDCC specification coding.</li>
    </ul>
  </li>
  <li><strong>Business Rules</strong> which should follow the <a href="https://docs.google.com/presentation/d/1Bb6oA-4_qPYwvg6iQcZS8CNL1XvdT0R30Vmv9zIstPs/edit#slide=id.gcb76b23c16_2_169">Knowledge Artifact</a> and <a href="https://build.fhir.org/clinicalreasoning-cds-on-fhir.html">Clinical Decision Support infrastructure</a> including the following resources:
    <ul>
      <li>HL7 FHIR Library resources to share libraries of business rules expressed using Clinical Quality Language (CQL)</li>
      <li>HL7 FHIR PlanDefinition resources to indicate which business rule should be executed based on the relevant validation or continuity of care use cases.</li>
    </ul>
  </li>
</ul>

<p>To abstract these requirements, the Trust Network Gateway will introduce a new functionality called “Trusted References”, which allows the gateway to share any kind of service endpoint without sharing the content itself. For backwards compatibility, the functionalities of the DCC Business Rules and Value Sets remain in the architecture, but can be configured to be disabled using profiles. The explicit endpoints for business rules and value sets will be replaced by the trusted references, as the wide variance of medical content should be left to FHIR server implementations instead of the implementation of each service in the gateway itself.</p>

<h6 id="public-key-exchange">Public Key Exchange</h6>
<p>TNG provides a way to share public keys that are used to sign digital COVID certificates as well as provide lists of revoked public key certificates.</p>

<h6 id="reference-exchange">Reference Exchange</h6>
<p>TNG provides the functionality to store secure and trustful resources (i.e. FHIR value sets or Business Rule) which ensures that all attendees in the system have precise knowledge about important sources. These references can be stored in the form of URLs.</p>

<h6 id="issuer-exchange">Issuer Exchange</h6>
<p>For some Credential Types such as Verifiable Credentials, TNG is necessary to ensure the trust in issuers of those credentials. Most credentials carry an issuer ID such as an HTTP URL or a DID with the public key material to verify these credentials. To provide a trusted list of these issuers, the gateway provides functionality to upload issuer IDs.</p>

<h5 id="solution-concept">Solution Concept</h5>
<p>To realize the architectural vision, the existing DCC Gateway will be enhanced by a microservice which implements the TNG Federator component. This federator component is deployed next to the gateway and it handles the communication with other federators. Each federator is able to download the data of other components. Uploading the data to other federators is not foreseen (each gateway downloads over a federator). The trusted consumers can decide to use the federation information and must explicitly activate this feature. To summarize, the federator acts as a gateway connector/synchronizer and as an interface provider for accessing the federated data.</p>

<p><img src="ArchitectureOverview.drawio.png" alt="TNG Use Case - Implicit Trust Relation" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p><b>Note</b>: The DCC Gateway core architecture remains untouched. Just backwards compatible enhancements will be introduced to support the federation.</p>

<h6 id="connection-establishment-to-the-gateway">Connection Establishment to the Gateway</h6>
<p>The DDCC specification provides interoperable standards for exchanging metadata content such as trusted references, trusted certificates and signer certificates with systems via a Trust Network Gateway. This metadata is managed through Trusted Systems which will need a connection/proxying or facade service with the Trust Network Gateway (“TNG Mediator”). This mediator must be onboarded and trusted by the operator of the TNG before upload or download of content is possible. Technically this can be a script, a backend system or an OpenHIM mediator. The main tasks of this kind of software is to establish a mTLS connection with the gateway, sign the uploaded content (e.g. CMS Cryptographic Message Syntax) and upload signed DSCs, revocation entries or releasing business rules. The procedures used in background is out of scope. There may be manual release processes, automatic decisions or other processes, however it is crucial to ensured that the trusted channel and the security of the used certificates for upload/tls connection are not compromised.</p>

<h6 id="options-for-bridging-to-other-systems">Options for Bridging to other Systems</h6>
<p>A bridge tool for translating the received entries of the origin system to the HL7 FHIR / <a href="openapi">Rest API</a> of the gateway is necessary for bridging existing systems (i.e. PKDs or any other systems which contain PKI certificates (e.g. ICAO), Business Rules or Value Sets (e.g. FHIR Servers)) to the TNG. For example, to translate an LDAP based Public Key directory to the gateway, a script/mediator may be set up to extract the DSCs and upload them automatically to the gateway. Please note that in this scenario all SCAs must be onboarded prior to the upload for this process to work.</p>

<p>Under special circumstances when some “mass data transactions” or heavy synchronisations are necessary there may be an option to set up an adapter directly on top of the gateway database. The TNG itself supports JDBC which is able to accept other databases than mysql. For instance if a Cassandra, MongoDb or CouchDB is used and a JDBC driver is available, the data can be replicated across multiple nodes.</p>

<p><b>Note</b>: Database Replications have their own behavior and the functionality of the gateway can not cover each available database. Therefore JDBC feature should be used only if necessary and at own risk.</p>

<h5 id="building-blocks">Building Blocks</h5>
<p>The Trust Network Gateway consists of the DCC Gateway enhanced by callback mechanisms and additional trust list sources, a new federator component with the download client, a federation API, a proxy for outgoing calls and an interface to the routes of the different services.</p>

<p><img src="BuildingBlocks.drawio.png" alt="TNG Building Blocks" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h5 id="trust-model">Trust Model</h5>

<h6 id="overview-1">Overview</h6>
<p>The trust model of the gateway is based on the <a href="https://github.com/eu-digital-green-certificates/dgc-overview/blob/main/guides/certificate-governance.md">PKI certificate governance of the DCC Gateway</a>. All security relevant items are uploaded in signed CMS format and secured by different kinds of PKI certificates as defined by the PKI certificate governance. The central items of the trust model are the SCA to protect the Document Signer Certificates and the CMS messages to protect the uploaded content.</p>

<h6 id="sca--dsc">SCA &amp; DSC</h6>
<p>To sign digital COVID-19 certificates, a Document Signer Certificate (“DSC”) is created by an issuing authority. Each authority distributes their DSCs to verifiers, so that DSC can be used to prove the validity of an issued certificate. To establish a trust chain between used DSCs and the distributors of the national trust lists, each of the DSC is signed by a root authority (“SCA”) to verify the authenticity of the DSC itself. For security reasons, the SCA is declared as air gapped, and the public part is later on-boarded into the gateway. During the onboarding, the SCA is signed by the operator of the gateway to give the trust in the initial check. After onboarding, each incoming DSC can be checked against the trusted SCA. The operator signature (signed by DCCG<sub>TA</sub>) establishes the trust with different certificates such as the uploader certificate and the TLS authentication certificate as defined by the certificate governance.</p>

<p><img src="PKITrustModel.PNG" alt="DDCC PKI Trust Model" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="cms-usage">CMS Usage</h6>
<p>To support multiple content in the gateway in the same security level, the trust model introduces CMS as a generic container for security relevant items. The CMS format allows it to standardize signing and encryption regardless of the content, for single or multiple recipients.</p>

<p><img src="CMSUsage.PNG" alt="CMS Usage" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="enhancement">Enhancement</h6>
<p>The current trust model of the DCC Gateway supports only the connection of multiple backends and the exchange of content between them (see below).</p>

<p><img src="SingleTrustAnchor.png" alt="TNG Implementation - Single Trust Anchor" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p>To realize the architecture vision, the gateway trust model will be enhanced so that the federator can support multiple trust anchors. For this purpose, the TNG Federator will be onboarded in the source gateway with an TNP<sub>TLS</sub> and TNP<sub>UP</sub> certificate to access the gateway content. In the destination gateway, the trust anchor of the source gateway is configured (and signed by the operator) to accept the source content as valid. If the verification is successful, the content will be added as a subset to the existing gateway content. The connected national backends can then download all information by activating the federation option, to get the content from both gateways. The trust chain can be verified about the trust anchor of the connected gateway and the trust list of onboarded trust anchors.</p>

<p><img src="MultipleTrustAnchor.png" alt="TNG Implementation- Multiple Trust Anchor" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p><b>Note</b>: The Federator acts as a special kind of “National Backend”, therefore all TNP associated certificates except the TNP<sub>UP</sub> will be onboarded normally.</p>

<h6 id="raw-public-keys">Raw Public Keys</h6>
<p>The trust model doesn’t support raw public keys due to security reasons especially in cases where:</p>

<p>Raw keys cannot be verified for validity
Raw key ca not be verified by the source (e.g. Root Authority)
Raw keys can be created and shared easily and bad governance “opens the door” to all participants in the trust network</p>

<p>Therefore all raw keys must be converted to an x509 certificate wrapper to be a DSC on the gateway, which must be signed by a properly onboarded SCA. Verification of a COVID-19 certificate is not affected by this process, as long as the correct KID is applied during the upload (and in the certificate).</p>

<h6 id="dsc-limitation">DSC Limitation</h6>

<p>For legacy support, or any need for differentiation in the verification process such as for correct issuers or differentiation in KID calculation. It is recommended that the DSCs contain the following OIDs in the extended key usage field:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.1</td>
      <td>For Test Issuers</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.2</td>
      <td>For Vaccination Issuers</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2021.1.3</td>
      <td>For Recovery Issuers</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2022.1.20</td>
      <td>For raw keys of DIVOC</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2022.1.21</td>
      <td>For raw key of SHC</td>
    </tr>
    <tr>
      <td>extendedKeyUsage</td>
      <td>1.3.6.1.4.1.1847.2022.1.22</td>
      <td>For raw keys in DCCs (calculate kid on Public Key only)</td>
    </tr>
  </tbody>
</table>

<p>The usage of the OID can limit the scope of a Document Signer Certificate during the verification process (if supported by the verifier app). For instance, fraudulent vaccination certificates issued by test centers, will not be valid, as it is signed by an DSC limited to test result certificate issuers.</p>

<p>OID can also be used as an verification indicator as it can indicate that this certificate is a wrapper around raw keys.</p>

<p>Other limitations on the DSC may exist and can be defined, as and when new use cases arise.</p>

<p><b>Note</b>: All extendedKey usages should be well documented on github to avoid confusion regarding the usage. Each necessary attribute should be set up to support the verification process in the best way.</p>

<h5 id="federator-architecture">Federator Architecture</h5>
<h6 id="overview-2">Overview</h6>
<p>The federator is designed as a new sub component which can be hosted as microservice or within the gateway in one deployment. This behavior can be configured during the installation. Overall the federator offers the functionality for automated download of gateway or federation content. The downloaded content is stored in the gateway database to provide the content to the gateways federation endpoints. Trusted parties can download from these endpoints then the federated data.</p>

<h6 id="black-box-view">Black-box View</h6>

<p><img src="BlackBoxView.drawio.png" alt="Blackbox View of the System" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="whitebox-view">Whitebox View</h6>

<p><img src="WhiteBoxView.drawio.png" alt="Blackbox View of the System" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="data-model">Data Model</h6>
<p>####### Federator Configuration</p>

<p><b>Note</b>: Each Federation Route of the Gateway must be configured manually for explicit download, to avoid misunderstandings in configuration. This is important for security reasons. All trust anchors must be onboarded otherwise the content is filtered out.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ID</td>
      <td>int</td>
      <td>Unique ID of the table row</td>
    </tr>
    <tr>
      <td>GatewayId</td>
      <td>GUID</td>
      <td>Unique ID of the other origin gateway.</td>
    </tr>
    <tr>
      <td>GatewayEndpoint</td>
      <td>Varchar</td>
      <td>URL of the other Gateway.</td>
    </tr>
    <tr>
      <td>GatewayKid</td>
      <td>Varchar</td>
      <td>KID of the Origin Gateway Client Certificate to be used to connect to the other gateway. (TNG <sub>TLS FED</sub></td>
    </tr>
    <tr>
      <td>GatewayPublicKey</td>
      <td>Varchar</td>
      <td>ECDSA Public Key of the Gateway Signature</td>
    </tr>
    <tr>
      <td>AuthenticationKID</td>
      <td>Varchar Array</td>
      <td>KIDs of the onboarded TNG<sub>TLS GW</sub> of the other gateway.</td>
    </tr>
    <tr>
      <td>TrustAnchorKIDs</td>
      <td>Varchar Array</td>
      <td>KIDs of the onboarded Trust Anchor (TNG <sub>TA</sub>)</td>
    </tr>
    <tr>
      <td>DownloadTarget</td>
      <td>String</td>
      <td>FEDERATION or GATEWAYONLY</td>
    </tr>
    <tr>
      <td>Mode</td>
      <td>int</td>
      <td>Enum for the download mode. APPEND or OVERRIDE.The append mode adds the downloaded data to the existing data set (existing federation data will be replaced). Override deletes the existing datasets (excepting the own TNP<sub>TLS</sub>, Trust anchors and federation configurations)</td>
    </tr>
    <tr>
      <td>Signature</td>
      <td>Varchar</td>
      <td>Trust Anchor Signature</td>
    </tr>
  </tbody>
</table>

<p>####### Download Scheduler</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GatewayID</td>
      <td>GUID</td>
      <td>Unique ID of the Gateway</td>
    </tr>
    <tr>
      <td>DownloadInterval</td>
      <td>int</td>
      <td>Download Interval</td>
    </tr>
    <tr>
      <td>LastDownload</td>
      <td>TimeStamp</td>
      <td>Last Time of Download</td>
    </tr>
    <tr>
      <td>Retry</td>
      <td>boolean</td>
      <td>Retry Flag</td>
    </tr>
    <tr>
      <td>Message</td>
      <td>String</td>
      <td>Message of Federator</td>
    </tr>
    <tr>
      <td>Failed Retries</td>
      <td>int</td>
      <td>Number of failed Retries</td>
    </tr>
  </tbody>
</table>

<h6 id="endpoints">Endpoints</h6>
<p>To use the federated data, the gateway will be enhanced by federation endpoints which are modified variants of the common GET routes. By using this new endpoints, the common content is modified returned:</p>

<table>
  <thead>
    <tr>
      <th>Verb</th>
      <th>Used in Federator</th>
      <th>Used inMediator</th>
      <th>Route</th>
      <th>Modification/Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>X</td>
      <td>X</td>
      <td>/trustlist/certificates</td>
      <td>Returns the list of trusted certificates. The list can be filtered with optional query parameters. For legacy reasons, all signercertificates introduced in the “DSC” certificate group (if profile enabled) All other certificates should be delivered over query parameter.</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>X</td>
      <td>X</td>
      <td>/trustlist/issuers</td>
      <td>Returns the list of trusted issuers. The list can be filtered with optional query parameters.</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>X</td>
      <td>X</td>
      <td>/trustlist/signatures</td>
      <td>Returns the list signatures for existing trust lists.</td>
    </tr>
    <tr>
      <td>GET</td>
      <td>X</td>
      <td>X</td>
      <td>/trustlist/references</td>
      <td>Returns the list of trusted references. The list can be filtered with optional query parameters.</td>
    </tr>
  </tbody>
</table>

<p><b>Note</b>: All routes should filter the delivered content by hash to avoid duplicate content delivery. Two different federations can receive from a single TP the same content in some circumstances.</p>

<p><em>Common Query Parameters</em></p>

<p>Each route which delivers federated data must provide an query parameter to filter the federations by using an array:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/URL?federationId=id1,id2,id3&amp;Domain=DCC&amp;ResourceType=...
</code></pre></div></div>

<p>If the mode set to “GATEWAYONLY”, it must be used to query just for the configured gateway id.</p>

<p><em>Federation Format</em></p>

<p>The data format of the federated data should always contain a federation wrapper with the information of federationID, Domain and resource type.</p>

<h5 id="download-process">Download Process</h5>

<p>To federate multiple gateway data, a download process is introduced which should ensure that only trusted data is downloaded to a local gateway. Trusted data means in this context, that the operator of a local gateway has the total control which federated data is accepted and which not. To achieve this target, the local gateway operator must explicitly onboard any remote federators plus the trust anchors of the data which can be accepted. This is necessary because each remote federator may deliver the data of multiple other gateways (which are trusted by the origin gateway operator), but this means not necessarily that this data is trusted automatically by the local gateway operator as well (implicit trust relations must be avoided). Therefore, during the download process, a check should be run which skips all data that is not explicitly trusted by the local operator. This can be reached over the whitelisting of multiple trust anchors and the cross check over the TNP<sub>UP</sub> certificates. If the trust chain is established in this way, each content can be downloaded, verified and pushed to the store. The entire download process itself follows a delta download mechanism, which downloads daily the entire content, and within the day just the deltas. This means for the trust network, that a certificate “bubbles” from the origin gateway step by step to all other gateways. Through this behavior, it must be considered that around one day between creating a key pair, and issuing the first certificates with it is considered.</p>

<p><img src="DownloadProcess.drawio.png" alt="Download Process" style="width:400px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h4 id="architecture-modifications--changes">Architecture Modifications &amp; Changes</h4>

<h5 id="eu-dcc-gateway-modifications-spec">EU DCC Gateway Modifications (<a href="https://ec.europa.eu/health/sites/default/files/ehealth/docs/digital-green-certificates_v2_en.pdf">Spec</a>)</h5>
<h6 id="data-tables">Data Tables</h6>
<p>The trusted party table (see chapter 4.2.3.1, EU DCC Gateway) is enhanced with a new certificate type “TRUSTANCHOR” in the <a href="openapi">API</a> call for trust lists these new types appearing. To distinguish between a federator and a normal trusted party, a type (“TP”, “FEDERATOR”,”GATEWAY”)  for the trusted item is introduced. To distinguish between different domains of certificates, the table also gets a new column ''DOMAIN”, which has the default content “DCC''. Other content can be in the moment “ICAO”, “DIVOC” and “SHC”. The domain appears in the trustlist routes.</p>

<p>Each Data Table (SignerInformation, Trusted Issuer, Trusted Reference etc.) gets a new column for the UUID, federation ID and objectVersion. The primary keys are changed to ID + federation id to guarantee the uniqueness.</p>

<h6 id="signerinformation-upload">SignerInformation Upload</h6>
<p>The signer information endpoints must be configurable by a profile to be switched on and off the routes. This is necessary to maintain backwards compatibility with the EU DCC Gateway. In the DDCC context these routes are deactivated.</p>

<h6 id="trusted-certificate-upload">Trusted Certificate Upload</h6>
<p>To support additional use cases, the gateway will be modified with endpoints which allows it to upload certificates signed by the SCA of a Trust Network Partcipant. The upload endpoint works similar to the signer information upload endpoint with the difference that the upload contains more additional information about the certificate. The concrete template for this additional information must be defined by a schema. The certificate upload must support the choice of a kid, because other standards define static kids or choose it in other ways than the DCC. If no kid is provided, the DCC standard calculation of the first 8 bytes of the SHA256 hash is applied.</p>

<h6 id="health-check">Health Check</h6>
<p>To monitor the status of the Gateway, a health check is introduced. The new route returns 200 if the gateway is up and running. When the gateway is in maintenance, the routes must return 204. All other return codes indicate an error.</p>

<h6 id="route-profiles">Route Profiles</h6>
<p>The routes for POST, PUT and DELETE will be modified by profiles to make them configurable. This allows it to switch off the data upload, which is especially for the primary-secondary/combined sources use case. Within this setup, no TNP<sub>UP</sub> certificates need to be onboarded.</p>

<h6 id="value-set-and-business-rules-endpoints">Value Set and Business Rules Endpoints</h6>
<p>The ValueSet and Business Rules endpoints must be configurable by configuration of profiles for enabling/disabling.</p>

<p>Business Rules gets a new endpoint which is returning single objects by using the business rule id (/rules/{TrustNetworkPartcipant}/{ruleId}}.</p>

<p>Note: This new route is introduced to create a migration path to the trusted references. Within EU DCC Standard Mode, there is no backwards compatibility impact.</p>

<h6 id="trusted-references">Trusted References</h6>
<p>The trusted references are URLs which are uploaded by the Trust Network Participants to propagate their service endpoint about value sets, business rules and other content for interoperability. Within the trusted references are just public GET methods allowed. Authorization must be covered by trust mediators, if necessary.</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Optional</th>
      <th>Type</th>
      <th>Description</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>UUID</td>
      <td>No</td>
      <td>String</td>
      <td>UUID for the object.</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>URL</td>
      <td>No</td>
      <td>String</td>
      <td>Can be a HTTP(s)</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Type</td>
      <td>No</td>
      <td>String</td>
      <td>FHIR</td>
      <td>DCC…</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Version</td>
      <td>No</td>
      <td>String</td>
      <td>Any version string.</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Country</td>
      <td>No</td>
      <td>String</td>
      <td>Trust Network Participant where the URL relates to.</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Service</td>
      <td>No</td>
      <td>String</td>
      <td>e.g. ValueSet, PlanDefinition etc.</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Thumbprint</td>
      <td>No</td>
      <td>String</td>
      <td>SHA256 Hash of the content behind it</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Name</td>
      <td>No</td>
      <td>String</td>
      <td>Name of the Service</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>SSLPublicKey</td>
      <td>No</td>
      <td>String</td>
      <td>SSL Certificate of the endpoint (if applicable).</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Content-Type</td>
      <td>No</td>
      <td>String</td>
      <td>MIME Type of Content</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>SignatureType</td>
      <td>No</td>
      <td>String</td>
      <td>NONE</td>
      <td>JWS</td>
      <td>CMS</td>
    </tr>
  </tbody>
</table>

<h6 id="trusted-issuer">Trusted Issuer</h6>
<p>Currently it is possible to onboard SCAs as Issuer Trust Reference for DSCs which makes it hard to use it outside the PKI world. Other credential types like Verifiable Credentials are using DIDs or other Issuer IDs which are not necessarily linked to any SCA, but with crypto material behind it e.g. JWKs sources etc. To support these issuers and their credentials, the gateway will be enhanced by a trusted issuer interface which makes it possible to receive this kind of trusted ids. All of these trusted issuers must be onboarded as SCAs and all other certificates.</p>

<p>A trusted issuer entry which can be onboarded is defined as :</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Optional</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>URL</td>
      <td>No</td>
      <td>String</td>
      <td>Can be a HTTP(s) or DID URL.</td>
    </tr>
    <tr>
      <td>Type</td>
      <td>No</td>
      <td>String</td>
      <td>HTTP or DID</td>
    </tr>
    <tr>
      <td>Country</td>
      <td>No</td>
      <td>String</td>
      <td>Trust Network Participant where the URL relates to.</td>
    </tr>
    <tr>
      <td>Thumbprint</td>
      <td>Yes</td>
      <td>String</td>
      <td>SHA256 Hash of the content behind it (if applicable)</td>
    </tr>
    <tr>
      <td>Name</td>
      <td>No</td>
      <td>String</td>
      <td>Name of the Service</td>
    </tr>
    <tr>
      <td>SSLPublicKey</td>
      <td>Yes</td>
      <td>String</td>
      <td>SSL Certificate of the endpoint (if applicable).</td>
    </tr>
    <tr>
      <td>KeyStorageType</td>
      <td>Yes</td>
      <td>String</td>
      <td>Type of Key Storage. E.g JWKS, DIDDocument, JKS etc.</td>
    </tr>
  </tbody>
</table>

<p>The Entry will be onboarded in the Gateway and signed by the trust anchor.</p>

<p><b>Note</b>: When the URL in this table does not resolve, all the optional fields can be empty. This is less trustful and should be avoided within operations.</p>

<h6 id="deployment">Deployment</h6>
<p>####### Constraints
The TNG may be operated in front with a network component (Load Balancer, <a href="openapi">API Gateway</a> , Reverse Proxy etc.) which handles the Client Certificate Authentication and Client Certificate Attribute extraction of the TLS connection. After the TLS Offloading it depends on the infrastructure, if an internal secured TLS network must be established or not. For example when the TNG is deployed in a distributed service mesh, it’s recommended to use TLS protected channels e.g. SPIFFE/SPIRE based service meshes. Which mode fits better to the deployment depends on the operators infrastructure. The gateway itself can be operated in a SSL Passthrough mode as well.</p>

<p>All other components like proxies, must be aligned in the configured settings to avoid HTTP Smuggling or similar vulnerabilities.</p>

<p>####### Kubernetes Setup</p>

<p><img src="Kubernetes.drawio.png" alt="Download Process" style="width:600px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h5 id="who-trust-network-gateway-modifications">WHO Trust Network Gateway Modifications</h5>

<p>In the last version of the TNG<sup role="doc-noteref" id="fnref:1"><a rel="footnote" href="#fn:1" class="footnote">1</a></sup> architecture, the changes for trusted issuers and trusted certificates were made to allow different types of technologies in trust verification. This could be either X509 or DIDs according to the DID Core Specification<sup role="doc-noteref" id="fnref:2"><a rel="footnote" href="#fn:2" class="footnote">2</a></sup>. During the last iterations of specification and alignment, there were some key points which must be additionally supported in the gateway:</p>

<ul>
  <li>Native DID Support for the Gateway's Trustlists (DID Document Format) (optional)</li>
  <li>Decentralized Exchange of DID Documents to provide it to verifiers</li>
  <li>WHO aligned onboarding process for eligible Trust Network Participants</li>
</ul>

<p>This section describes these changes.</p>

<h6 id="technical-changes">Technical Changes</h6>

<p>To support the DID document feature according to the <a href="https://github.com/WorldHealthOrganization/ddcc-trust/blob/main/TrustListSpecification.md#leading-contender-did-document">trust specification</a>, the gateway will be enhanced by a DID document generator and the capability to sign these DID documents. This contains a way to generate signing keys over a vault and register the public key of the signature over a decentralized key registry.</p>

<p><img src="TechnicalChanges.drawio.png" style="float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="azure-architecture--deployment">Azure Architecture &amp; Deployment</h6>

<p>Microsoft Azure public cloud is the targeted operation environment for the Trust Network Gateway hosted by WHO. The TNG will be operated on Azure Kubernetes Service (AKS) and uses Azure CDN for public key distribution via DID documents.</p>

<p><img src="AzureArchitecture.drawio.png" style="float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="onboarding-process-concept">Onboarding Process Concept</h6>

<p>The WHO Global Digital Health Certification Network Secretariat is responsible to manage the <a href="concepts_onboarding.html">onboarding</a> application of eligible Trust Network Participants to connect as a trusted party to the trust network.</p>

<hr/>

<h3 id="did-specifications">DID Specifications</h3>

<p>The common trust list specification defines the lowest common denominator format that can interoperate between all included specifications and can support the minimal required features from each specification. This includes considering the minimum security requirements that satisfy each of the specifications. It was designed taking into account the following tenets:</p>
<ol>
  <li>SHALL be convertible from each existing trust network's formats</li>
  <li>SHALL describe a key-to-trust-anchor path for all specifications</li>
  <li>SHALL be cacheable</li>
  <li>SHALL be mergeable (trust list operators can integrate each other's entries)</li>
  <li>SHALL be usable by all stakeholders required to verify health credentials in their operations</li>
</ol>

<h4 id="did-document-v20">DID Document v2.0</h4>
<p>In <a href="concepts_did_gdhcn.html">version 2.0 of the WHO GDHCN DID</a> publication specification, multiple DID files are created depending on your key needs.</p>

<h4 id="did-document-v10-deprecated">DID Document v1.0 (deprecated)</h4>
<p>In <a href="concepts_did_v1.html">version 1.0 of the WHO GDHCN DID</a> publication specification a single DID file containing all keys.</p>

<p>#### GDHCN Trustlists</p>

<p>This specification describes the publication of Global Digital Health Certification Network (GDHCN) key material as Decentralized Identifier (DID) documents. 
DIDs are specified by the <a href="https://www.w3.org/TR/did-core/">W3C DID Core Specification</a>.
The <a href="concepts_did.html">DID concept</a> summarizes the core drivers and usage of the DID format in scope of GDHCN.</p>

<p>A key to real interoperability among existing trust networks is to find alignment on trust list formats.</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Status</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2.0.0</td>
      <td>Draft</td>
      <td>2.0.0 is in pre-released state for verification and feedback. On technical level in the API "v2" is used to address DID documents following version two specification</td>
    </tr>
    <tr>
      <td>1.0.0</td>
      <td>Released</td>
      <td>1.0.0 is deprecated and will be replaced by version 2.0.0</td>
    </tr>
  </tbody>
</table>

<h5 id="trustlists-200">Trustlists 2.0.0</h5>

<p>Version 2.0.0 introduces two <strong>variant</strong>s of the trust lists - embedded and by reference.</p>

<p><img src="did-trustlist-types.png" alt="Types of DID trustlists" style="width:300px; float:none; margin: 0px 0px 0px 0px;"/></p>

<p>For each of development (DEV), user-acceptence testing (UAT) and production (PROD) <strong>environment</strong>s there is a trust list according to the following table:</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>Variant</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DEV</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn-dev.who.int/v2/trustlist/did.json">https://tng-cdn-dev.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>DEV</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn-dev.who.int/v2/trustlist-ref/did.json">https://tng-cdn-dev.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn-uat.who.int/v2/trustlist/did.json">https://tng-cdn-uat.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn-uat.who.int/v2/trustlist-ref/did.json">https://tng-cdn-uat.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn.who.int/v2/trustlist/did.json">https://tng-cdn.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn.who.int/v2/trustlist-ref/did.json">https://tng-cdn.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
  </tbody>
</table>

<p>The embedded type of trustlist carries the key material directly within the DID documents' verificationMethod property and supports immediate verification.
On the root level it contains all keys imported from the trust network gateway (TNG).</p>

<p>The reference type lists link other DID documents, which may contain the actual key material.
Therefore reference type trustlists contain only DID ids that can be used to resolve DID documents.
This helps to keep the main trustlist documents concise and supports dynamic discovery of DID structures and key material.</p>

<h6 id="did-trustlists-structure">DID trustlists structure</h6>

<p>Version 2.0.0 introduces a hierarchical structure for DID documents, to support more fine grained resolution and discovery of key material.
These DID documents are parameterized by the following according to the levels in the following table.</p>

<table>
  <thead>
    <tr>
      <th>Level</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>root</strong></td>
      <td>A fixed parameter for all trusted key material or trusted DID references of GDHCN.</td>
    </tr>
    <tr>
      <td><strong>$domain</strong></td>
      <td><a name="l7872">​</a>Contains trusted key material or DID references of GDHCN for a supported trust domain.   <strong>$domain</strong> should be one of the codes in the <a href="ValueSet-WHO.TRUST.DOMAIN.html">GDHCN Trust Domain Value Set</a>.</td>
    </tr>
    <tr>
      <td><strong>$participant</strong></td>
      <td><a name="l7888">​</a>Contains trusted key material or DID references of GDHCN for a trusted participant.  <strong>$participant</strong> should be one of the codes in the  <a href="ValueSet-WHO.TRUST.PARTICIPANT.html">GDHCN Participant Value Set</a>.</td>
    </tr>
    <tr>
      <td><strong>$usage</strong></td>
      <td><a name="l7904">​</a>Contains trusted key material or DID references of a supported key usage type.   <strong>$usage</strong> type is one of the key usages codes in the <a href="CodeSystem-WHO.TRUST.KEYUSAGE.html">GDHCN Key Usage Value Set</a>.</td>
    </tr>
  </tbody>
</table>

<p>The levels are organized hierarchically so that they function as filters following an AND logic operation when resolving or discovering key material.
Note that "-" character can be used as a wildcard on each sublevel of root. 
This allows to omit filtering on the respective level effectively matching all content of that level.</p>

<p>The following examples outline the expected behavior of embedded trustlist:</p>

<ul>
  <li>tng-cdn.who.int/v2/trustlist/did.json matches all keys for all <strong>$domain</strong>s, <strong>$participant</strong>s and key <strong>$usage</strong> types.</li>
  <li>tng-cdn.who.int/v2/trustlist/<strong>$domain</strong>/<strong>$participant</strong>/did.json matches all key <strong>$usage</strong> types for a specific <strong>$domain</strong> AND <strong>$participant</strong>.</li>
  <li>tng-cdn.who.int/v2/trustlist/-/<strong>$participant</strong>/did.json matches all key <strong>$usage</strong> types across all <strong>$domain</strong>s for a specific <strong>$participant</strong>.</li>
  <li>tng-cdn.who.int/v2/trustlist/<strong>$domain</strong>/<strong>$participant</strong>/<strong>$usage</strong>/did.json matches all keys for a specific key <strong>$usage</strong> type for a given <strong>$domain</strong> AND <strong>$participant</strong>.</li>
  <li>tng-cdn.who.int/v2/trustlist/-//did.json matches key material or references for all <strong>$domain</strong>s for a specific <strong>$participant</strong> without filtering the key usage types.</li>
  <li>tng-cdn.who.int/v2/trustlist/-/<strong>$participant</strong>/<strong>$usage</strong>/did.json matches keys or references in all <strong>$domain</strong>s for a specific <strong>$participant</strong> and specific key <strong>$usage</strong> type.</li>
  <li>tng-cdn.who.int/v2/trustlist/<strong>$domain</strong>/-/<strong>$usage</strong>/did.json matches keys for all <strong>$participant</strong>s of a specific <strong>$domain</strong> filtered by there key <strong>$usage</strong> type.</li>
  <li>tng-cdn-who.int/v2/trustlist/-/- matches key material for all <strong>$domain</strong>s and all <strong>$participant</strong>s without filtering a specific <strong>$usage</strong> type so the did.json may contain SCA and DSC keys.</li>
</ul>

<p>And the following examples outline the expected behavior of reference type trustlist:</p>

<ul>
  <li>tng-cdn.who.int/v2/trustlist-ref/did.json contains all DID document references of the next sub-level as DID id.</li>
  <li>tng-cdn.who.int/v2/trustlist-ref/<strong>$domain</strong>/did.json contains all <strong>$participant</strong> level DID document references as DID id for the given <strong>$domain</strong>.</li>
  <li>tng-cdn.who.int/v2/trustlist-ref/<strong>$domain</strong>/<strong>$partcipant</strong>/did.json contains all key <strong>$usage</strong> type level DID document references as DID id for the selected <strong>$domain</strong> and <strong>$participant</strong>.</li>
  <li>tng-cdn.who.int/v2/trustlist-ref/<strong>$domain</strong>/<strong>$participant</strong>/<strong>$usage</strong>/did.json contains a reference to a DID the embedded trustlist that correlates to the selected <strong>$domain</strong>, <strong>$participant</strong> and key <strong>$usage</strong> type and that contains the key material.</li>
</ul>

<p>Note: all levels of the reference type trustlist may contain additional DID references linking trusted external DID documents.</p>

<p>The <a href="https://smart.who.int/trust/did-trustlist-structure.drawio.png">did trustlists structure diagram</a> depicts the reference and contains relations of the trustlist types for the defined levels.</p>

<p><img src="did-trustlist-structure.drawio.png" alt="DID trustlists structure" style="width:600px; float:none; margin: 0px 0px 0px 0px;"/></p>

<h6 id="example-did-documents">Example DID documents</h6>

<p>Reference type DID document linking the embedded trustlist for <strong>$domain</strong>: DCC, <strong>$participant</strong>: XXA and key <strong>$usage</strong> type: DSC.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">@context</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">https://www.w3.org/ns/did/v1</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">https://w3id.org/security/suites/jws-2020/v1</span><span class="dl">"</span>
    <span class="p">],</span> 
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist-ref:DCC:XXA:DSC</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">controller</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist-ref:DCC:XXA</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">verificationMethod</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist:DCC:XXA:DSC</span><span class="dl">"</span>
    <span class="p">],</span> 
        <span class="dl">"</span><span class="s2">proof</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JsonWebSignature2020</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2024-11-10T12:00:35Z</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">nonce</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SC56sBBcqqTXh0EPdFlaOWDXxSpwupVa</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">proofPurpose</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">assertionMethod</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">verificationMethod</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:raw.githubusercontent.com:WorldHealthOrganization:tng-participants-dev:main:WHO:signing:DID</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">jws</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eyJiNjQiOmZhbHNlLCJjcml0IjpbImI2NCJdLCJhbGciOiJFUzI1NiJ9..MEQCICxoXFEI-o0SupgO0U5BhKjRI1AZaAtAtw_byQMgLm6CAiBTtyJYF7ZMgWTlmivMv5A4In3K6LBEF0AXiCYM2VSSIg</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Embedded trustlist for <strong>$domain</strong>: DCC, <strong>$participant</strong>: XXA and key <strong>$usage</strong> type: DSC with key matrial:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">@context</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">"</span><span class="s2">https://www.w3.org/ns/did/v1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">https://w3id.org/security/suites/jws-2020/v1</span><span class="dl">"</span>
  <span class="p">],</span>
  <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist:DCC:XXA:DSC</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">controller</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist:DCC:XXA</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">verificationMethod</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist:DCC:XXA:DSC#XPjhL9Znd1M=</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JsonWebKey2020</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">controller</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:worldhealthorganization.github.io:tng-cdn-dev:v2:trustlist:DCC:XXA</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">publicKeyJwk</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">kty</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">EC</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">kid</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">XPjhL9Znd1M=</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">x5c</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">MIICuTCCAmCgAwIBAgIUD9k1Q64Eav5r07DQ4Gff/7h7r6QwCgYIKoZIzj0EAwIwdDELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYDVQQHDA9YQSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZEMRkwFwYDVQQDDBBOYXRpb25YQV9UTlBfU0NBMB4XDTI0MDgwMjEzNDM0M1oXDTI2MDgwMjEzNDM0M1owfzELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYDVQQHDA9YQSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZEMSQwIgYDVQQDDBtIZWFsdGggQWRtaW5pc3RyYXRpb24gb2YgWEEwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAT3TVbWYsSYYarCUv8sfvmv2y0GjDEI+PAkm/92na/zAOoV8O2w7rov/Txk3wwz/jMoKvx+IgSfYoyygtGetYEdo4HEMIHBMA4GA1UdDwEB/wQEAwIHgDAdBgNVHQ4EFgQUhjRj4qGi0+rt7ka7GLiol6q2+78wHwYDVR0jBBgwFoAUoir+zkKsSL7OkG8dPyThX49GLtEwPQYDVR0fBDYwNDAyoDCgLoYsaHR0cDovL2NybC5leGFtcGxlZG9tYWluLmV4YW1wbGUvQ1JML1NDQS5jcmwwMAYDVR0lBCkwJwYLKwYBBAGON49lAQEGCysGAQQBjjePZQECBgsrBgEEAY43j2UBAzAKBggqhkjOPQQDAgNHADBEAiATU7uopFD4U3mLHHQn+0ncg4gb5ZazhhrXMXwzAD4NbgIgd3jcskFPyOoBGut8oyXu+nKYKr5zFCqmXkYlILqCo6Q=</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">MIICMDCCAdWgAwIBAgIUFqWc0xbrcpAettDF8gEymTzDtSkwCgYIKoZIzj0EAwIwdDELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYDVQQHDA9YQSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZEMRkwFwYDVQQDDBBOYXRpb25YQV9UTlBfU0NBMB4XDTI0MDgwMjA3MTY0MVoXDTI4MDgwMjA3MTY0MVowdDELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYDVQQHDA9YQSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZEMRkwFwYDVQQDDBBOYXRpb25YQV9UTlBfU0NBMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEeKTWEuRQ4ftDRaTBA6++wea8ODmEqCLE/nWTcvcX069g3YlWEokVgEIMEumXcez++bcIayhRYDi4itAqd5DmJ6NFMEMwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAQYwHQYDVR0OBBYEFKIq/s5CrEi+zpBvHT8k4V+PRi7RMAoGCCqGSM49BAMCA0kAMEYCIQC2+Bl6No20L/uSxr4bJSPDAAJ37UhhH52ppOElxB1dqgIhANbn1ZF0DNWYyH+eKBTrY+14zbzhDxlXWh/Go1OM9ZZ/</span><span class="dl">"</span>
        <span class="p">],</span>
        <span class="dl">"</span><span class="s2">crv</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P-256</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">APdNVtZixJhhqsJS_yx--a_bLQaMMQj48CSb_3adr_MA</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">y</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AOoV8O2w7rov_Txk3wwz_jMoKvx-IgSfYoyygtGetYEd</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="dl">"</span><span class="s2">proof</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JsonWebSignature2020</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2024-11-10T12:00:21Z</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">nonce</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Gp3uOuUTNgAFxm31fIjNy7yYt34aOP0g</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">proofPurpose</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">assertionMethod</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">verificationMethod</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">did:web:raw.githubusercontent.com:WorldHealthOrganization:tng-participants-dev:main:WHO:signing:DID</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">jws</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eyJiNjQiOmZhbHNlLCJjcml0IjpbImI2NCJdLCJhbGciOiJFUzI1NiJ9..MEYCIQD8AbUnGxHgmkqNQTzl6E0ZJocZ0N-vrziFB9-jgRSXbgIhAJUB0Wq5YUJPcywS15JMdoiVJDV_ubWuEZwRnuM5A8QB</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note: Specific keys use base64 encoded key id (kid) as identifier, It is represented as fragments (#) in verification method id and can be resolved using client side filtering.</p>

<h6 id="environments--repositories">Environments &amp; Repositories</h6>

<p>The trustlists are maintained using GitHub and published via GitHub pages.</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>Repository Link</th>
      <th>Pages Link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Development</td>
      <td><a href="https://github.com/WorldHealthOrganization/tng-cdn-dev">https://github.com/WorldHealthOrganization/tng-cdn-dev</a></td>
      <td><a href="https://worldhealthorganization.github.io/tng-cdn-dev">https://worldhealthorganization.github.io/tng-cdn-dev</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td><a href="https://github.com/WorldHealthOrganization/tng-cdn-uat">https://github.com/WorldHealthOrganization/tng-cdn-uat</a></td>
      <td><a href="https://tng-cdn-uat.who.int">https://tng-cdn-uat.who.int</a></td>
    </tr>
    <tr>
      <td>Production</td>
      <td>tbd.</td>
      <td><a href="https://tng-cdn.who.int">https://tng-cdn.who.int</a></td>
    </tr>
  </tbody>
</table>

<h5 id="trustlist-specification-100">Trustlist Specification 1.0.0</h5>

<p><a href="concepts_did.html">Initial specification</a> is deprecated.</p>

<h4 id="did-document-v10-deprecated-1">DID Document v1.0 (deprecated)</h4>
<p>The unified format is based on the <a href="https://www.w3.org/TR/did-core/">Decentralized Identifiers (DIDs) v1.0</a> specification. DIDs are globally unique identifier in the form of URIs. The URI scheme includes a method name which corresponds to a standard method by which a DID Document can be resolved. This DID Document is a structured JSON-LD which captures each existing public key (regardless of X.509 or JWK format used) by the members of a trust network in a common format. It allows additional metadata (such as intended purpose and key identifiers) to be added to existing keys with changing the underlying keys themselves​. It provides means to publish and cryptographically sign a master lists of keys recognized used by a trust network.</p>

<p>The unified format DID method selected is did:web, a method to retrieve DID Documents via existing web (https) infrastructure​. ​The did:web identifiers have the form <code class="language-plaintext highlighter-rouge">&lt;DOMAIN NAME&gt;:&lt;PATH COMPONENT 1&gt;:...: &lt;PATH COMPONENT N&gt;</code>​. Resolution is accomplished by https GET against the URL which is formed from this identifier by​ <code class="language-plaintext highlighter-rouge">https://​DOMAIN NAME/PATH COMPONENT 1/.../PATH COMPONENT N/did.json</code>. For example did:web:example.com:my:path would resolve a DID Document from the URL <code class="language-plaintext highlighter-rouge">https://example.com/my/path/did.json</code>​. Additional did methods may be supported in the future.</p>

<p>The DID Document itself should have:​</p>
<ul>
  <li>an ‘id’ field which is the DID itself and represents the DID Subject, in this case the trust list</li>
  <li>a list of public keys within the ‘verificationMethod’ field​</li>
  <li>an optional signature via a ‘proof’ field​</li>
</ul>

<p>The verificationMethod array represents the individual signing keys associated with issuers within the entity represented by the DID Subject, an includes:</p>
<ul>
  <li>an <code class="language-plaintext highlighter-rouge">id</code> field which is a DID URL composed of the DID for this DID Document and key ID as ​DID#key</li>
  <li>controller of the public key, which can be current document (in case of publishing a key by a trust network member) or the source of the public key in case of an aggregator</li>
  <li>the public key JWK, including the key's x509 and chain of trust to Root Certificate Authority​</li>
</ul>

<p>The DID Document itself can be signed with addition of a ‘proof’ block containing signature details and key used for verification.</p>

<p>For more information regarding the DID Document format for a Trust List specification, see <a href="https://github.com/WorldHealthOrganization/ddcc-trust/blob/main/TrustListSpecification.md#leading-contender-did-document">WHO DDCC Trust List Specification documentation</a>. For an example of a signed DID Document, see <a href="https://github.com/WorldHealthOrganization/ddcc-trust/blob/main/TrustListSpecification.md#appendix-a-signed-did-document-for-x509-enabled-trust-lists-of-leaf-keys">Appendix A</a> of the documentation.</p>

<h3 id="electronic-health-certificate-specification">Electronic Health Certificate Specification</h3>

<p>Version 1.1.1, 2024-02-27</p>

<p>This specification, originally developed by the European Union (EU), is based on the <a href="https://github.com/ehn-dcc-development/eu-dcc-hcert-spec/blob/66cca0b9c59a9299ad57d767c180bbf8cf5aa5f1/hcert_spec.md">EU Digital Covid Certificate (EU DCC)</a> project by the European eHealth network. The specification is now under the maintenance of the WHO from January 1, 2024. The WHO oversees all updates and modifications to HCERT claims. GDHCN Participants may propose additional claims or modifications through the WHO’s GDHCN Secretariat, ensuring the framework remains responsive and adaptable to evolving global health needs. </p>

<h4 id="1-introduction">1. Introduction</h4>

<p>This document specifies a generic data structure and encoding mechanisms for electronic health certificates. It also specifies a transport encoding mechanism in a machine-readable optical format (QR), which can be displayed on the screen of a mobile device or printed on a piece of paper.</p>

<h4 id="2-terminology">2. Terminology</h4>

<p>Organisations adopting this specification for issuing health certificates are called Issuers and organisations accepting health certificates as proof of health status are called Verifiers. Together, these are called Participants. Some aspects in this document must be coordinated between the Participants, such as the management of a namespace and the distribution of cryptographic keys. It is assumed that a party, hereafter referred to as the Secretariat, carries out these tasks. The health certificate container format (HCERT) of this specification is generic, but in this context used to carry the WHO Digital Covid Certificate (DCC).</p>

<p>The Public Key Infrastructure (PKI) that underpins the trust model consists of a Signing Certificate Authority (SCA) certificate which is used to issue (i.e. sign) the Document Signing Certificate (DSC). The DSC is then used to sign the DCC. The acronyms "PKI", "SCA" and "DSC" are used in the context of the document to refer to the aforementioned concepts.</p>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 (<a href="https://tools.ietf.org/html/rfc2119">RFC2119</a>, <a href="https://tools.ietf.org/html/rfc8174">RFC8174</a>) when, and only when, they appear in all capitals, as shown here.</p>

<h4 id="3-electronic-health-certificate-container-format">3. Electronic Health Certificate Container Format</h4>

<p>The Electronic Health Certificate Container Format (HCERT) is designed to provide a uniform and standardised vehicle for health certificates from different Issuers. The aim is to harmonise how these health certificates are represented, encoded and signed with the goal of facilitating interoperability.</p>

<h5 id="31-structure-of-the-payload">3.1 Structure of the Payload</h5>

<p>The payload is structured and encoded as a CBOR with a COSE digital signature. This is commonly known as a "CBOR Web Token" (CWT), and is defined in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a>. The payload, as defined below, is transported in a <code class="language-plaintext highlighter-rouge">hcert</code> claim.</p>

<p>The integrity and authenticity of origin of payload data MUST be verifiable by the Verifier. To provide this mechanism, the issuer MUST sign the CWT using an asymmetric electronic signature scheme as defined in the COSE specification (<a href="https://tools.ietf.org/html/rfc8152">RFC 8152</a>).</p>

<h5 id="32-cwt-claims">3.2 CWT Claims</h5>

<h6 id="321-cwt-structure-overview">3.2.1 CWT Structure Overview</h6>

<ul>
  <li>Protected Header
    <ul>
      <li>Signature Algorithm (<code class="language-plaintext highlighter-rouge">alg</code>, label 1)</li>
      <li>Key Identifier (<code class="language-plaintext highlighter-rouge">kid</code>, label 4)</li>
    </ul>
  </li>
  <li>Payload
    <ul>
      <li>Issuer (<code class="language-plaintext highlighter-rouge">iss</code>, claim key 1, optional, ISO 3166-1 alpha-2 of issuer)</li>
      <li>Issued At (<code class="language-plaintext highlighter-rouge">iat</code>, claim key 6)</li>
      <li>Expiration Time (<code class="language-plaintext highlighter-rouge">exp</code>, claim key 4)</li>
      <li><a name="l9029">​</a>Health Certificate (<code class="language-plaintext highlighter-rouge">hcert</code>, claim key -260, see section <a href="/smart-trust/hcert_spec.html#327-health-certificate-claim">3.2.7</a> for subclaim details )</li>
    </ul>
  </li>
  <li>Signature</li>
</ul>

<p><a name="l9044">​</a>The logical model can be found specified <a href="/smart-trust/StructureDefinition-hcert.html">here</a></p>

<h6 id="322-signature-algorithm">3.2.2 Signature Algorithm</h6>

<p>The Signature Algorithm (<code class="language-plaintext highlighter-rouge">alg</code>) parameter indicates what algorithm is used for creating the signature. It must meet or exceed current SOG-IT guidelines.</p>

<p>One primary and one secondary algorithm is defined. The secondary algorithm should only be used if the primary algorithm is not acceptable within the rules and regulations imposed on the implementer.</p>

<p>However, it is essential and of utmost importance for the security of the system that all implementations incorporate the secondary algorithm. For this reason, both the primary and the secondary algorithm MUST be implemented.</p>

<p>For this version of the specification, the SOG-IT set levels for the primary and secondary algorithms are:</p>

<ul>
  <li>Primary Algorithm: The primary algorithm is Elliptic Curve Digital Signature Algorithm (ECDSA) as defined in (ISO/IEC 14888–3:2006) section 2.3, using the P–256 parameters as defined in appendix D (D.1.2.3) of (FIPS PUB 186–4) in combination with the SHA–256 hash algorithm as defined in (ISO/IEC 10118–3:2004) function 4.</li>
</ul>

<p>This corresponds to the COSE algorithm parameter <code class="language-plaintext highlighter-rouge">ES256</code>.</p>

<ul>
  <li>Secondary Algorithm: The secondary algorithm is RSASSA-PSS as defined in (<a href="https://tools.ietf.org/html/rfc8230">RFC 8230</a>) with a modulus of 2048 bits in combination with the SHA–256 hash algorithm as defined in (ISO/IEC 10118–3:2004) function 4.</li>
</ul>

<p>This corresponds to the COSE algorithm parameter: <code class="language-plaintext highlighter-rouge">PS256</code>.</p>

<h6 id="323-key-identifier">3.2.3 Key Identifier</h6>

<p>The Key Identifier (<code class="language-plaintext highlighter-rouge">kid</code>) claim is used by Verifiers for selecting the correct public key from a list of keys pertaining to the Issuer (<code class="language-plaintext highlighter-rouge">iss</code>) Claim. Several keys may be used in parallel by an Issuer for administrative reasons and when performing key rollovers. The Key Identifier is not a security-critical field. For this reason, it MAY also be placed in an unprotected header if required. Verifiers MUST accept both options.  If both options are present, the Key Identifier in the protected header MUST be used.</p>

<p>Due to the shortening of the identifier (for space-preserving reasons) there is a slim but non-zero chance that the overall list of DSCs accepted by a validator may contain DSCs with duplicate <code class="language-plaintext highlighter-rouge">kid</code>s. For this reason, a verifier MUST check all DSCs with that <code class="language-plaintext highlighter-rouge">kid</code>.</p>

<h6 id="324-issuer">3.2.4 Issuer</h6>

<p>The Issuer (<code class="language-plaintext highlighter-rouge">iss</code>) claim is a string value that MAY optionally hold the ISO 3166-1 alpha-2 Country Code of the entity issuing the health certificate. This claim can be used by a Verifier to identify which set of DSCs to use for validation. The Claim Key 1 is used to identify this claim.</p>

<h6 id="325-expiration-time">3.2.5 Expiration Time</h6>

<p>The Expiration Time (<code class="language-plaintext highlighter-rouge">exp</code>) claim SHALL hold a timestamp in the integer NumericDate format (as specified in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a> section 2) indicating for how long this particular signature over the Payload SHALL be considered valid, after which a Verifier MUST reject the Payload as expired. The purpose of the expiry parameter is to force a limit of the validity period of the health certificate. The Claim Key 4 is used to identify this claim.</p>

<p>The Expiration Time MUST not exceed the validity period of the DSC.</p>

<h6 id="326-issued-at">3.2.6 Issued At</h6>

<p>The Issued At (<code class="language-plaintext highlighter-rouge">iat</code>) claim SHALL hold a timestamp in the integer NumericDate format (as specified in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a> section 2) indicating the time when the health certificate was created.</p>

<p>The Issued At field MUST not predate the validity period of the DSC.</p>

<p>Verifiers MAY apply additional policies with the purpose of restricting the validity of the health certificate based on the time of issue. The Claim Key 6 is used to identify this claim.</p>

<h6 id="327-health-certificate-claim">3.2.7 Health Certificate Claim</h6>

<p>The Health Certificate (<code class="language-plaintext highlighter-rouge">hcert</code>) claim is a JSON (<a href="https://tools.ietf.org/html/rfc7159">RFC 7159</a>) object containing the health status information. The actual wire format of HCERT is content neutral. Several different types of health certificate MAY exist under the same claim, of which the European DCC is one.</p>

<p>Note here that the JSON is purely for schema purposes. The wire format is CBOR as defined in (<a href="https://tools.ietf.org/html/rfc7049">RFC 7049</a>). Application developers may not actually ever decode or encode to and from the JSON format, but use the in-memory structure.</p>

<p>The Claim Key to be used to identify this claim is -260.</p>

<p>Strings in the JSON object SHOULD be NFC normalised according to the Unicode standard. Decoding applications SHOULD however be permissive and robust in these aspects, and acceptance of any reasonable type conversion is strongly encouraged. If non-normalised data is found during decoding, or in subsequent comparison functions, implementations SHOULD behave as if the input is normalised to NFC.</p>

<p>####### 3.2.7.1 Subclaims</p>
<ul>
  <li>subclaims 0 and above are reserved by WHO to be assigned, a new sub claim can be requested for by requesting to create a new trust domain</li>
  <li>subclaims for negative integer values are for development purposes and are free to use</li>
  <li><a name="l9192">​</a>While the <a href="/smart-trust/StructureDefinition-hcert.html">logical model</a> enlists assigned sub claims, the ones listed in this specification are considered authoritative</li>
</ul>

<p>######## 3.2.7.1.1 EU Digital Covid Certificate (DCC)
<a href="http://smart.who.int/ddcc/StructureDefinition/HCertDCC">Data elements</a> for the EU Digital COVID Certificate Core Data Set. Based on the official specification for COVID-19-related payloads https://health.ec.europa.eu/system/files/2021-06/covid-certificate_json_specification_en_0.pdf as of 2023-01-31, and Implementing Decision (EU) 2021/1073, Annex 1 https://eur-lex.europa.eu/legal-content/EN/TXT/HTML/?uri=CELEX:32021D1073&amp;from=EN#d1e34-35-1.</p>

<p>######## 3.2.7.1.3 Digital Documentation of Covid Certificate - Vaccination Status (DDCCVS)
The Digital Documentation of COVID-19 Certificates (DDCC) Trust Domain covers the utilization of COVID-19 Vaccine Certificates and Test Results. The Vaccination Status guidance is for the purposes of continuity of care and proof of vaccination.</p>
<ul>
  <li><a href="https://www.who.int/publications/i/item/WHO-2019-nCoV-Digital_certificates-vaccination-2021.1">DDCC Vaccination Status (DDCC:VS)</a> documents the use cases, data requirements, technical specifications and implementation guidance for vaccination certificates.</li>
  <li><a href="https://smart.who.int/ddcc/">DDCC FHIR Implementation Guide</a></li>
</ul>

<p>######## 3.2.7.1.4 Digital Documentation of Covid Certificate - Test Results (DDCCTR)
The Digital Documentation of COVID-19 Certificates (DDCC) Trust Domain covers the utilization of COVID-19 Vaccine Certificates and Test Results. The Test Results guidance is for test result certificates that attest to: (a) the fact that an individual has been tested for SARS-CoV-2, and (b) the result of that SARS-CoV-2 diagnostic test.</p>
<ul>
  <li><a href="https://www.who.int/publications/i/item/WHO-2019-nCoV-Digital_certificates_diagnostic_test_results-2022.1">DDCC Vaccination Status (DDCC:TR)</a> documents the use cases, data requirements, technical specifications and implementation guidance for vaccination certificates.</li>
  <li><a href="https://smart.who.int/ddcc/">DDCC FHIR Implementation Guide</a></li>
</ul>

<p>######## 3.2.7.1.5 Smart Health Link (SHL)
Smart Health Links covers the use cases of ability to share signed health data using links as digital connectors, using QR codes, facilitating tamper proof data exchange. Specification can be found <a href="https://docs.smarthealthit.org/smart-health-links/spec">here</a></p>

<h4 id="4-transport-encodings">4 Transport Encodings</h4>

<h5 id="41-raw">4.1 Raw</h5>

<p>For arbitrary data interfaces the HCERT container and its payloads may be transferred as-is, utilising any underlying, 8 bit safe, reliable data transport. These interfaces MAY include NFC, Bluetooth or transfer over an application layer protocol, for example transfer of an HCERT from the Issuer to a holder’s mobile device.</p>

<p>If the transfer of the HCERT from the Issuer to the holder is based on a presentation-only interface (e.g., SMS, e-mail), the Raw transport encoding is obviously not applicable.</p>

<h5 id="42-barcode">4.2 Barcode</h5>

<h6 id="421-payload-cwt-compression">4.2.1 Payload (CWT) Compression</h6>

<p>To lower size and to improve speed and reliability in the reading process of the HCERT, the CWT SHALL be compressed using ZLIB (<a href="https://tools.ietf.org/html/rfc1950">RFC 1950</a>) and the Deflate compression mechanism in the format defined in (<a href="https://tools.ietf.org/html/rfc1951">RFC 1951</a>).</p>

<h6 id="422-qr-2d-barcode">4.2.2 QR 2D Barcode</h6>

<p>In order to better handle legacy equipment designed to operate on ASCII payloads, the compressed CWT is encoded as ASCII using <a href="https://datatracker.ietf.org/doc/draft-faltstrom-base45">Base45</a> before being encoded into a 2D barcode.</p>

<p>The QR format as defined in (ISO/IEC 18004:2015) SHALL be used for 2D barcode generation. An error correction rate of ‘Q’ (around 25%) is RECOMMENDED.  The Alphanumeric (Mode 2/QR Code symbols 0010) MUST be used in conjunction with Base45.</p>

<p>In order for Verifiers to be able to detect the type of data encoded and to select the proper decoding and processing scheme, the base45 encoded data (as per this specification) SHALL be prefixed by the Context Identifier string "HC1:". Future versions of this specification that impact backwards-compatibility SHALL define a new Context Identifier, whereas the character following "HC" SHALL be taken from the character set [1-9A-Z]. The order of increments is defined to be in that order, i.e., first [1-9] and then [A-Z].</p>

<p>The optical code is RECOMMENDED to be rendered on the presentation media with a diagonal size between 35 mm and 60 mm to accommodate readers with fixed optics where the presentation media is required to be placed on the surface of the reader.</p>

<p>If the optical code is printed on paper using low-resolution (&lt; 300 dpi) printers, care must be taken to represent each symbol (dot) of the QR code exactly square. Non-proportional scaling will result in some rows or columns in the QR having rectangular symbols, which will hamper readability in many cases.</p>

<h4 id="5-trusted-list-format-dsc-list">5 Trusted List Format (DSC list)</h4>

<p>Each Participating country is REQUIRED to provide a list of one or more Signing Certificate Authorities (SCAs) and a list of all valid Document Signing Certificates (DSCs), and keep these lists current.</p>

<p>For the list of SCA certificates, each certificate:</p>

<ul>
  <li>MUST contain a valid Country attribute in the subject DN that matches the country of issuance.</li>
  <li>MUST contain DN that is unique within the specified country.</li>
  <li>MUST contain a unique Subject Key Identifier (SKI) according to (<a href="https://tools.ietf.org/html/rfc5280">RFC5280</a>).</li>
</ul>

<p>In addition, for the list of DSC certificates, each certificate:</p>

<ul>
  <li>MUST be signed with the private key corresponding to a SCA certificate published on the aforementioned list.</li>
  <li>MUST contain an Authority Key Identifier (AKI) matching the Subject Key Identifier (SKI) of the issuing SCA certificate.</li>
  <li>MUST have a validity period that is in line with or longer than the validity period of all certificates signed using that key.</li>
  <li>SHOULD contain a unique Subject Key Identifier derived from the subject public key.</li>
</ul>

<h5 id="51-simplified-scadsc">5.1 Simplified SCA/DSC</h5>

<p>As of this version of the specifications, countries should NOT assume that any Certificate Revocation List (CRL) information is used; or that the Private Key Usage Period is verified by implementers.</p>

<p>Instead, the primary validity mechanism is the presence of the certificate on the most recent version of that certificate list.</p>

<h5 id="52-icao-emrtd-pki-and-trust-centers">5.2 ICAO eMRTD PKI and Trust Centers</h5>

<p>GDHCN Participants can use a separate SCA (as per the WHO advice)(#ref) - but may also submit their existing eMRT SCA and/or DSC certificates; and may even choose to procure these from (commercial) trust centers - and submit these. However, any DSC certificate must always be signed by the SCA submitted by that country.</p>

<h4 id="6-security-considerations">6. Security Considerations</h4>

<p>When designing a scheme using this specification, several important security aspects must be considered. These cannot preemptively be accounted for in this specification but must be identified, analysed and monitored by the Participants.</p>

<p>As input to the continuous analysis and monitoring of risks, the following topics SHOULD be taken into account:</p>

<h5 id="61-hcert-signature-validity-time">6.1 HCERT Signature Validity Time</h5>

<p>It is anticipated that health certificates can not be reliably revoked once issued, especially not if this specification would be used on a global scale. Publishing of revocation information containing identifiers may also create privacy concerns, as this information is per definition Personally Identifiable Information (PII). For these reasons, this specification requires the Issuer of HCERTs to limit the validity period of the signature by specifying a signature expiry time. This requires the holder of a health certificate to renew it at periodic intervals.</p>

<p>The acceptable validity period may be determined by practical constraints. For example, a traveler may not have the possibility to renew the health certificate during a trip overseas. However, it may also be the case that an Issuer is considering the possibility of a security compromise of some sort, which requires the Issuer to withdraw an DSC (invalidating all health certificates issued using that key which are still within their validity period). The consequences of such an event may be limited by regularly rolling Issuer keys and requiring renewal of all health certificates, on some reasonable interval.</p>

<h5 id="62-key-management">6.2 Key Management</h5>

<p>This specification relies heavily on strong cryptographic mechanisms to secure data integrity and data origin authentication. Maintaining the confidentiality of the private keys is therefore of utmost importance.</p>

<p>The confidentiality of cryptographic keys can be compromised in a number of different ways, for instance:</p>

<ul>
  <li>The key generation process may be flawed, resulting in weak keys.</li>
  <li>The keys may be exposed by human error.</li>
  <li>The keys may be stolen by external or internal perpetrators.</li>
  <li>The keys may be calculated using cryptanalysis.</li>
</ul>

<p>To mitigate against the risks that the signing algorithm is found to be weak, allowing the private keys to be compromised through cryptanalysis, this specification recommends all Participants to implement a secondary fallback signature algorithm based on different parameters or a different mathematical problem than the primary.</p>

<p>The other risks mentioned here are related to the Issuers' operating environments. One effective control to mitigate significant parts of these risks is to generate, store and use the private keys in Hardware Security Modules (HSMs). Use of HSMs for signing health certificates is highly encouraged.</p>

<p>However, regardless of whether an Issuer decides to use HSMs or not, a key roll-over schedule SHOULD be established where the frequency of the key roll-overs is proportionate to the exposure of keys to external networks, other systems and personnel. A well-chosen roll-over schedule also limits the risks associated with erroneously issued health certificates, enabling an Issuer to revoke such health certificates in batches, by withdrawing a key, if required.</p>

<h5 id="63-input-data-validation">6.3 Input Data Validation</h5>

<p>This specification may be used in a way that implies receiving data from untrusted sources into systems that may be of mission-critical nature. To minimise the risks associated with this attack vector, all input fields MUST be properly validated by data types, lengths and contents. The Issuer Signature SHALL also be verified before any processing of the contents of the HCERT takes place. However, the validation of the Issuer Signature implies parsing the Protected Issuer Header first, in which a potential attacker may attempt to inject carefully crafted information designed to compromise the security of the system.</p>

<h3 id="appendix-a---trust-management">Appendix A - Trust Management</h3>

<p>The HCERT signature verification process necessitates the use of a public key. GDHCN Participants, or institutions within these participants, are responsible for providing these public keys. Ultimately, every Verifier needs to have a list of all public keys it is willing to trust (as the public key is not part of the HCERT).</p>

<p>Each participant is ultimately responsible for compiling their own master list and making that available to the other Participants. The aid of GDHCN's Secretariat for coordinating operational and practical matters is available.</p>

<p>The "GDHCN Secretariat" is a functional role; not a person or a piece of software. It is expected that the WHO’s GDHCN Trust Network Gateway will automate most of these tasks.</p>

<p>The system consists of two layers; for each GDHCN Participant one or more country level certificates that each signs one or more document signing certificates that are used in day to day operations.</p>

<p>The GDHCN Participant certificates are called Signer Certificate Authorities (SCAs) and are  self-signed certificates. Participants may have more than one (e.g., in case of regional devolution). These SCAs regularly sign the Document Signing Certificates (DSCs) used for signing HCERTs. GDHCN Participants will each maintain a public register of the DSC certificates kept current, communicated to the WHO’s Secretariat and published at a stable URL for bilateral exchange. GDHCN Participants MUST remove any revoked or stale certificates from this list.</p>

<p>The Secretariat will regularly aggregate and publish the GDHCN Participants DSCs, after having verified these against the list of SCA certificates (which have been conveyed and verified by other means).</p>

<p>The resulting list of DSC certificates then provides the aggregated set of acceptable public keys (and the corresponding <code class="language-plaintext highlighter-rouge">kid</code>s) that Verifiers can use to validate the signatures over the HCERTs. Verifiers MUST fetch and update this list regularly.</p>

<p>GDHCN Participants may also bilaterally exchange SCA certificates with a number of other GDHCN Participants, verify these bilaterally and thus compile their own lists of SCA and DSC certificates which is specific to that GDHCN Participant. Verifiers may choose to rely on such a national list.</p>

<p>Such GDHCN Participant-specific lists are expected to be adapted in the format for their own national setting. As such, the file format of this trusted list may vary, e.g., it can be a signed JWKS (<a href="https://tools.ietf.org/html/rfc7517#section-5">JWK set format per RFC 7517 section 5</a>) or any other format specific to the technology used in that GDHCN Participant.</p>

<p>For the sake of simplicity: GDHCN Participants may both submit their existing SCA certificates from their ICAO eMRTD systems or, as recommended by the WHO, create one specifically for this health domain.</p>

<h4 id="a1-the-key-identifier-kids">A.1 The Key Identifier (<code class="language-plaintext highlighter-rouge">kid</code>s)</h4>

<p>The Key Identifier (<code class="language-plaintext highlighter-rouge">kid</code>) is calculated when constructing the list of trusted public keys from DSC certificates and consists of a truncated (first 8 bytes) SHA-256 fingerprint of the DSC encoded in DER (raw) format.</p>

<p>Note that Verifiers do not need to calculate the <code class="language-plaintext highlighter-rouge">kid</code> based on the DSC certificate and can directly match the Key Identifier in issued health certificates with the <code class="language-plaintext highlighter-rouge">kid</code> on the trusted list.</p>

<h4 id="a2-extended-key-usage-identifiers">A.2 Extended Key Usage Identifiers</h4>

<p>The document signing certificate MAY contain Extended Key Usage extension fields; these being:</p>

<ul>
  <li>OID 1.3.6.1.4.1.1847.2021.1.1 –  valid for test</li>
  <li>OID 1.3.6.1.4.1.1847.2021.1.2  – valid for vaccinations</li>
  <li>OID 1.3.6.1.4.1.1847.2021.1.3  – valid for recovery</li>
</ul>

<p>The DSC may contain an extended key usage extension with <em>zero or more</em> key usage policy identifiers that constrain the types of HCERTs this certificate is allowed to verify. If one or more are present, the verifiers SHALL verify the key usage against the stored HCERT.</p>

<p>In absence of any key usage extension (i.e. no extensions or zero extensions), this certificate can be used to validate any type of HCERT.  Other documents MAY define relevant additional extended key usage policy identifiers used with validation of HCERTs.
<strong>__</strong><strong>__</strong>_____</p>

<h2 id="deployment-1">Deployment</h2>
<p>This Implementation Guide contains the following deployment support guidance:</p>

<ul>
 <li><a href="security_privacy.html">Security and Privacy Considerations</a></li>
 <li><a href="testing.html">Testing</a></li>
 <li><a href="downloads.html">Downloads</a></li>
</ul>

<h3 id="onboarding-checklist">Onboarding Checklist</h3>

<p><a name="l9518">​</a>This repository contains the a checklist for <a href="concepts_onboarding.md">onboarding</a> the Trust Network Participants. This includes CSCAs, Auth information, signing information and other relevant files for onboarding a participant. Videos guides to the steps described here are available on this <a href="video_tutorial.html">page</a>.</p>

<p><strong>Onboarding Process</strong></p>
<p><a name="l9531">​</a><img src="Onboarding%20Process.drawio.png" alt="Onboarding Process" style="width:60%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<p><strong>Prerequisites for Onboarding</strong></p>

<p>Before beginning the onboarding process, please ensure the following tools, permissions, and environment configurations are in place. This checklist is crucial for a seamless setup experience.</p>

<div style="width: 100%; height: 500px; overflow: scroll;">
  <table border="1" class="dataframe table table-striped table-bordered">
    <thead style="position: sticky; top: 0; z-index: 100; background-color: white;">
      <tr style="text-align: left;">
        <th>Tools/Requirement</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody style="text-align: left; vertical-align: top;">
      <tr>
        <td><strong>GitHub Account</strong></td>
        <td>
          - Ensure you have an active GitHub account with access to the relevant repositories.<br/>
          - <strong>Permissions</strong>: Confirm the necessary repository permissions (read/write access if required for pushing commits).
        </td>
      </tr>
      <tr>
        <td><strong>OpenSSL</strong></td>
        <td>
          - Required for generating and managing digital certificates.<br/>
          - <strong>Minimum Version</strong>: 1.1.1 or higher.<br/>
          - <strong>Verify</strong>: <code>openssl version</code>.<br/>
          - <strong>Path Configuration</strong>: Ensure OpenSSL is correctly added to the system path.<br/>
          - <a href="https://www.openssl.org/source/">Download OpenSSL</a>
        </td>
      </tr>
      <tr>
        <td><strong>cURL</strong></td>
        <td>
          - Necessary for command-line data transfers, especially useful for API requests.<br/>
          - <strong>Minimum Version</strong>: 7.68.0 or higher.<br/>
          - <strong>Verify</strong>: <code>curl --version</code>.<br/>
          - <a href="https://curl.se/download.html">Download cURL</a>
        </td>
      </tr>
      <tr>
        <td><strong>Git</strong></td>
        <td>
          - Essential for version control and interacting with GitHub repositories.<br/>
          - <strong>Minimum Version</strong>: 2.28.0 or higher (recommended for improved configuration capabilities).<br/>
          - <strong>Verify</strong>: <code>git --version</code>.<br/>
          - <a href="https://git-scm.com/downloads">Download Git</a>
        </td>
      </tr>
      <tr>
        <td><strong>Text Editor or IDE (Optional)</strong></td>
        <td>
          - Use a reliable text editor or IDE such as <strong>Visual Studio Code</strong>, <strong>Sublime Text</strong>, or <strong>Notepad++</strong> for editing files.<br/>
          - <strong>Extensions</strong>: If using VS Code, consider adding extensions for Markdown and GitHub integration.<br/>
          - <a href="https://code.visualstudio.com/">Download Visual Studio Code</a>
        </td>
      </tr>
      <tr>
        <td><strong>Network and Firewall Permissions</strong></td>
        <td>
          - <strong>Network Access</strong>: Ensure network settings allow access to GitHub and other required external resources (e.g., API endpoints).<br/>
          - <strong>Firewall Permissions</strong>: Verify firewall permissions to avoid connectivity issues.
        </td>
      </tr>
      <tr>
        <td><strong>CLI Tools and Path Configuration</strong></td>
        <td>
          - Confirm that all tools (e.g., <code>openssl</code>, <code>curl</code>, <code>git</code>) are available in the <strong>system PATH</strong> for easy command-line access.<br/>
          - <strong>OS Compatibility</strong>: These instructions are applicable for Linux, macOS, and Windows.
        </td>
      </tr>
      <tr>
        <td><strong>Environment Configuration</strong></td>
        <td>
          - <strong>Environment Variables</strong>: Set required environment variables (e.g., API keys, tokens, or paths) as specified.
        </td>
      </tr>
      <tr>
        <td><strong>Additional Resources and Documentation</strong></td>
        <td>
          - Familiarize yourself with supplementary documentation, including API references, security guidelines, and data handling policies needed for the onboarding process.
        </td>
      </tr>
    </tbody>
  </table>
</div>

<blockquote>
  <p><strong>Save For Later:</strong> Be sure to securely save items like <strong>GPG Keys, Secrets, GitHub usernames, GitHub Repository URL, GitHub PAT (Personal Access Token)</strong>, and <strong>other configurations</strong> as they will be needed in upcoming steps.</p>
</blockquote>

<p><strong>Steps to Be Followed by Participant Country:</strong></p>

<h4 id="git-repository">Git Repository</h4>

<p><strong>Create a private git repository on github. One for each Environment (DEV, UAT, PROD)</strong></p>

<blockquote>
  <p>Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.1.and2.3.full-video.v2.mp4">Create private repository</a> video for reference</p>
</blockquote>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.1.and2.3.full-video.v2.mp4" type="video/mp4"/>
</video>

<ul>
  <li>From Github profile, go to repositories</li>
  <li>Click on New</li>
  <li>Enter Repository name, follow the convention, it has to contain the ISO 3 letter. All the rest is optional</li>
  <li>Click on Create Repository</li>
</ul>

<blockquote>
  <p><strong>Save For Later:</strong> Be sure to securely save items like <strong>GitHub usernames</strong>, and <strong>Repository Name, URL</strong> as they will be needed in upcoming steps.</p>
</blockquote>

<p><strong>Create PAT (Personal Access Token) for Github account if not created already</strong></p>
<ul>
  <li>Go to Github profile -&gt; Settings</li>
  <li>Go to Developers Settings -&gt; Personal Access Tokens -&gt; Tokens (Classic)</li>
  <li>Click on Generate New Token button (Generate New Token classic)</li>
  <li>Use Authentication code</li>
  <li>Add Note, Expiration, 'Repo' as a scope and click ‘Generate Token’</li>
</ul>

<blockquote>
  <p><strong>Save For Later:</strong> Be sure to securely save the <strong>GitHub PAT (Personal Access Token)</strong>, as it will be needed in upcoming steps.</p>
</blockquote>

<h4 id="local-repository">Local Repository</h4>

<ul>
  <li>Go to local repo</li>
  <li>
    <p>Clone the new Github repo in your local repo</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - git clone https://(your account PAT)@github.com/(your account or organization)/(repo).git
  - cd (repo)
  - git remote add template-repo https://github.com/WorldHealthOrganization/tng-participant-template.git
  - git pull template-repo main
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="invite-tng-bot">Invite tng-bot</h4>
<ul>
  <li>Add tng-bot to new repository
    <blockquote>
      <p>Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.2.full-video.v2.mp4">Invite tng-bot to private repository</a> video for reference</p>
    </blockquote>
  </li>
  <li>Go to Repository -&gt; Settings</li>
  <li>Go to Collaborators</li>
  <li>Authenticate</li>
  <li>Click on Add people</li>
  <li>Add tng-bot for Prod and tng-bot-dev for dev and UAT</li>
</ul>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.2.full-video.v2.mp4" type="video/mp4"/>
</video>

<h4 id="generate-gpg-key">Generate GPG Key</h4>
<ul>
  <li>Create GPG Keys for responsible persons for each environment
    <blockquote>
      <p>Note: Before generating a new GPG key, make sure you've verified your email address. If you haven't verified your email address, you won't be able to sign commits and tags with GPG.
Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.2.full-video.v2.mp4">GPG key Creation</a>  video for reference</p>
    </blockquote>
  </li>
  <li>Download and install the GPG command line tools for your operating system. We generally recommend installing the latest version for your operating system.</li>
  <li>Open Git Bash</li>
  <li>Generate a GPG key pair. Since there are multiple versions of GPG, you may need to consult the relevant man page to find the appropriate key generation command</li>
</ul>
<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.2.full-video.v2.mp4" type="video/mp4"/>
</video>
<ul>
  <li>
    <p>If you are on version 2.1.17 or greater, paste the text below to generate a GPG key pair.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Shell
  gpg --full-generate-key
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you are not on version 2.1.17 or greater, the gpg –full-generate-key command doesn't work. Paste the text below and skip to step 4.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Shell
  gpg --default-new-key-algo rsa4096 --gen-key
</code></pre></div>    </div>
  </li>
  <li>At the prompt, specify the kind of key you want, or press Enter to accept the default. (Default is RSA)</li>
  <li>At the prompt, specify the key size you want, or press Enter to accept the default. (For RSA go for 4096)</li>
  <li>Enter the length of time the key should be valid. Press Enter to specify the default selection, indicating that the key doesn't expire. Unless you require an expiration date, we recommend accepting this default.</li>
  <li>Verify that your selections are correct.</li>
  <li>Enter your user ID information.
    <blockquote>
      <p>Note: When asked to enter your email address, ensure that you enter the verified email address for your GitHub account. To keep your email address private, use your GitHub-provided no-reply email address. For more information, see "Verifying your email address" and "Setting your commit email address."</p>
    </blockquote>
  </li>
  <li>Authenticate</li>
  <li>Use the <strong>gpg –list-secret-keys –keyid-format=long</strong> command to list the long form of the GPG keys for which you have both a public and private key. A private key is required for signing commits or tags.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Shell
  gpg --list-secret-keys --keyid-format=long
</code></pre></div>    </div>
    <blockquote>
      <p>Some GPG installations on Linux may require you to use <strong>gpg2 –list-keys –keyid-format LONG</strong> to view a list of your existing keys instead. In this case you will also need to configure Git to use gpg2 by running <strong>git config –global gpg.program gpg2</strong>.</p>
    </blockquote>
  </li>
  <li>
    <p>From the list of GPG keys, copy the long form of the GPG key ID you'd like to use. In this example, the GPG key ID is 3AA5C34371567BD2:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Shell

  $ gpg --list-secret-keys --keyid-format=long
  /Users/hubot/.gnupg/secring.gpg
  ------------------------------------
  sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]
  uid                          Hubot &lt;hubot@example.com&gt;
  ssb   4096R/4BB6D45482678BE3 2016-03-10
</code></pre></div>    </div>
  </li>
  <li>
    <p>Paste the text below, substituting in the GPG key ID you'd like to use. In this example, the GPG key ID is 3AA5C34371567BD2:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Shell

  gpg --armor --export &lt;&lt; replace with your actual GPG key ID &gt;&gt;
  # Prints the GPG key ID, in ASCII armor format
</code></pre></div>    </div>
    <blockquote>
      <p><strong>Save For Later:</strong> Be sure to securely save the <strong>GPG Key</strong>, as it will be needed in upcoming steps.</p>
    </blockquote>
  </li>
  <li>Copy your GPG key, beginning with —–BEGIN PGP PUBLIC KEY BLOCK—– and ending with —–END PGP PUBLIC KEY BLOCK—–.</li>
  <li>Add the GPG key to your GitHub account.
    <blockquote>
      <p>Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.3.full-video.v2.mp4">Adding GPG key to repository</a>  video for reference</p>
    </blockquote>
  </li>
  <li>Go to Github profile -&gt; Settings</li>
  <li>Go to SSH and GPG Keys</li>
  <li>Click on New GPG Key</li>
  <li>Add Title. Add key copied in last step</li>
  <li>Click on Add GPG Key</li>
</ul>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.3.full-video.v2.mp4" type="video/mp4"/>
</video>

<h4 id="create-certificates">Create Certificates</h4>

<h5 id="certificate-preparation-for-dev-and-uat">Certificate Preparation for DEV and UAT</h5>

<blockquote>
  <p><strong>Disclaimer</strong>: This script is designed to create self-signed certificates solely for non-production environments, such as DEV and UAT, not intended to be used on production environments. To use it, <strong>choose the appropriate script for your operating system</strong>:</p>

  <p><strong>Unix/Linux:</strong>	Use the <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/gen_all_certs.sh">gen_all_certs.sh</a> bash script on <a href="#if-your-operating-systems-is-unixlinuxmac">Linux/Unix/Mac</a> operating system.</p>

  <p><strong>Windows:</strong>		Use the <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/gen_all_certs.ps1">gen_all_certs.ps1</a> PowerShell script on <a href="#if-your-operating-systems-is-windows">Windows</a> operating system.</p>

</blockquote>

<p>These scripts, along with the provided configuration files, serve as guidelines for <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/README.md">certificate preparation</a> .</p>

<h5 id="if-your-operating-systems-is-unixlinuxmac">If your Operating Systems is Unix/Linux/Mac</h5>
<blockquote>

  <ul>
    <li>To customize certificate parameters, update the <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/DN_template.cnf">DN_template.cnf</a> file, which will be used by the <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/gen_all_certs.sh">gen_all_certs.sh</a> script.</li>
    <li>Modify the following default certificate parameters as needed.</li>
  </ul>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export OSSL_COUNTRY_NAME="XC"
export OSSL_STATE_NAME="Test State"
export OSSL_LOCALITY_NAME="TEST"
export OSSL_ORGANIZATION_NAME="WHO"
export OSSL_ORGANIZATIONAL_UNIT_NAME="R&amp;D"
export OSSL_COMMON_NAME="NationXC_TNP
</code></pre></div></div>
<blockquote>
  <p>Note: OSSL_COUNTRY_NAME should be ISO 2 letter name of the country mapped to the name used in repository.</p>
</blockquote>

<h5 id="if-your-operating-systems-is-windows">If your Operating Systems is Windows</h5>
<blockquote>

  <p>For Windows, use the <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/gen_all_certs.ps1">gen_all_certs.ps1</a> PowerShell script. You can modify the environment variables directly within the script or set them in your current PowerShell session:</p>
</blockquote>

<p>1.Open PowerShell on your Windows machine.</p>

<p>2.Set the required environment variables.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$env:OSSL_COUNTRY_NAME="XC"
$env:OSSL_STATE_NAME="Test State"
$env:OSSL_LOCALITY_NAME="TEST"
$env:OSSL_ORGANIZATION_NAME="WHO"
$env:OSSL_ORGANIZATIONAL_UNIT_NAME="RND"
$env:OSSL_COMMON_NAME="NationXC_TNP"
</code></pre></div></div>

<blockquote>
  <p>Note: OSSL_COUNTRY_NAME should be ISO 2 letter name of the country mapped to the name used in repository.</p>
</blockquote>

<p>Please note that you need to have  <a href="https://slproweb.com/products/Win32OpenSSL.html">OpenSSL installed</a>  (e.g. Win64 OpenSSL v3.3.0 Light) and added to your PATH environment variable. Also you may need allow the execution by setting an execution policy.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope Process
</code></pre></div></div>

<h5 id="how-to-run-script-">How to Run Script :</h5>

<ul>
  <li>Once you execute the script. It will generate all certificates and keys in a subfolder named by current datetime.</li>
  <li><strong>Notes</strong>: While execution of "gen_all_certs.sh" script on <strong>Unix/Linux/Mac Operating System,</strong> Please provide script argument "DN_template.cnf" file which consists of country related information to generate all required certificates (TLS,SCA,UP)</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**For Mac/Linux/Unix**
cd scripts/certgen
./gen_all_certs.sh DN_template.cnf	    ## Provide DN_template.cnf file as a script argument.
zsh ./gen_all_certs.sh DN_template.cnf      ## Use this if you are using Zsh on your Ubuntu system.
        
**For Windows:**
cd scripts/certgen
./gen_all_certs.ps1
</code></pre></div></div>

<p>This setup generates all required certificates (TLS, SCA, UP) and keys in a timestamped subfolder, based on the configuration specified in DN_template.cnf for Unix/Linux and the environment variables set in the current PowerShell session for Windows.</p>

<h5 id="prepare-folders">Prepare Folders</h5>

<blockquote>
  <p>Note: keep your private keys safe and secure. Do not share them with anyone.</p>
</blockquote>

<p>Copy the generated certificates to the respective folders and change the file names to match the naming convention. For the case of self-signed TLS certificates, the CA.pem is just a copy of the TLS.pem (check to have keyCertSign in the keyUsage). The CA.pem should exist, since it is used to verify the TLS client certificate when connecting to the TNG application.
Files to be copied in respective folders are as follows:</p>
<ul>
  <li>SCA.pem -&gt; onboarding/DCC/SCA</li>
  <li>UP.pem -&gt; onboarding/DCC/UP</li>
  <li>CA.pem -&gt; onboarding/DCC/TLS</li>
  <li>TLS.pem -&gt; onboarding/DCC/TLS</li>
</ul>

<blockquote>
  <p>Note: On DEV and UAT environment, if the files are generated using a script, delete the generated folder before committing the files.</p>
</blockquote>

<h5 id="certification-preparation-for-prod">Certification Preparation for Prod</h5>

<p>This guide follows the certificate templates defined in the certificate governance. Public Key Certificates generated by following this guide will include the minimal required fields - further fields can be added in the configuration files if needed.Self-signed certificates are typically used in DEV and UAT environments.</p>

<p><strong>For production, It is strongly recommended to use certificates signed by a trusted Certificate Authority (CA)</strong>.
This is just an example reference on how to use a Trusted CA certificate in a production environment. You should refer to the specific procedures provided by the public Trusted Certificate Authority (CA) of your choice for accurate and detailed instructions <a href="#steps-to-obtain-and-use-a-ca-signed-certificate">Reference- Recommendation to use Trusted Public CA Certificate in Prod</a></p>

<p><strong>Only following signature algoriths are supported for the certificate.</strong></p>
<ul>
  <li>ECDSA with SHA-256</li>
  <li>ECDSA with SHA-384</li>
  <li>RSASSA-PSS</li>
  <li>DSA with SHA-256</li>
  <li>Legacy: SHA-256 with RSA Encryption</li>
</ul>

<h6 id="sca-certificate-tnpsca-generation-example">SCA certificate (TNP<sub>SCA</sub>) generation example</h6>
<blockquote>
  <p>Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.SCA.v2.mp4">SCA Creation</a> video  for reference</p>
</blockquote>

<ul>
  <li>
    <p><em>sca.conf</em>: Create a new file called sca.conf and replace the dn entries with your jurisdiction’s details.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [req]
  prompt = no
  default_md = sha256
  distinguished_name = dn

  [dn]
  C = DE
  ST = NRW
  L = Bonn
  O = MinistryOfTest
  OU = DGCOperations
  CN = SCA_DGC_DE_01

  [ext]
  basicConstraints = critical, CA:TRUE, pathlen:0
  keyUsage = critical, cRLSign, keyCertSign
  subjectKeyIdentifier = hash
</code></pre></div>    </div>
  </li>
  <li>
    <p><em>Certificate generation</em>: Open a command line prompt in the folder where the sca.conf is located and use the following OpenSSL command to create the private key (CAprivkey.key) and the certificate (CAcert.pem):</p>
  </li>
  <li>
    <p><strong>For Prod it's recommended to use</strong> <a href="#steps-to-obtain-and-use-a-ca-signed-certificate">Trusted CA issued Certificate</a> only. As below command for self-signed certificate generation as it's usually only recommended for <strong>DEV/UAT</strong> environment.</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  openssl req -x509 -new -days 1461 -newkey ec:&lt;(openssl ecparam -name prime256v1) -extensions ext -keyout CAprivkey.key -nodes -out CAcert.pem -config sca.conf
</code></pre></div>    </div>
  </li>
</ul>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.SCA.v2.mp4" type="video/mp4"/>
</video>

<h6 id="dsc-generation-example">DSC generation example</h6>
<p><strong>DSC generation example</strong>
	Document Signer Certificates (DSCs) must be signed by the SCA. Hence, you have to create the SCA certificate (with the corresponding private key) before you can issue DSCs.</p>

<ul>
  <li>
    <p><em>DSC.conf</em>: Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/3.2.and3.3.full-video.v2.mp4">DSC generation and deletion</a>  video for reference</p>
  </li>
  <li>
    <p>Create a new file called DSC.conf in the folder where your CA’s private key is located and add the following fields:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [ext]
  keyUsage = critical, digitalSignature
  subjectKeyIdentifier = hash
  authorityKeyIdentifier = keyid:always
  crlDistributionPoints = URI:http://crl.exampledomain.example/CRL/SCA.crl
  extendedKeyUsage = 1.3.6.1.4.1.1847.2021.1.1,1.3.6.1.4.1.1847.2021.1.2,1.3.6.1.4.1.1847.2021.1.3
</code></pre></div>    </div>
  </li>
  <li>
    <p>It is recommended that a SCA provides certificate revocation lists. Therefore, replace the crlDistributionPoints URI with the information for your jurisdiction.</p>
  </li>
  <li>
    <p>The extendedKeyUsage field is optional, for Covid certificates the below values are recommend to be used to further restrict the DSC certificate as follows:</p>

    <p><strong>Field</strong>         <strong>Value</strong><br/>
  extendedKeyUsage   1.3.6.1.4.1.1847.2021.1.1 for Test Issuers<br/>
  extendedKeyUsage   1.3.6.1.4.1.1847.2021.1.2 for Vaccination Issuers<br/>
  extendedKeyUsage   1.3.6.1.4.1.1847.2021.1.3 for Recovery Issuers\</p>
  </li>
  <li>
    <p>The above example contains all three extended key usages.</p>
  </li>
  <li>
    <p><em>Create a certificate signing request (CSR)</em>:In order to create a certificate for a Document Signer, first create a Certificate Signing Request preferably on the machine that will use the certificate in order to avoid copying the private key (DSC01privkey.key) to this machine later. The CSR must contain the Distinguished Name (DN) information that will be included in the DSC. Open a command prompt and use the following command to create the CSR:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  openssl req -newkey ec:&lt;(openssl ecparam -name prime256v1) -keyout DSC01privkey.key -nodes -out DSC01csr.pem
</code></pre></div>    </div>
  </li>
  <li>
    <p>If needed, you can repeat this procedure to create multiple CSRs for different DSCs (on different machines). When prompted, enter the necessary information (e.g. C= your jurisdiction (MUST), O = your Organization (OPTIONAL), CN = non-empty and unique CN (MUST), …).</p>
  </li>
  <li>
    <p><em>Issue the certificate</em>: Copy the CSR (DSC01csr.pem) to the folder where the private key of your CA is located. Open a command prompt and use the following command to issue the DSC (DSCcert.pem):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  openssl x509 -req -in DSC01csr.pem -CA CAcert.pem -CAkey CAprivkey.key -CAcreateserial -days 730 -extensions ext -extfile DSC.conf -out DSCcert.pem
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Important Recommendations for Prod</strong>: Please replace CAcert.pem and CAprivkey.key with signing material from an officially Trusted Certification Authority instead using your own self-signed one.</p>
  </li>
</ul>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/3.2.and3.3.full-video.v2.mp4" type="video/mp4"/>
</video>

<h6 id="tnpup-generation-example">TNP<sub>UP</sub> generation example</h6>

<ul>
  <li><em>uploadCert.conf</em>
    <blockquote>
      <p>Please check <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.UP.v2.mp4">UP Creation</a>  video for reference</p>
    </blockquote>
  </li>
  <li>
    <p>Create a new file called <em>uploadCert.conf</em> and replace the dn entries with your jurisdiction’s details.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [req]
  prompt = no
  default_md = sha256
  distinguished_name = dn

  [dn]
  C = DE
  ST = NRW
  L = Bonn
  O = MinistryOfTest
  OU = DGCOperations
  CN = NationX_TNPUP

  [ext]
  keyUsage = critical, digitalSignature
</code></pre></div>    </div>
  </li>
  <li>
    <p><em>Certificate generation</em>: Open a command line prompt in the folder where the <em>uploadCert.conf</em> is located and use the following OpenSSL command to create the private key (<em>TNP_UP.key</em>) and the certificate (<em>TNP_UP.pem</em>):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  plaintext
  openssl req -x509 -new -days 365 -newkey ec:&lt;(openssl ecparam -name prime256v1) -extensions ext -keyout TNP_UP.key -nodes -out TNP_UP.pem -config uploadCert.conf
</code></pre></div>    </div>
  </li>
</ul>
<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.UP.v2.mp4" type="video/mp4"/>
</video>

<h6 id="tnptls-generation-example">TNP<sub>TLS</sub> generation example</h6>

<ul>
  <li><em>TLSClient.conf</em>
    <blockquote>
      <p>Please check  <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.TLS.v2.mp4">TLS Creation</a> video for reference</p>
    </blockquote>
  </li>
  <li>
    <p>Create a new file called <em>TLSClient.conf</em> and replace the dn entries with your jurisdiction’s details.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  [req]
  prompt = no
  default_md = sha256
  distinguished_name = dn

  [dn]
  C = DE
  ST = NRW
  L = Bonn
  O = MinistryOfTest
  OU = DGCOperations
  CN = NationX_TNP_TLS

  [ext]
  keyUsage = critical, digitalSignature
  extendedKeyUsage = clientAuth
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p>Note :Beware that self-signed certificates should also contain the key usage Certificate signing (keyCertSign), so that the (self) signature of the certificate can be verified.</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
plaintext
[ext]
keyUsage = critical, digitalSignature, keyCertSign
extendedKeyUsage = clientAuth
```
</code></pre></div></div>

<ul>
  <li>
    <p><em>Certificate generation</em>: Open a command line prompt in the folder where the <em>TLSClient.conf</em> is located and use the following OpenSSL command to create the private key (<em>TNP_TLS.key</em>) and the certificate (<em>TNP_TLS.pem</em>):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  plaintext
  openssl req -x509 -new -days 365 -newkey ec:&lt;(openssl ecparam -name prime256v1) -extensions ext -keyout TNP_TLS.key -nodes -out TNP_TLS.pem -config TLSClient.conf
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>RSA Public Key Certificates</strong>
In case you want to use RSA certificates you can still use the configuration files provided above. During the CSR/certificate creation, replace the <code class="language-plaintext highlighter-rouge">-newkey ec:&lt;(openssl ecparam -name prime256v1)</code> with <code class="language-plaintext highlighter-rouge">-newkey rsa:4096</code> for a 4096 Bit RSA key.<br/>
Please be aware that RSA is NOT RECOMMENDED for the DSC and if you want to use RSA as your document signing algorithm, please create either a 2048 bit RSA key or at maximum a 3072 bit RSA key due to the space limitations on the QR codes.</p>
<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/1.1.full-video.TLS.v2.mp4" type="video/mp4"/>
</video>

<h4 id="provide">Provide</h4>

<blockquote>
  <p>Please check  <a href="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.4.full-video.v2.mp4">Signing (tag) certificates</a> video for reference</p>
</blockquote>

<ul>
  <li>
    <p><strong>Git Commands for Configuring, Committing, and Pushing Signed Commits</strong> are also available <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/README.md#tagging-for-taking-into-use">here</a></p>
  </li>
  <li>
    <p>Finally commit push changes and make a signed tag for the version you want to take into use, by following the steps below:</p>
  </li>
  <li>
    <p>List all the GPG keys available on your system</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  gpg --list-key
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  OutPut
	  
  gpg --list-key
  /home/test/.gnupg/pubring.kbx
  -----------------------------
	
  pub   rsa4096 2024-09-19 [SC]
  CD822874C7862BA4BB6B950E40CC62009D9A00B0
  uid           [ultimate] Test User1 (This GPG Key is for XXC test Country) &lt;youruser@yourdomain.com&gt;
  sub   rsa4096 2024-09-19 [E]
</code></pre></div>    </div>

    <p><strong>Note</strong>: The PUB ID in above output is CD822874C7862BA4BB6B950E40CC62009D9A00B0 , In your case you need to 
      replace with «&nbsp;replace with your Pub ID&nbsp;» with your actual GPG public key ID to configure Git to use a GPG 
      key for signing commits or tags in next command.</p>
  </li>
  <li>
    <p>Configure the signing key to be used globally for Git commits and tag</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git config --global user.signingkey &lt;&lt; replace with your Pub ID &gt;&gt;
</code></pre></div>    </div>
  </li>
  <li>Retrieve the current GPG signing key configured for Git
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git config --get user.signingkey
</code></pre></div>    </div>
  </li>
  <li>Configures the global Git username and email
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git config --global user.name "Your Git UserName"
	
  git config --global user.email "Your email Id"
</code></pre></div>    </div>
  </li>
  <li>Stage all changes for the next commit
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git add .
</code></pre></div>    </div>
  </li>
  <li>Create a signed Git commit with a commit message,
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git commit -sm "added all certificates files"
</code></pre></div>    </div>
  </li>
  <li>Push changes to the main branch.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> git push origin main
</code></pre></div>    </div>
  </li>
  <li>Create a signed Git tag with a message
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git tag -s v1.2 -m 'my signed 1.2 tag'
</code></pre></div>    </div>
  </li>
  <li>
    <p>Displays the details of a specific tag</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git show v1.2
</code></pre></div>    </div>
  </li>
  <li>Pushes all the local tags to the remote repository
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  git push --tags 
</code></pre></div>    </div>
  </li>
  <li>For more detailed git commands please review <a href="#more-information-about-git-commit-signing-and-tagging-commands">Appendix</a></li>
</ul>

<video controls="null" width="60%">
  <source src="https://github.com/WorldHealthOrganization/smart-trust/releases/download/v1.1.1/2.4.full-video.v2.mp4" type="video/mp4"/>
</video>

<p><strong>Everyone Must Sign - Always a good idea</strong>
Signing tags and commits is great, but if you decide to use this in your normal workflow, you’ll have to make sure that everyone on your team understands how to do so. This can be achieved by asking everyone working with the repository to run git config –local commit.gpgsign true to automatically have all of their commits in the repository signed by default. If you don’t, you’ll end up spending a lot of time helping people figure out how to rewrite their commits with signed versions. Make sure you understand GPG and the benefits of signing things before adopting this as part of your standard workflow.</p>

<h4 id="send-an-onboardingparticipation-request">Send an onboarding/participation request</h4>

<ul>
  <li>Send an onboarding/participation request to gdhcn-support@who.int which contains:
    <ul>
      <li>URL of the private repository created as a prerequisite</li>
      <li>The GPG key ( Beginning with —–BEGIN PGP PUBLIC KEY BLOCK—– and ending with —–END PGP PUBLIC KEY BLOCK—–) exported in Step <a href="#generate-gpg-key">1.8.6.4</a></li>
    </ul>
  </li>
</ul>

<h4 id="validate-the-connection">Validate the connection</h4>
<ul>
  <li>Once the confirmation of successful onboarding is received from the TNG Support Team ( gdhcn-support@who.int), please do the following</li>
</ul>

<p>THe following are the endpoints for the <a href="concepts.html#trust-network-gateway-tng">Trust Network Gateway</a> for each of development (DEV), user-acceptence testing (UAT) and production (PROD) <em>*environment</em>s:</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PROD</td>
      <td>https://tng.who.int</td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>https://tng-uat.who.int</td>
    </tr>
    <tr>
      <td>DEV</td>
      <td>https://tng-dev.who.int</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>After onboarding in the DEV/UAT/PROD Environment, check the connectivity with the Trust Network Gateway using its <a href="https://smart.who.int/trust/openapi/">API</a>. This can be achieved with following command:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v https://tng-dev.who.int/trustList --cert TLS.pem --key TLS.key
</code></pre></div></div>
<p>You should see a output like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
{
    "kid": "+jrpHSqdqZY=",
    "timestamp": "2023-05-25T07:55:21Z",
    "country": "XC",
    "certificateType": "UPLOAD",
    "thumbprint": "fa3ae91d...",
    "signature": "MIAGCSqGSIb3D...",
    "rawData": "MIIErTCCA5WgAwIBAgII..."
}
]
</code></pre></div></div>
<ul>
  <li>Test the other Trustlist Routes in the same style (e.g. with DSC/SCA/Upload/Authentication…)</li>
</ul>

<h4 id="upload-cms-package">Upload CMS Package</h4>
<ul>
  <li>
    <p>Create an Document Signer Certificate and sign it by the SCA <a href="#certification-preparation-for-prod">Refer</a> and <a href="#dsc-generation-example">DSC generation example</a></p>
  </li>
  <li>
    <p>Create an CMS Package with the following Command:</p>
    <blockquote>
      <p>Note: Step 3 and 4 could be achieved through two method, commandline and script respectively .</p>
    </blockquote>
  </li>
</ul>

<p><strong>Method 1 - Commandline .</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl x509 -outform der -in cert.pem -out cert.der
openssl cms -sign -nodetach -in cert.der -signer signing.crt -inkey signing.key -out signed.der -outform DER -binary
openssl base64 -in signed.der -out cms.b64 -e -A

</code></pre></div></div>
<blockquote>
  <p>Note: cert.der is your DSC, signing.crt is the TNP<sub>UP</sub>.</p>
</blockquote>

<ul>
  <li>Check DSC is already exist before upload CMS package</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v https://tng-dev.who.int/trustList/DSC/XC --cert TLS.pem --key TLS.key
</code></pre></div></div>

<ul>
  <li>Upload the CMS Package to the Gateway</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v -X POST -H "Content-Type: application/json"  --cert TLS.pem --key TLS.key --data '{"cms": "'"$(cat cms.b64)"'", "properties": {}, "domain": "DCC"}' https://tng-dev.who.int/trustedCertificate
</code></pre></div></div>

<ul>
  <li>Download the Trustlist again, and check if your DSC is available.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v https://tng-dev.who.int/trustList/DSC/XC --cert TLS.pem --key TLS.key
</code></pre></div></div>

<p><strong>Method 2 - Scripts</strong></p>

<p>The DSC generation and upload of  CMS package to TNG Gateway  could be achieved through the below mentioned scripts.
For DEV and UAT environments you may use script.</p>

<p><a href="https://github.com/WorldHealthOrganization/tng-participant-template/tree/main/scripts/certgen#generate-dscs">Generate DSCs</a></p>

<p><a href="https://github.com/WorldHealthOrganization/tng-participant-template/tree/main/scripts/certgen#upload-dscs0">Upload DSCs</a></p>

<p>The Distinguished Name ( DN) configuration file while will parse as source  <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/DN_template.cnf">DN_template.cnf</a> is an example.</p>

<p>Please replace with your actual OSSL_COUNTRY_NAME, OSSL_STATE_NAME etc parameters accordingly of DN_template.cnf file.</p>

<p>The script expects at least two arguments:
A configuration file (DN_template.cnf) that contains the Distinguished Name (DN) template.
A subdirectory where the SCA (Signing Certificate Authority) PEM and KEY files are located.
An optional third argument can be provided to specify the purpose of the DSC (e.g., test, vax, rec). If this argument is not provided, the DSC will be generated for all purposes.</p>

<p><strong>How to to run DSC Generate Script</strong> <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/gen_dsc.sh">gen_dsh.sh</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./script_name.sh DN_template.cnf directory_of_SCA_files [test/vax/rec-purpose]

</code></pre></div></div>
<p><strong>How to run upload_dsc.sh script to upload CMS Package:</strong> <a href="https://github.com/WorldHealthOrganization/tng-participant-template/blob/main/scripts/certgen/upload_dsc.sh">upload_dsc.sh</a></p>

<p><strong>- ./upload_dsc.sh:</strong> Replace this with the actual name of your script.</p>

<p><strong>- /path/to/subdir:</strong> Path to the directory containing UP.pem and UP.key.</p>

<p><strong>- /path/to/DSC_dir:</strong> Path to the directory containing the DSC files (DSC.pem, DSC.key).</p>

<p><strong>DCC:</strong> The domain name to be used. If omitted, the script will default to DCC.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./upload_dsc.sh /path/to/subdir-up_pem_key  /path/to/DSC_dir [DCC]
</code></pre></div></div>
<ul>
  <li>Download the Trustlist again, and check if your DSC is available.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v https://tng-dev.who.int/trustList/DSC/XC --cert TLS.pem --key TLS.key
</code></pre></div></div>

<blockquote>
  <p>Note: Some versions of curl don’t attach the client certificates automatically. This can be checked via curl –version Ensure that the used version is linked to OpenSSL. Especially under Windows (https://curl.se/windows/):</p>

  <p><strong>Curl version on Unix/Mac</strong>: We strongly recommend updating curl and nss to newer latest versions for full compatibility with modern cryptographic standards.The outdated version of curl or nss and may not support modern SSL/TLS protocols or elliptic curve cryptography (ECC) cipher suites properly.</p>
</blockquote>

<p><strong>Working Setup</strong></p>
<p><img src="https://github.com/user-attachments/assets/b55d083f-dccb-4547-af48-bbb7cb60d681" alt="Working Setup" style="width:60%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<p><strong>Non-working setup</strong></p>
<p><img src="https://github.com/user-attachments/assets/0f149617-d5f8-4f1b-bb65-37a073d4c146" alt="Non-working setup" style="width:60%" class="figure-img img-responsive img-rounded center-block"/></p>
<div style="clear:both;"></div>

<h4 id="appendix">Appendix</h4>

<h5 id="further-example-configuration-files">Further example configuration files</h5>
<p>The following configuration files have been provided during the alignment on the <a href="https://worldhealthorganization.github.io/smart-trust/concepts_certificate_governance.html">certificate governance</a>. The configuration files contain additional fields that a Trust Network Participant might want to include and use. The config-files are not tested with the OpenSSL commands provided above.</p>

<ul>
  <li>
    <p><em>SCA Conf</em></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  plaintext
  [ sca_ext ]
  basicConstraints        = critical,CA:true,pathlen:0
  keyUsage                = critical,keyCertSign,cRLSign
  subjectKeyIdentifier    = hash
  authorityKeyIdentifier  = keyid:always
  issuerAltName           = dirName:dir_sect
  subjectAltName          = dirName:dir_sect
  crlDistributionPoints   = URI:http://crl.publichealth.xx/CRLs/XX-Health.crl
  2.5.29.16               = ASN1:SEQUENCE:CAprivateKeyUsagePeriod


  [ CAprivateKeyUsagePeriod ]
  notBefore               = IMPLICIT:0,GENERALIZEDTIME:$ENV::PRIV_KEY_START
  notAfter                = IMPLICIT:1,GENERALIZEDTIME:$ENV::CA_PRIV_KEY_END

  [dir_sect]
  L=XX
</code></pre></div>    </div>
  </li>
  <li>
    <p><em>DSC conf</em></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  plaintext
  [ document_signer_all_ext ]
  keyUsage                = critical,digitalSignature
  subjectKeyIdentifier    = hash
  authorityKeyIdentifier  = keyid:always
  subjectAltName          = dirName:dir_sect
  issuerAltName           = dirName:dir_sect
  crlDistributionPoints   = URI:http://crl.npkd.nl/CRLs/NLD-Health.crl
  extendedKeyUsage        = 1.3.6.1.4.1.1847.2021.1.1,1.3.6.1.4.1.1847.2021.1.2,1.3.6.1.4.1.1847.2021.1.3
  2.5.29.16               = ASN1:SEQUENCE:DSprivateKeyUsagePeriod

  [ document_signer_test_ext ]
  keyUsage                = critical,digitalSignature
  subjectKeyIdentifier    = hash
  authorityKeyIdentifier  = keyid:always
  subjectAltName          = dirName:dir_sect
  issuerAltName           = dirName:dir_sect
  crlDistributionPoints   = URI:http://crl.npkd.nl/CRLs/NLD-Health.crl
  extendedKeyUsage        = 1.3.6.1.4.1.1847.2021.1.1
  2.5.29.16               = ASN1:SEQUENCE:DSprivateKeyUsagePeriod

  [ document_signer_vaccinations_ext ]
  keyUsage                = critical,digitalSignature
  subjectKeyIdentifier    = hash
  authorityKeyIdentifier  = keyid:always
  subjectAltName          = dirName:dir_sect
  issuerAltName           = dirName:dir_sect
  crlDistributionPoints   = URI:http://crl.npkd.nl/CRLs/NLD-Health.crl
  extendedKeyUsage        = 1.3.6.1.4.1.1847.2021.1.2
  2.5.29.16               = ASN1:SEQUENCE:DSprivateKeyUsagePeriod

  [ document_signer_recovery_ext ]
  keyUsage                = critical,digitalSignature
  subjectKeyIdentifier    = hash
  authorityKeyIdentifier  = keyid:always
  subjectAltName          = dirName:dir_sect
  issuerAltName           = dirName:dir_sect
  crlDistributionPoints   = URI:http://crl.npkd.nl/CRLs/NLD-Health.crl
  extendedKeyUsage        = 1.3.6.1.4.1.1847.2021.1.3
  2.5.29.16               = ASN1:SEQUENCE:DSprivateKeyUsagePeriod

  [ DSprivateKeyUsagePeriod ]
  notBefore               = IMPLICIT:0,GENERALIZEDTIME:$ENV::PRIV_KEY_START
  notAfter                = IMPLICIT:1,GENERALIZEDTIME:$ENV::DS_PRIV_KEY_END
</code></pre></div>    </div>
  </li>
</ul>

<h5 id="steps-to-obtain-and-use-a-ca-signed-certificate">Steps to Obtain and Use a CA-Signed Certificate</h5>

<ul>
  <li>Generate a Certificate Signing Request (CSR)
To begin, generate a CSR using the following OpenSSL command. This request will include a new private key and a configuration file:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req -new -nodes -newkey ec:&lt;(openssl ecparam -name prime256v1) -keyout CAprivkey.key -out CAreq.csr -config sca.conf
</code></pre></div></div>

<p><strong>CAprivkey.key:</strong> This file contains the private key.</p>

<p><strong>CAreq.csr:</strong> This file contains the Certificate Signing Request.</p>

<p><strong>sca.conf:</strong> This is the OpenSSL configuration file used during the CSR generation.</p>

<ul>
  <li>
    <p>Submit the CSR to a Public Certificate Authority (CA):
Submit the generated CAreq.csr file to the public CA of your choice. The CA will use this CSR to issue a certificate. Upon approval, the CA will provide you with:</p>
  </li>
  <li>
    <p>Submit CSR to the Public CA:
Submit the generated CAreq.csr file to the public CA of your choice. They will use the CSR to issue a certificate. The CA will provide you with the signed certificate and possibly a certificate chain or intermediate certificates.</p>
  </li>
  <li>
    <p>Use the CA-Signed Certificate:
Once you receive the CA-signed certificate, you will use it instead of generating a new self-signed certificate. Here’s how you can replace the placeholders with the signed certificate:
cp signed_CA_cert.pem ${subdir}/CAcert.pem 
cp CAprivkey.key ${subdir}/CAprivkey.key</p>
  </li>
</ul>

<h5 id="more-information-about-git-commit-signing-and-tagging-commands">More information about Git commit, signing and tagging commands</h5>

<p><strong>Signing Your Work</strong></p>

<ul>
  <li>
    <p>Git is cryptographically secure, but it’s not foolproof. If you’re taking work from others on the internet and want to verify that commits are actually from a trusted source, Git has a few ways to sign and verify work using GPG.</p>
  </li>
  <li>
    <p>First of all, if you want to sign anything you need to get GPG configured and your personal key installed.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ gpg --list-secret-keys --keyid-format=long
  /Users/hubot/.gnupg/secring.gpg
  ------------------------------------
  sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]
  uid                          Hubot &lt;hubot@example.com&gt;
  ssb   4096R/4BB6D45482678BE3 2016-03-10
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you don’t have a key installed, you can generate one with <strong>gpg –gen-key</strong>.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ gpg --gen-key
</code></pre></div>    </div>
  </li>
  <li>
    <p>Once you have a private key to sign with, you can configure Git to use it for signing things by setting the user.signingkey config setting.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git config --global user.signingkey 3AA5C34371567BD2!
</code></pre></div>    </div>
  </li>
  <li>
    <p>Now Git will use your key by default to sign tags and commits if you want.</p>
  </li>
</ul>

<p><strong>Signing Tags</strong></p>
<ul>
  <li>
    <p>If you have a GPG private key set up, you can now use it to sign new tags. All you have to do is use -s instead of -a:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git tag -s v1.5 -m 'my signed 1.5 tag'

  You need a passphrase to unlock the secret key for
  user: "Ben Straub &lt;ben@straub.cc&gt;"
  2048-bit RSA key, ID 800430EB, created 2014-05-04
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you run git show on that tag, you can see your GPG signature attached to it:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git show v1.5
  tag v1.5
  Tagger: Ben Straub &lt;ben@straub.cc&gt;
  Date:   Sat May 3 20:29:41 2014 -0700

  my signed 1.5 tag
  -----BEGIN PGP SIGNATURE-----
  Version: GnuPG v1

  iQEcBAABAgAGBQJTZbQlAAoJEF0+sviABDDrZbQH/09PfE51KPVPlanr6q1v4/Ut
  LQxfojUWiLQdg2ESJItkcuweYg+kc3HCyFejeDIBw9dpXt00rY26p05qrpnG+85b
  hM1/PswpPLuBSr+oCIDj5GMC2r2iEKsfv2fJbNW8iWAXVLoWZRF8B0MfqX/YTMbm
  ecorc4iXzQu7tupRihslbNkfvfciMnSDeSvzCpWAHl7h8Wj6hhqePmLm9lAYqnKp
  8S5B/1SSQuEAjRZgI4IexpZoeKGVDptPHxLLS38fozsyi0QyDyzEgJxcJQVMXxVi
  RUysgqjcpT8+iQM1PblGfHR4XAhuOqN5Fx06PSaFZhqvWFezJ28/CLyX5q+oIVk=
  =EFTF
  -----END PGP SIGNATURE-----

  commit ca82a6dff817ec66f44342007202690a93763949
  Author: Scott Chacon &lt;schacon@gee-mail.com&gt;
  Date:   Mon Mar 17 21:52:11 2008 -0700

      Change version number
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Verifying Tags</strong></p>
<ul>
  <li>
    <p>To verify a signed tag, you use git tag -v <tag-name>. This command uses GPG to verify the signature. You need the signer’s public key in your keyring for this to work properly:</tag-name></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git tag -v v1.4.2.1
  object 883653babd8ee7ea23e6a5c392bb739348b1eb61
  type commit
  tag v1.4.2.1
  tagger Junio C Hamano &lt;junkio@cox.net&gt; 1158138501 -0700

  GIT 1.4.2.1

  Minor fixes since 1.4.2, including git-mv and git-http with alternates.
  gpg: Signature made Wed Sep 13 02:08:25 2006 PDT using DSA key ID F3119B9A
  gpg: Good signature from "Junio C Hamano &lt;junkio@cox.net&gt;"
  gpg:                 aka "[jpeg image of size 1513]"
  Primary key fingerprint: 3565 2A26 2040 E066 C9A7  4A7D C0C6 D9A4 F311 9B9A
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you don’t have the signer’s public key, you get something like this instead:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  gpg: Signature made Wed Sep 13 02:08:25 2006 PDT using DSA key ID F3119B9A
  gpg: Can't check signature: public key not found
  error: could not verify the tag 'v1.4.2.1'
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Signing Commits</strong></p>
<ul>
  <li>
    <p>In more recent versions of Git (v1.7.9 and above), you can now also sign individual commits. If you’re interested in signing commits directly instead of just the tags, all you need to do is add a -S to your git commit command.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git commit -a -S -m 'Signed commit'

  You need a passphrase to unlock the secret key for
  user: "Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"
  2048-bit RSA key, ID 0A46826A, created 2014-06-04

  [master 5c3386c] Signed commit
   4 files changed, 4 insertions(+), 24 deletions(-)
   rewrite Rakefile (100%)
   create mode 100644 lib/git.rb
</code></pre></div>    </div>
  </li>
  <li>
    <p>To see and verify these signatures, there is also a –show-signature option to git log.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git log --show-signature -1
  commit 5c3386cf54bba0a33a32da706aa52bc0155503c2
  gpg: Signature made Wed Jun  4 19:49:17 2014 PDT using RSA key ID 0A46826A
  gpg: Good signature from "Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"
  Author: Scott Chacon &lt;schacon@gmail.com&gt;
  Date:   Wed Jun 4 19:49:17 2014 -0700

      Signed commit
</code></pre></div>    </div>
  </li>
  <li>
    <p>Additionally, you can configure git log to check any signatures it finds and list them in its output with the %G? format.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git log --pretty="format:%h %G? %aN  %s"

  5c3386c G Scott Chacon  Signed commit
  ca82a6d N Scott Chacon  Change the version number
  085bb3b N Scott Chacon  Remove unnecessary test code
  a11bef0 N Scott Chacon  Initial commit
</code></pre></div>    </div>
  </li>
  <li>
    <p>Here we can see that only the latest commit is signed and valid and the previous commits are not.</p>
  </li>
  <li>
    <p>In Git 1.8.3 and later, git merge and git pull can be told to inspect and reject when merging a commit that does not carry a trusted GPG signature with the –verify-signatures command.</p>
  </li>
  <li>
    <p>If you use this option when merging a branch and it contains commits that are not signed and valid, the merge will not work.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git merge --verify-signatures non-verify
  fatal: Commit ab06180 does not have a GPG signature.
</code></pre></div>    </div>
  </li>
  <li>
    <p>If the merge contains only valid signed commits, the merge command will show you all the signatures it has checked and then move forward with the merge.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git merge --verify-signatures signed-branch
  Commit 13ad65e has a good GPG signature by Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;
  Updating 5c3386c..13ad65e
  Fast-forward
   README | 2 ++
   1 file changed, 2 insertions(+)
</code></pre></div>    </div>
  </li>
  <li>
    <p>You can also use the -S option with the git merge command to sign the resulting merge commit itself. The following example both verifies that every commit in the branch to be merged is signed and furthermore signs the resulting merge commit.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git merge --verify-signatures -S  signed-branch
  Commit 13ad65e has a good GPG signature by Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;

  You need a passphrase to unlock the secret key for
  user: "Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"
  2048-bit RSA key, ID 0A46826A, created 2014-06-04

  Merge made by the 'recursive' strategy.
   README | 2 ++
   1 file changed, 2 insertions(+)
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="security-and-privacy-considerations">Security and Privacy Considerations</h3>

<h3 id="testing">Testing</h3>

<h3 id="trust-registry-network">Trust Registry Network</h3>

<p>The Digital TRUST Infrastructure for Discovery and Validation (Regi-TRUST) is a DNS-based decentralized trust management infrastructure that bridges the gap between different certificate ecosystems and enables trust interoperability. Regi-TRUST's "network of networks" model allows ecosystems of trusted digital services operated by various stakeholders to securely publish service endpoints collated with their independent governance policies and with support for root of trust architectures to allow interoperable verifications. Implementers of Regi-TRUST can leverage tools provided to create purpose-sized networks of trusted digital services operated by all types of entities, using lightweight infrastucture and technical governance due to the decentralized federation approach. Regi-TRUST was originally started by the Linux Foundation in 2021 as the Global COVID-19 Certificate Network (GCCN), and is now sponsored and hosted by the United Nation Development Programme (UNDP).</p>

<p>Within the health certificate context, verifiers can use the discovery mechanism enabled by Regi-TRUST to build a customized trust list based on their own entry policies, check health certificates from issuers participating in disparate trust networks against that list and access the issuer's public key for signature verification. The registry participants will submit service metadata, public keys, business rules and revocation data to the registry in a standardized format via trusted endpoints.</p>

<p>Regi-TRUST is built on the open-source <a href="https://gitlab.grnet.gr/essif-lab/infrastructure/fraunhofer/train_project_summary">Trust mAnagement INfrastructure (TRAIN)</a>, developed by the Fraunhofer IAO as a part of the European Self-Sovereign Identity Framework (ESSIF) Lab. TRAIN uses/supports several established standards and is flexible with existing architectures, providing technical accessibility and inclusivity for implementors.</p>

<h4 id="proof-of-concept">Proof of Concept</h4>

<p>The original proof of concept that took place at the Linux Foundation involved 1) COVID certificate services applying to join the network 2) the discovery of COVID certificate services on the network and 3) the verification of COVID certificates using the network. For more detail on execution of this proof of concept and results, <a href="https://www.lfph.io/2022/04/19/lfph-completes-the-proof-of-concept-of-its-gccn-trust-registry-network/">please follow this link.</a></p>

<h4 id="implementation-toolkit-and-technical-specification">Implementation Toolkit and Technical Specification</h4>

<p>The UNDP project intends to develop and provide an implementation toolkit including an open source reference implementation for the specification, a governance and policy guideline for Regi-TRUST implementers, and technical and functional specifications. Full technical specifications, implementation guides, and more are forthcoming.</p>

<ul>
  <li><a href="https://docs.google.com/document/d/1MOmhbPsVhGEULUeBhUdieYzpi6VzdPZedCAHb5aHEE0">Public Review Draft of the Technical and Functional Specification</a></li>
  <li><a href="https://github.com/undp/Regi-TRUST">Github Repository</a></li>
  <li><a href="https://www.sparkblue.org/Regi-TRUST/">Community of Practice and Governance Discussion</a></li>
</ul>

<h3 id="trust-network-gateway">Trust Network Gateway</h3>

<p>The Trust Network Gateway is an open source implementation of a centralized trust network solution available to potential implementers intending to create a local or regional network. This implementation is derived from the <a href="https://github.com/ehn-dcc-development/eu-dcc-overview">European Union Digital COVID Certificate Gateway (EUDCCG)</a>, which has been deployed in an operational setting within the European Union.</p>

<p>In addition to the core functionality of the EUDCCG, the Trust Network Gateway implementation also supports:</p>
<ul>
  <li>Federation and peer exchange of information between gateways</li>
  <li>Access to metadata content (e.g. value sets/codings, business rules) with explicit adherence to the HL7 FHIR specification</li>
  <li>Explicit means for revocation of digital COVID certificates</li>
  <li>Optional support of online verification and validation workflows</li>
</ul>

<p>The role of the Trust Network Gateway is to enable the creation of trust networks by additional
organizations beyond the EU Member States participating in the EUDCCG,
expanding the network of operators and trusted parties to form a federated and
documented network of trust gateways, supporting all major health credential certificates.</p>

<ul>
  <li><a href="https://github.com/WorldHealthOrganization/ddcc-gateway">Trust Network Gateway public repository</a></li>
  <li><a href="./trust_network_gateway_architecture.html">Architecture</a></li>
  <li><a href="openapi">Swagger API</a></li>
</ul>

<h3 id="downloads">Downloads</h3>

<p>
    Download the entire implementation guide <a href="full-ig.zip">here</a>
	</p>

<table>
		<tbody>
			<tr>
				<th>Artifact Definitions</th>

				<td>
					<a href="definitions.xml.zip">XML</a>
				</td>


				<td>
					<a href="definitions.json.zip">JSON</a>
				</td>


				<td>
					<a href="definitions.ttl.zip">Turtle</a>
				</td>

			</tr>
			<tr>
				<th>Examples</th>

				<td>
					<a href="examples.xml.zip">XML</a>
				</td>


				<td>
					<a href="examples.json.zip">JSON</a>
				</td>


				<td>
					<a href="examples.ttl.zip">Turtle</a>
				</td>

			</tr>
		</tbody>
	</table>

<h3 id="changes">Changes</h3>
<p>
    This provides a list of changes to the SMART Trust IG
  </p>
<p><a name="1.0.0"> </a></p>
<p>
    <b>2024-01-29 v1.0.0 -  First stable release </b> 
  </p>
<p><b>2024-01-29 v1.0.0 -  First stable release </b></p>
<ul>
    <li>First stable release</li>
  </ul>
<li>First stable release</li>
<p><a name="1.1.0"> </a></p>
<p>
    <b>2024-02-01 v1.1.0</b> 
  </p>
<p><b>2024-02-01 v1.1.0</b></p>
<ul>
    <li>Hcert specifications added</li>
  </ul>
<li>Hcert specifications added</li>
<p><a name="1.1.1"> </a></p>
<p>
    <b>2024-02-21 v1.1.1</b> 
  </p>
<p><b>2024-02-21 v1.1.1</b></p>
<ul>
    <li>video tutorials added</li>
  </ul>
<li>video tutorials added</li>
<p><a name="1.1.2"> </a></p>
<p>
    <b>2024-03-22 v1.1.2 - release</b> 
  </p>
<p><b>2024-03-22 v1.1.2 - release</b></p>
<ul>
    <li>HCert Logical Model and specification updated with subclaim details and notes</li>
    <li>Rapid assessment template for proposing new trust domains added</li>
    <li>Content Profiles include details about Trust Domain</li>
    <li>FAQ page added</li>
    <li>Link to country participation dashboard added</li>
  </ul>
<li>HCert Logical Model and specification updated with subclaim details and notes</li>
<li>Rapid assessment template for proposing new trust domains added</li>
<li>Content Profiles include details about Trust Domain</li>
<li>FAQ page added</li>
<li>Link to country participation dashboard added</li>
<p><a name="1.1.4"> </a></p>
<p>
    <b>2024-10-28 v1.1.4 - release</b> 
  </p>
<p><b>2024-10-28 v1.1.4 - release</b></p>
<ul>
    <li>HCert Logical Model updated with subclaim for DVC</li>
    <li>Onboarding Checklist updated</li>
    <li>Onboarding process revised to remove Transitive processes</li>
    <li>Latest country participation status updated</li>
  </ul>
<li>HCert Logical Model updated with subclaim for DVC</li>
<li>Onboarding Checklist updated</li>
<li>Onboarding process revised to remove Transitive processes</li>
<li>Latest country participation status updated</li>
<p>
    <b>2024-12-19 v1.1.5 - release</b> 
  </p>
<p><b>2024-12-19 v1.1.5 - release</b></p>
<ul>
    <li>Onboarding Checklist updated</li>
  </ul>
<li>Onboarding Checklist updated</li>

<h3 id="endpoints-1">Endpoints</h3>

<p>The following describes the active services and endpoints for the GDHCN Trust Network Gateway.</p>

<h4 id="operational-metadata">Operational Metadata</h4>
<h5 id="trust-domains-1">Trust Domains</h5>

<p><a name="l11821">​</a>The list of active trust domains is maintained in the <a href="ValueSet-WHO.TRUST.DOMAIN.html">GDHCN Trust Domain Value Set</a>.</p>

<h5 id="key-usage-codes">Key Usage Codes</h5>

<p><a name="l11830">​</a>The list of key usage codes is maintained in the <a href="ValueSet-WHO.TRUST.KEYUSAGE.html">GDHCN Key Usage Value Set</a>.</p>

<h5 id="participants-1">Participants</h5>

<p>The list of onboarded Trust Network Participants is availabe in the  <a href="ValueSet-Participants.html">GDHCN Participants Value Set</a>.</p>

<h4 id="trustlist-distribution-endpoints">Trustlist Distribution Endpoints</h4>

<p>THe following are the endpoints for the <a href="concepts_did_gdhcn.html">GDHCN DID Trust List</a> for each of development (DEV), user-acceptence testing (UAT) and production (PROD) <em>*environment</em>s:</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>Variant</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DEV</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn-dev.who.int/v2/trustlist/did.json">https://tng-cdn-dev.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>DEV</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn-dev.who.int/v2/trustlist-ref/did.json">https://tng-cdn-dev.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn-uat.who.int/v2/trustlist/did.json">https://tng-cdn-uat.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn-uat.who.int/v2/trustlist-ref/did.json">https://tng-cdn-uat.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td>Embedded</td>
      <td><a href="https://tng-cdn.who.int/v2/trustlist/did.json">https://tng-cdn.who.int/v2/trustlist/did.json</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td>Reference</td>
      <td><a href="https://tng-cdn.who.int/v2/trustlist-ref/did.json">https://tng-cdn.who.int/v2/trustlist-ref/did.json</a></td>
    </tr>
  </tbody>
</table>

<h4 id="trust-network-gateway-1">Trust Network Gateway</h4>

<p>THe following are the endpoints for the <a href="concepts.html#trust-network-gateway-tng">Trust Network Gateway</a> for each of development (DEV), user-acceptence testing (UAT) and production (PROD) <em>*environment</em>s:</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PROD</td>
      <td>https://tng.who.int</td>
    </tr>
    <tr>
      <td>UAT</td>
      <td>https://tng-uat.who.int</td>
    </tr>
    <tr>
      <td>DEV</td>
      <td>https://tng-dev.who.int</td>
    </tr>
  </tbody>
</table>

<h4 id="status-monitoring-dashboards">Status Monitoring Dashboards</h4>

<p>The following dashboards reflect the realtime status of key materials for each of development (DEV), user-acceptence testing (UAT) and production (PROD) <em>*environment</em>s:</p>

<table>
  <thead>
    <tr>
      <th>Environment</th>
      <th>Dashboard</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DEV</td>
      <td><a href="https://tng-monitor-dev.who.int/grafana/d/dev-cert-expiry/dev-country-certificate-expiry">Country certificate expiry</a></td>
    </tr>
    <tr>
      <td>DEV</td>
      <td><a href="https://tng-monitor-dev.who.int/grafana/d/ddh0xqz9diio0c/dev-country-onboarding-status">Country Onboarding Status</a></td>
    </tr>
    <tr>
      <td>DEV</td>
      <td><a href="https://tng-monitor-dev.who.int/grafana/d/dev-country-queries/dev-country-queries">Country Queries</a></td>
    </tr>
    <tr>
      <td>DEV</td>
      <td><a href="https://tng-monitor-dev.who.int/grafana/d/gw-availability/dev-gateway-availability-dashboard">Gateway Availability Dashboard</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td><a href="https://tng-monitor-uat.who.int/grafana/d/uat-cert-expiry/uat-country-certificate-expiry">Country certificate expiry</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td><a href="https://tng-monitor-uat.who.int/grafana/d/uat-country-queries/uat-country-queries">Country Queries</a></td>
    </tr>
    <tr>
      <td>UAT</td>
      <td><a href="https://tng-monitor-uat.who.int/grafana/d/c3ed3dbe-6cc0-4f16-8f0a-c7bcebd36420/uat-gateway-availability-dashboard">Gateway Availability Dashboard</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td><a href="https://tng-monitor.who.int/grafana/d/cert-expiry/prod-country-certificate-expiry">Country certificate expiry</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td><a href="https://tng-monitor.who.int/grafana/d/prod-country-queries/prod-country-queries">Country Queries</a></td>
    </tr>
    <tr>
      <td>PROD</td>
      <td><a href="https://tng-monitor.who.int/grafana/d/gateway-availability/prod-gateway-availability-dashboard">Gateway Availability Dashboard</a></td>
    </tr>
  </tbody>
</table>

<h2 id="indices">Indices</h2>

<p>This deployment guide consists of the following indexed material:</p>

<ul>
  <li><a href="artifacts.html">Artifact Index</a></li>
  <li><a href="references.html">References</a></li>
  <li><a href="maps.html">Mappings</a></li>
  <li><a href="changes.html">Changes</a></li>
  <li><a href="downloads.html">Downloads</a></li>
  <li><a href="license.html">License</a></li>
</ul>

<h3 id="trust-network-specifications">Trust Network Specifications</h3>

<p><a name="trust-specfications"> </a></p>

<h4 id="eu-dcc">EU DCC</h4>

<ul>
    <li><a href="https://ec.europa.eu/health/sites/health/files/ehealth/docs/trust-framework_interoperability_certificates_en.pdf">Interoperability of health certificates – Trust Framework – v. 1.0 – 12.03.2021 – eHealth Network</a>  - last accessed 27.04.2021</li>
    <li><a href="https://ec.europa.eu/health/sites/health/files/ehealth/docs/digital-green-certificates_v1_en.pdf">Technical Specifications for Digital COVID Certificates Volume 1 V1.0.5  - eHealth Network</a> - last accessed 27.04.2021</li>
    <li><a href="https://www.etsi.org/deliver/etsi_en/319100_319199/31910201/01.01.01_60/en_31910201v010101p.pdf">ETSI EN 319 102-1: Electronic Signatures and Infrastructures (ESI); Procedures for Creation and Validation of AdES Digital Signatures; Part 1: Creation and Validation – version 1.1.1, 2016</a>  – last accessed 23.04.2021</li>
    <li><a href="https://health.ec.europa.eu/publications/technical-specifications-eu-digital-covid-certificates-volumes-1-5_en">Technical specifications for EU Digital COVID Certificates - Volumes 1-5 </a> </li>
    <li><a href="https://health.ec.europa.eu/system/files/2022-02/digital-covid-certificates_v1_en.pdf">Volume 1: Formats and trust management available at  references "Implementing Decision (EU) 2021/1073, Annex I"</a></li>
    <li><a href="https://eur-lex.europa.eu/legal-content/EN/TXT/uri=uriserv%3AOJ.L_.2021.230.01.0032.01.ENG)">Implementing Decision (EU) 2021/1073, Annex I can be found at , along with other relevant Annexes.</a></li>
  </ul>

<h4 id="divoc">DIVOC</h4>

<ul>
    <li>Elements are defined by JSON-LD. As of 2023-02-12, the most current <a href="https://github.com/egovernments/DIVOC/blob/icmr/vaccination-context/vaccination-context.js">JSON-LD context for vaccines</a> and for <a href="https://github.com/egovernments/DIVOC/blob/icmr/test-certificate-context/test-certificate-context.js">test results</a> is here . Note that the URIs for the DIVOC-specific JSON-LD contexts embedded in the certificates do not resolve.</li>
    <li> DIVOC's <a href="https://divoc.digit.org">documentation</a> is here  but this does not include element-level descriptions (e.g., terminology bindings at a per-element level).</li>
    <li> Terminology bindings at the element level must be inferred from more <a href="https://divoc.digit.org/platform/divocs-verifiable-certificate-features/what-information-goes-into-a-qr-code">general documentation</a>.  The `v2` JSON-LD context introduces the `evidence.icd11Code` element for vaccines, but there is no documentation on which codes this element is bound to or whether this is used in production. There is no other computable representation of vaccine type/product.</li>
  </ul>

<h4 id="icao">ICAO</h4>

<ul>
    <li> ICAO <a href="https://www.icao.int/vdsnc-spec">VDS NC</a></li>
  </ul>

<h4 id="smart-health-cards">SMART Health Cards</h4>

<ul>
    <li>General SMART Health Card <a href="https://spec.smarthealth.cards">specification</a> </li>
    <li>COVID-19 <a href="http://build.fhir.org/ig/HL7/fhir-shc-vaccination-ig">vaccine and testing-specific specification</a> </li>
  </ul>

<h4 id="who-smart-guideline-development">WHO SMART Guideline Development</h4>

<p><a name="smart-guidelines"> </a></p>

<ul>
    <li>WHO <a href="https://www.who.int/teams/digital-health-and-innovation/smart-guidelines">SMART Guidelines</a> overviews the SMART Guidelines approach</li>
    <li>WHO <a href="https://www.who.int/publications/i/item/9789241548960">Handbook for guideline development</a> provides an overview of the WHO guideline development and publication process</li>
  </ul>

<h3 id="structuremaps">StructureMaps</h3>

<div>
    
  </div>

<h3 id="license">License</h3>

<p>Creative Commons Attribution 3.0 IGO (CC-BY-3.0-IGO)</p>

<h4 id="summary-1">Summary</h4>

<p>This is a human-readable summary of the <a href="https://creativecommons.org/licenses/by/3.0/igo/">Creative Commons Attribution 3.0 IGO (CC-BY-3.0-IGO) License</a>. This summary is not a substitute for the full license text.</p>

<p>Under this license, you are free to:</p>

<ul>
  <li>Share: Copy and redistribute the material in any medium or format.</li>
  <li>Adapt: Remix, transform, and build upon the material for any purpose, even commercially.</li>
</ul>

<p>Under the following conditions:</p>

<ul>
  <li>
    <p>Attribution: You must give appropriate credit, provide a link to the license, and indicate if changes were made. You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.</p>
  </li>
  <li>
    <p>No Additional Restrictions: You may not apply legal terms or technological measures that legally restrict others from doing anything the license permits.</p>
  </li>
  <li>
    <p>International Government Organizations (IGOs): This license is specifically designed for works created by International Government Organizations.</p>
  </li>
</ul>

<h4 id="license-text">License Text</h4>

<p>This work is licensed under the <a href="https://creativecommons.org/licenses/by/3.0/igo/">Creative Commons Attribution 3.0 IGO (CC-BY-3.0-IGO) License</a>.</p>

<p>To view a copy of this license, visit <a href="https://creativecommons.org/licenses/by/3.0/igo/">https://creativecommons.org/licenses/by/3.0/igo/</a> or send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.</p>

<div role="doc-endnotes" class="footnotes">
  <ol>
    <li role="doc-endnote" id="fn:1">
      <p>TNG Trust Network Gateway, formerly named Digital Documentation of Covid Certificates (DDCC) Gateway&nbsp;<a role="doc-backlink" href="#fnref:1" class="reversefootnote">↩</a></p>
    </li>
    <li role="doc-endnote" id="fn:2">
      <p>DID Core,   https://www.w3.org/TR/did-core/&nbsp;<a role="doc-backlink" href="#fnref:2" class="reversefootnote">↩</a></p>
    </li>
  </ol>
</div>



</div>
</div>    <!-- /inner-wrapper -->
</div>    <!-- /row -->
</div>    <!-- /container -->
</div>    <!-- /segment-content -->

<script src="assets/js/jquery.js" type="text/javascript"> </script>       <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script src="assets/js/jquery-ui.min.js" type="text/javascript"> </script>

<script src="assets/js/window-hash.js" type="text/javascript"> </script>
<a name="bottom"> </a>
<div igtool="footer" id="segment-footer" class="segment">    <!-- segment-footer -->
<div class="container">    <!-- container -->

<div class="inner-wrapper">
  <p>
    IG &copy; 2023+ <a style="color:var(--footer-hyperlink-text-color)" href="http://who.int">WHO</a>.  Package smart.who.int.trust#1.1.6 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R5/">FHIR 5.0.0</a>. Generated <span title="Mon, Mar 31, 2025 23:00+0000">2025-03-31</span>
    <br/>
    <span style="color: var(--footer-highlight-text-color)">
                Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
| <a style="color: #81BEF7" href="http://smart.who.int/trust/history.html" target="_blank">Version History</a> | <a rel="license" style="color: #81BEF7" href="license.html">License</a>
    </span>
  </p>
</div>    <!-- /inner-wrapper -->
</div>    <!-- /container -->
</div>    <!-- /segment-footer -->

<div id="segment-post-footer" class="segment hidden">    <!-- segment-post-footer -->
<div class="container">    <!-- container -->
</div>    <!-- /container -->
</div>    <!-- /segment-post-footer -->

  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/bootstrap.min.js" type="text/javascript"> </script>
<script src="assets/js/respond.min.js" type="text/javascript"> </script>
<script src="assets/js/anchor.min.js" type="text/javascript"> </script>
<script src="assets/js/clipboard.min.js" type="text/javascript"> </script>
<script src="assets/js/clipboard-btn.js" type="text/javascript"> </script>
<script src="assets/js/anchor-hover.js" type="text/javascript"> </script>
  <!-- Analytics Below
================================================== -->


<div data-repo-owner="null" data-issue-label="feedback" data-feedback-options="[{&quot;form&quot;:&quot;https://github.com/WorldHealthOrganization/smart-trust/issues/new?template=feedback.yml&quot;,&quot;type&quot;:&quot;GitHub&quot;,&quot;sectionid&quot;:&quot;section&quot;,&quot;pageid&quot;:&quot;page&quot;},{&quot;form&quot;:&quot;https://forms.office.com/e/WKxJWQMEcx&quot;,&quot;type&quot;:&quot;Form&quot;,&quot;sectionid&quot;:&quot;r275a700d161d41d182d84c2e58947298&quot;}]" data-repo-name="null" data-repo-source="https://github.com/WorldHealthOrganization/smart-trust/issues/new?template=feedback.yml" style="display:none;" id="feedback-config"></div>

<script src="assets/js/feedback.js"></script>



</body></html>